<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Roadha Run - Runner Portal</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <!-- html2canvas for Bib sharing -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
      -webkit-text-size-adjust: 100%;
    }
    
    /* Prevent zoom on mobile */
    input, select, textarea {
      font-size: 16px !important;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse-custom {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.05); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes glow {
      0%, 100% { box-shadow: 0 0 10px rgba(234, 88, 12, 0.5); }
      50% { box-shadow: 0 0 20px rgba(234, 88, 12, 0.8); }
    }
    
    @keyframes confetti {
      0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
    }
    
    @keyframes loading {
      0% { width: 0%; transform: translateX(-100%); }
      50% { width: 100%; transform: translateX(0); }
      100% { width: 0%; transform: translateX(100%); }
    }
    
    @keyframes stravaAnimation {
      0% { transform: scale(0.8); opacity: 0; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    @keyframes runningIcon {
      0% { transform: translateX(-100px) rotate(0deg); }
      25% { transform: translateX(0) rotate(10deg); }
      50% { transform: translateX(100px) rotate(0deg); }
      75% { transform: translateX(0) rotate(-10deg); }
      100% { transform: translateX(-100px) rotate(0deg); }
    }
    
    @keyframes runningShoesAnimation {
      0% { 
        transform: scale(0.5) rotate(0deg);
        opacity: 0;
      }
      20% { 
        transform: scale(1.5) rotate(10deg);
        opacity: 1;
      }
      40% { 
        transform: scale(2) rotate(-10deg);
        opacity: 1;
      }
      60% { 
        transform: scale(2.5) rotate(15deg);
        opacity: 1;
      }
      80% { 
        transform: scale(3) rotate(-15deg);
        opacity: 0.8;
      }
      100% { 
        transform: scale(3.5) rotate(0deg);
        opacity: 0;
      }
    }
    
    @keyframes shoeMove {
      0% { left: -100px; top: 50%; opacity: 0; }
      50% { left: 50%; top: 50%; opacity: 1; }
      100% { left: calc(100% + 100px); top: 50%; opacity: 0; }
    }
    
    @keyframes runningShoesFullScreen {
      0% { 
        transform: scale(0.5) rotate(0deg);
        opacity: 0;
        filter: brightness(1);
      }
      10% { 
        transform: scale(1.2) rotate(5deg);
        opacity: 0.8;
        filter: brightness(1.2);
      }
      20% { 
        transform: scale(1.8) rotate(-5deg);
        opacity: 1;
        filter: brightness(1.5);
      }
      30% { 
        transform: scale(2.5) rotate(8deg);
        opacity: 1;
        filter: brightness(1.8);
      }
      40% { 
        transform: scale(3.2) rotate(-8deg);
        opacity: 1;
        filter: brightness(2);
      }
      50% { 
        transform: scale(4) rotate(10deg);
        opacity: 1;
        filter: brightness(2.3);
      }
      60% { 
        transform: scale(5) rotate(-10deg);
        opacity: 1;
        filter: brightness(2.5);
      }
      70% { 
        transform: scale(6) rotate(12deg);
        opacity: 0.9;
        filter: brightness(2.8);
      }
      80% { 
        transform: scale(7) rotate(-12deg);
        opacity: 0.7;
        filter: brightness(3);
      }
      90% { 
        transform: scale(8) rotate(15deg);
        opacity: 0.5;
        filter: brightness(3.2);
      }
      100% { 
        transform: scale(10) rotate(0deg);
        opacity: 0;
        filter: brightness(3.5);
      }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.5s ease-out;
    }
    
    .animate-pulse-custom {
      animation: pulse-custom 2s infinite ease-in-out;
    }
    
    .animate-float {
      animation: float 3s ease-in-out infinite;
    }
    
    .animate-glow {
      animation: glow 2s ease-in-out infinite;
    }
    
    .animate-strava {
      animation: stravaAnimation 1s ease-out forwards;
    }
    
    .animate-running {
      animation: runningIcon 3s linear infinite;
    }
    
    .animate-running-shoes {
      animation: runningShoesAnimation 2s ease-out forwards;
    }
    
    .animate-shoe-move {
      animation: shoeMove 1.5s ease-in-out forwards;
    }
    
    .animate-running-shoes-fullscreen {
      animation: runningShoesFullScreen 2.5s ease-out forwards;
    }
    
    /* Bib number styling */
    .bib-number {
      font-family: 'Courier New', monospace;
      letter-spacing: 2px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }
    
    .bib-number-large {
      font-size: clamp(2rem, 8vw, 5rem);
      letter-spacing: 4px;
      text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
    }
    
    /* Custom scrollbar */
    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }
    
    /* Medal colors */
    .medal-bronze {
      background: linear-gradient(135deg, #92400e 0%, #b45309 100%);
      color: #fbbf24;
    }
    
    .medal-silver {
      background: linear-gradient(135deg, #4b5563 0%, #6b7280 100%);
      color: #e5e7eb;
    }
    
    .medal-gold {
      background: linear-gradient(135deg, #854d0e 0%, #a16207 100%);
      color: #fde047;
    }
    
    .medal-platinum {
      background: linear-gradient(135deg, #0e7490 0%, #0891b2 100%);
      color: #a5f3fc;
    }
    
    .medal-diamond {
      background: linear-gradient(135deg, #3730a3 0%, #4f46e5 100%);
      color: #c7d2fe;
    }
    
    /* Mobile optimization */
    @media (max-width: 640px) {
      .mobile-full-height {
        min-height: 100vh;
        min-height: -webkit-fill-available;
      }
      
      .mobile-padding {
        padding: 1rem !important;
      }
      
      .mobile-text {
        font-size: 14px !important;
      }
      
      .mobile-heading {
        font-size: 1.5rem !important;
      }
      
      .mobile-bib {
        font-size: clamp(2.5rem, 12vw, 4rem) !important;
      }
      
      /* Mobile calendar fixes */
      .calendar-grid {
        grid-template-columns: repeat(7, 1fr) !important;
        gap: 0.25rem !important;
      }
      
      .calendar-day {
        padding: 0.25rem !important;
        font-size: 12px !important;
        min-height: 32px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
      }
      
      .calendar-header {
        padding: 0.5rem !important;
      }
      
      .calendar-popup {
        position: fixed !important;
        top: 50% !important;
        left: 50% !important;
        transform: translate(-50%, -50%) !important;
        width: 90vw !important;
        max-width: 400px !important;
        max-height: 80vh !important;
        overflow-y: auto !important;
      }
      
      .time-input-group {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 0.5rem !important;
      }
    }
    
    /* Confetti */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      z-index: 1000;
    }
    
    /* Ribbon effect */
    .ribbon {
      position: absolute;
      top: -10px;
      right: -10px;
      width: 120px;
      height: 120px;
      overflow: hidden;
      z-index: 20;
    }
    
    .ribbon span {
      position: absolute;
      display: block;
      width: 200px;
      padding: 8px 0;
      background: linear-gradient(45deg, #ea580c 0%, #f59e0b 100%);
      color: white;
      text-align: center;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    }
    
    .ribbon span:nth-child(1) {
      transform: rotate(45deg);
      top: 25px;
      right: -40px;
    }
    
    /* Crown styles */
    .crown-gold {
      background: linear-gradient(135deg, #FFD700 0%, #FFEC8B 100%);
      color: #8B7500;
    }
    
    .crown-silver {
      background: linear-gradient(135deg, #C0C0C0 0%, #E8E8E8 100%);
      color: #696969;
    }
    
    .crown-bronze {
      background: linear-gradient(135deg, #CD7F32 0%, #E8B886 100%);
      color: #8B4513;
    }
    
    /* Input focus styles */
    input:focus, textarea:focus, select:focus {
      outline: none !important;
      box-shadow: 0 0 0 2px rgba(234, 88, 12, 0.2) !important;
    }
    
    /* Activity log form styles */
    .activity-type-btn.active {
      border-color: #ea580c;
      background-color: rgba(234, 88, 12, 0.1);
      color: #ea580c;
    }
    
    /* Custom scrollbar for webkit */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #ea580c;
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #c2410c;
    }
    
    /* Calendar styles */
    .calendar-container {
      position: relative;
    }
    
    .calendar-input {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      padding: 0.75rem;
      width: 100%;
      cursor: pointer;
    }
    
    .calendar-popup {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.75rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      z-index: 50;
      padding: 1rem;
      margin-top: 0.5rem;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 0.5rem;
    }
    
    .calendar-day {
      text-align: center;
      padding: 0.5rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: all 0.2s;
      min-height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    
    .calendar-day:hover {
      background-color: #f3f4f6;
    }
    
    .calendar-day.selected {
      background-color: #ea580c;
      color: white;
    }
    
    .calendar-day.disabled {
      color: #d1d5db;
      cursor: not-allowed;
    }
    
    .calendar-day.has-activity {
      position: relative;
    }
    
    .calendar-day.finished::after {
      content: '';
      position: absolute;
      top: 2px;
      right: 2px;
      width: 16px;
      height: 16px;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="6059996227148910161.jpg" viewBox="0 0 24 24" fill="%23ea580c"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
    }
    
    .calendar-day.has-logo::before {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 12px;
      height: 12px;
      background-image: url('South Blues Black Transparent.png');
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.8;
    }
    
    /* Progress bar styles */
    .progress-bar-container {
      width: 100%;
      height: 8px;
      background-color: #374151;
      border-radius: 4px;
      overflow: hidden;
      margin: 8px 0;
    }
    
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #ea580c, #f59e0b);
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    /* Medal progress styles */
    .medal-progress-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px 12px;
      margin-bottom: 8px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .medal-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    
    /* Admin badge */
    .admin-badge {
      background: linear-gradient(135deg, #8B0000 0%, #DC143C 100%);
      color: white;
    }
    
    /* Status badges */
    .status-pending {
      background-color: #fef3c7;
      color: #92400e;
    }
    
    .status-approved {
      background-color: #d1fae5;
      color: #065f46;
    }
    
    .status-rejected {
      background-color: #fee2e2;
      color: #991b1b;
    }
    
    /* Time input styles */
    .time-input-group {
      display: flex;
      gap: 0.5rem;
    }
    
    .time-input {
      flex: 1;
    }
    
    .time-input label {
      display: block;
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
    
    /* Bib sharing modal */
    .bib-sharing-modal {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(4px);
    }
    
    .bib-sharing-card {
      background: white;
      border-radius: 1.5rem;
      max-width: 400px;
      width: 90%;
      overflow: hidden;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    /* Calendar background */
    .calendar-bg {
      background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('6059996227148910161.jpg') center/cover no-repeat;
    }
    
    /* Ranking progress bars */
    .ranking-progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin-top: 4px;
    }
    
    .ranking-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ea580c, #f59e0b);
      border-radius: 4px;
    }
    
    /* Mobile calendar modal */
    .calendar-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    
    .calendar-modal-content {
      background: white;
      border-radius: 1rem;
      width: 100%;
      max-width: 400px;
      max-height: 80vh;
      overflow-y: auto;
      background: linear-gradient(rgba(0, 0, 0, 0.8), rgba(0, 0, 0, 0.8)), url('6059996227148910161.jpg') center/cover no-repeat !important;
      color: white;
    }
    
    /* Strava-like animation */
    .strava-animation-container {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 99999;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(10px);
    }
    
    .strava-animation-content {
      text-align: center;
      color: white;
      padding: 2rem;
    }
    
    .running-icon {
      font-size: 80px;
      margin-bottom: 1rem;
      display: block;
    }
    
    /* Image preview styles */
    .image-preview-container {
      width: 100%;
      max-height: 200px;
      overflow: hidden;
      border-radius: 0.75rem;
      border: 2px dashed #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .image-preview-container:hover {
      border-color: #ea580c;
      background: rgba(234, 88, 12, 0.05);
    }
    
    .image-preview {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .image-preview-placeholder {
      padding: 2rem;
      text-align: center;
      color: #6b7280;
    }
    
    /* Goal selection styles */
    .goal-option {
      padding: 1rem;
      border: 2px solid #e5e7eb;
      border-radius: 1rem;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }
    
    .goal-option:hover {
      border-color: #ea580c;
      transform: translateY(-2px);
    }
    
    .goal-option.selected {
      border-color: #ea580c;
      background: rgba(234, 88, 12, 0.1);
      box-shadow: 0 4px 12px rgba(234, 88, 12, 0.2);
    }
    
    .goal-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      display: block;
    }
    
    /* Admin image viewer */
    .admin-image-viewer {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
    }
    
    .admin-image-container {
      max-width: 90vw;
      max-height: 90vh;
      background: white;
      border-radius: 1rem;
      overflow: hidden;
    }
    
    .admin-image {
      width: 100%;
      height: auto;
      display: block;
    }
    
    /* Upload button styles */
    .upload-btn {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }
    
    .upload-btn input[type="file"] {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    /* Activity feed image */
    .activity-image {
      width: 100%;
      border-radius: 0.5rem;
      margin-top: 0.5rem;
      cursor: pointer;
      transition: transform 0.3s;
    }
    
    .activity-image:hover {
      transform: scale(1.02);
    }
    
    /* Running shoes animation */
    .running-shoes-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000428 0%, #004e92 100%);
      z-index: 100000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
    }
    
    .running-shoe {
      position: absolute;
      font-size: 60px;
      filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.7));
    }
    
    .running-shoes-text {
      font-size: 2.5rem;
      font-weight: 900;
      margin-top: 100px;
      text-align: center;
      background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #FFD166, #06D6A0);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: pulse-custom 1.5s infinite;
    }
    
    /* Running shoes full screen animation */
    .running-shoes-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #000000 0%, #1a237e 100%);
      z-index: 1000000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      overflow: hidden;
    }
    
    .running-shoe-fullscreen {
      position: absolute;
      font-size: 100px;
      filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.8));
      z-index: 1000001;
    }
    
    .running-shoes-fullscreen-text {
      position: relative;
      z-index: 1000002;
      font-size: 3.5rem;
      font-weight: 900;
      margin-top: 200px;
      text-align: center;
      background: linear-gradient(45deg, #FF6B6B, #4ECDC4, #FFD166, #06D6A0, #118AB2, #EF476F);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: pulse-custom 1s infinite;
    }
    
    .running-shoes-fullscreen-subtext {
      position: relative;
      z-index: 1000002;
      font-size: 1.5rem;
      margin-top: 20px;
      text-align: center;
      color: #ffffff;
      opacity: 0.9;
    }
    
    /* Simplified runner log form */
    .simple-log-form {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      padding: 30px;
    }
    
    /* Calendar modal specific styles */
    .calendar-modal-header {
      color: white !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .calendar-modal-day {
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .calendar-modal-day:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .calendar-modal-day.selected {
      background: #ea580c;
      color: white;
    }
    
    .calendar-modal-day.disabled {
      color: rgba(255, 255, 255, 0.3);
    }
    
    /* Developer credit button */
    .developer-credit {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .developer-credit:hover {
      background: rgba(0, 0, 0, 0.7);
      transform: translateY(-2px);
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 transition-colors duration-300">
  <div id="app"></div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCV4danc7NH3BfsQCxF2nuS0iV_V1aoQe0",
      authDomain: "symcodermv-cba04.firebaseapp.com",
      databaseURL: "https://symcodermv-cba04-default-rtdb.firebaseio.com",
      projectId: "symcodermv-cba04",
      storageBucket: "symcodermv-cba04.firebasestorage.app",
      messagingSenderId: "432074388052",
      appId: "1:432074388052:web:07ec04181e2af980b2b3c1",
      measurementId: "G-GBHF3K1C8P"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    // Application State
    let currentUser = null;
    let isAdmin = false;
    let isDarkMode = false;
    let activeTab = 'dashboard';
    let isSidebarOpen = false;
    let totalRegisteredRunners = 0;
    let nextBibNumber = 1000;
    let isLogActivityModalOpen = false;
    let selectedDate = new Date();
    let filterRunner = 'all';
    let runnerActivities = {};
    let adminLogActivityRunner = '';
    let selectedGoal = null;

    // PNG Image URLs
    const BACKGROUND_IMAGE = '6059996227148910161.jpg';
    const BIB_BACKGROUND = '6059996227148910161.jpg';
    const RUNNER_BACKGROUND = '6059996227148910161.jpg';
    const CALENDAR_BG = '6059996227148910161.jpg';
    const LOGO_IMAGE = 'South Blues Black Transparent.png';

    // DOM Elements
    const app = document.getElementById('app');

    // Initialize Application
    async function initApp() {
      // Check for saved user
      const savedUser = localStorage.getItem('currentUser');
      if (savedUser) {
        const parsedUser = JSON.parse(savedUser);
        // Check if it's admin login
        if (parsedUser.isAdmin) {
          isAdmin = true;
          currentUser = parsedUser;
        } else {
          currentUser = parsedUser;
        }
      }
      
      // Get total registered runners count
      try {
        const snapshot = await db.ref('runners').once('value');
        if (snapshot.exists()) {
          totalRegisteredRunners = snapshot.numChildren();
          
          // Find the highest Bib number
          let highestBib = 999;
          snapshot.forEach(childSnapshot => {
            const runner = childSnapshot.val();
            if (runner.bib_number) {
              const bibNum = parseInt(runner.bib_number.replace('BIB-', ''));
              if (!isNaN(bibNum) && bibNum > highestBib) {
                highestBib = bibNum;
              }
            }
          });
          
          nextBibNumber = Math.max(1000, highestBib + 1);
        }
      } catch (error) {
        console.log('Error fetching runner count:', error);
      }

      // Show splash screen
      showSplashScreen();
    }

    // Splash Screen
    function showSplashScreen() {
      app.innerHTML = `
        <div class="fixed inset-0 z-[9999] flex flex-col items-center justify-center bg-gradient-to-br from-blue-900 to-teal-900 mobile-full-height">
          <div class="w-24 h-24 sm:w-32 sm:h-32 bg-white rounded-3xl shadow-2xl flex items-center justify-center mb-4 sm:mb-6 animate-bounce">
            <img src="${LOGO_IMAGE}" alt="Roadha Run Logo" class="w-20 h-20 rounded-2xl object-cover">
          </div>
          <h1 class="text-2xl sm:text-4xl font-extrabold text-white tracking-tight text-center px-4">SOUTH POLICE</h1>
          <p class="mt-2 text-base sm:text-xl text-white/80 font-medium text-center px-4">Official Runner Portal</p>
          <div class="mt-8 sm:mt-12 w-48 h-1 bg-white/20 rounded-full overflow-hidden">
            <div class="h-full bg-white" style="animation: loading 2s ease-in-out infinite;"></div>
          </div>
          <p class="mt-4 text-white/40 text-xs sm:text-sm text-center px-4">Powered by Roadha Run</p>
        </div>
      `;

      setTimeout(() => {
        if (currentUser) {
          renderMainApp();
        } else {
          renderLogin();
        }
      }, 2000);
    }

    // Login Component with Password Only (FEATURE 1)
    function renderLogin(isRegister = false) {
      app.innerHTML = `
        <div class="min-h-screen mobile-full-height flex items-center justify-center p-4 sm:p-6 relative overflow-hidden" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BACKGROUND_IMAGE}') center/cover no-repeat fixed;">
          <!-- Background Overlay -->
          <div class="absolute inset-0 bg-black/50"></div>
          
          <!-- Developer Credit Button (FEATURE 3) -->
          <div class="developer-credit z-50" id="developerCreditBtn">
            <i class="fas fa-code mr-2"></i>
            Developed by Ahmed Vaseem
          </div>
          
          <div class="w-full max-w-4xl bg-white/10 backdrop-blur-xl p-6 sm:p-10 rounded-3xl sm:rounded-[3rem] border border-white/10 shadow-2xl relative z-10 animate-fadeIn mobile-padding">
            <div class="text-center mb-8 sm:mb-10">
              <div class="w-12 h-12 sm:w-16 sm:h-16 bg-white rounded-2xl flex items-center justify-center mx-auto mb-4 sm:mb-6 shadow-xl shadow-orange-600/20">
                <img src="${LOGO_IMAGE}" alt="Roadha Run Logo" class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl object-cover">
              </div>
              <h2 class="text-2xl sm:text-4xl font-black text-white uppercase tracking-tighter">
                ${isRegister ? 'Join Roadha Run' : 'Runner Login'}
              </h2>
              <p class="text-white/60 font-medium mt-2 text-sm sm:text-base">${isRegister ? 'Register to get your Official Digital Bib' : 'Enter your Bib or Contact Number'}</p>
              ${!isRegister ? `
                <div class="mt-4">
                  <button 
                    id="adminLoginBtn"
                    class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-xl transition-all flex items-center gap-2 mx-auto"
                  >
                    <i class="fas fa-user-shield"></i>
                    Admin Login
                  </button>
                </div>
              ` : ''}
            </div>

            <div class="flex flex-col lg:flex-row gap-6 sm:gap-10">
              <!-- Registration/Login Form -->
              <div class="lg:w-2/3">
                <form id="authForm" class="space-y-4">
                  ${isRegister ? `
                    <!-- Goal Selection -->
                    <div>
                      <label class="block text-[10px] font-black text-white/40 uppercase tracking-widest ml-4 mb-2">Select Your Goal</label>
                      <div class="grid grid-cols-2 gap-3">
                        <div class="goal-option ${selectedGoal === '100km' ? 'selected' : ''}" data-goal="100km">
                          <span class="goal-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
                          <div>
                            <p class="text-lg font-black text-white">100km</p>
                            <p class="text-xs text-white/60">Beginner Goal</p>
                          </div>
                        </div>
                        <div class="goal-option ${selectedGoal === '180km' ? 'selected' : ''}" data-goal="180km">
                          <span class="goal-icon">üèÉ‚Äç‚ôÄÔ∏è</span>
                          <div>
                            <p class="text-lg font-black text-white">180km</p>
                            <p class="text-xs text-white/60">Advanced Goal</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div class="space-y-1">
                      <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Full Name *</label>
                      <input 
                        required
                        type="text" 
                        id="name"
                        placeholder="Runner Name"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-orange-600 focus:border-transparent transition-all text-base"
                      />
                    </div>
                    <div class="space-y-1">
                      <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Nickname *</label>
                      <input 
                        required
                        type="text" 
                        id="nickname"
                        placeholder="Nickname"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-orange-600 focus:border-transparent transition-all text-base"
                      />
                    </div>
                    <div class="space-y-1">
                      <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Contact Number *</label>
                      <input 
                        required
                        type="tel" 
                        id="contact"
                        placeholder="+91 00000 00000"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-orange-600 focus:border-transparent transition-all text-base"
                      />
                    </div>
                    <div class="space-y-1">
                      <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Password *</label>
                      <input 
                        required
                        type="password" 
                        id="password"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-orange-600 focus:border-transparent transition-all text-base"
                      />
                    </div>
                  ` : `
                    <!-- FEATURE 1: Simplified Login - Only Bib/Contact and Password -->
                    <div class="space-y-1">
                      <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Bib Number / Contact *</label>
                      <input 
                        required
                        type="text" 
                        id="loginId"
                        placeholder="BIB-1000 or +91 00000 00000"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-orange-600 focus:border-transparent transition-all text-base"
                      />
                    </div>
                    <div class="space-y-1">
                      <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Password *</label>
                      <input 
                        required
                        type="password" 
                        id="password"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-orange-600 focus:border-transparent transition-all text-base"
                      />
                    </div>
                  `}

                  <button 
                    type="submit"
                    id="submitBtn"
                    class="w-full bg-orange-600 hover:bg-orange-700 text-white font-black py-4 sm:py-5 rounded-2xl mt-4 shadow-xl shadow-orange-600/20 transition-all active:scale-95 text-base sm:text-lg"
                  >
                    ${isRegister ? 'JOIN RUN & GET BIB' : 'LOGIN'}
                  </button>
                </form>

                <div class="mt-6 sm:mt-8 text-center">
                  <button 
                    id="toggleAuth"
                    class="text-white/60 hover:text-white text-xs sm:text-sm font-bold uppercase tracking-widest transition-colors"
                  >
                    ${isRegister ? 'Already have a Bib? Login' : "Don't have a Bib? Join Run"}
                  </button>
                </div>
              </div>

              <!-- Digital Bib Preview -->
              <div class="lg:w-1/3">
                <div class="rounded-3xl p-6 sm:p-8 h-full relative overflow-hidden border-4 border-orange-600/50" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BIB_BACKGROUND}') center/cover no-repeat;">
                  <div class="relative z-10">
                    <div class="text-center mb-6">
                      <p class="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-2">Your Digital Bib</p>
                      <div class="bib-number bib-number-large font-black text-white mb-4 tracking-wider animate-pulse">
                        ${isRegister ? `BIB-${nextBibNumber}` : 'BIB-XXXX'}
                      </div>
                      ${isRegister ? `
                        <div class="mb-4 p-3 bg-black/50 rounded-xl">
                          <p class="text-xs text-orange-300 mb-1">Selected Goal:</p>
                          <p class="text-lg font-black text-white">${selectedGoal || 'Not Selected'}</p>
                        </div>
                      ` : ''}
                      <div class="bg-black/50 backdrop-blur-sm rounded-2xl p-4 sm:p-5 mb-4 border border-white/20">
                        <p class="text-white text-base sm:text-lg font-bold" id="previewName">${isRegister ? 'Your Name' : 'Runner Name'}</p>
                        <p class="text-white/80 text-sm" id="previewNickname">"${isRegister ? 'Your Nickname' : 'Nickname'}"</p>
                        <p class="text-white/60 text-sm mt-2" id="previewContact">${isRegister ? 'Your Contact' : 'Contact'}</p>
                      </div>
                      <p class="text-white/60 text-xs">Your official race identifier</p>
                    </div>
                    
                    <!-- Bib Features -->
                    <div class="space-y-3 mt-6 sm:mt-8">
                      <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-orange-600/20 flex items-center justify-center">
                          <i class="fas fa-medal text-orange-400"></i>
                        </div>
                        <div>
                          <p class="text-xs font-bold text-white">Earn Digital Medals</p>
                          <p class="text-[10px] text-orange-300">50km, 100km, 250km milestones</p>
                        </div>
                      </div>
                      <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-lg bg-orange-600/20 flex items-center justify-center">
                          <i class="fas fa-trophy text-orange-400"></i>
                        </div>
                        <div>
                          <p class="text-xs font-bold text-white">Join Leaderboard</p>
                          <p class="text-[10px] text-orange-300">Compete with other runners</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="absolute bottom-6 left-0 right-0 text-center">
              <p class="text-white/30 text-[10px] font-black uppercase tracking-[0.2em]">Developed by Ahmed Vaseem</p>
            </div>
          </div>
        </div>
      `;

      // Add goal selection event listeners
      if (isRegister) {
        document.querySelectorAll('.goal-option').forEach(option => {
          option.addEventListener('click', () => {
            document.querySelectorAll('.goal-option').forEach(o => o.classList.remove('selected'));
            option.classList.add('selected');
            selectedGoal = option.dataset.goal;
            
            // Update preview
            const preview = document.querySelector('.rounded-3xl p-6')?.querySelector('.mb-4 p-3');
            if (preview) {
              preview.innerHTML = `
                <p class="text-xs text-orange-300 mb-1">Selected Goal:</p>
                <p class="text-lg font-black text-white">${selectedGoal}</p>
              `;
            }
          });
        });
      }

      // Update preview when user types in registration form
      if (isRegister) {
        const nameInput = document.getElementById('name');
        const nicknameInput = document.getElementById('nickname');
        const contactInput = document.getElementById('contact');
        
        if (nameInput) {
          nameInput.addEventListener('input', () => {
            document.getElementById('previewName').textContent = nameInput.value || 'Your Name';
          });
        }
        
        if (nicknameInput) {
          nicknameInput.addEventListener('input', () => {
            document.getElementById('previewNickname').textContent = `"${nicknameInput.value || 'Your Nickname'}"`;
          });
        }
        
        if (contactInput) {
          contactInput.addEventListener('input', () => {
            document.getElementById('previewContact').textContent = contactInput.value || 'Your Contact';
          });
        }
      }

      // Add event listeners
      document.getElementById('authForm').addEventListener('submit', handleAuthSubmit);
      document.getElementById('toggleAuth').addEventListener('click', () => {
        renderLogin(!isRegister);
      });
      
      // FEATURE 3: Admin login button
      const adminLoginBtn = document.getElementById('adminLoginBtn');
      if (adminLoginBtn) {
        adminLoginBtn.addEventListener('click', () => {
          renderAdminLogin();
        });
      }
      
      // FEATURE 3: Developer credit button
      document.getElementById('developerCreditBtn').addEventListener('click', () => {
        renderAdminLogin();
      });
    }

    // Admin Login Component
    function renderAdminLogin() {
      app.innerHTML = `
        <div class="min-h-screen mobile-full-height flex items-center justify-center p-4 sm:p-6 relative overflow-hidden" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BACKGROUND_IMAGE}') center/cover no-repeat fixed;">
          <!-- Background Overlay -->
          <div class="absolute inset-0 bg-black/50"></div>
          
          <div class="w-full max-w-md bg-white/10 backdrop-blur-xl p-6 sm:p-10 rounded-3xl sm:rounded-[3rem] border border-white/10 shadow-2xl relative z-10 animate-fadeIn mobile-padding">
            <div class="text-center mb-8 sm:mb-10">
              <div class="w-12 h-12 sm:w-16 sm:h-16 bg-red-600 rounded-2xl flex items-center justify-center mx-auto mb-4 sm:mb-6 shadow-xl shadow-red-600/20">
                <div class="text-white text-xl sm:text-2xl font-bold">
                  <i class="fas fa-user-shield"></i>
                </div>
              </div>
              <h2 class="text-2xl sm:text-4xl font-black text-white uppercase tracking-tighter">Admin Login</h2>
              <p class="text-white/60 font-medium mt-2 text-sm sm:text-base">Roadha Run Administration</p>
            </div>

            <form id="adminAuthForm" class="space-y-4">
              <div class="space-y-1">
                <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Admin ID</label>
                <input 
                  required
                  type="text" 
                  id="adminId"
                  placeholder="Enter Admin ID"
                  class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all text-base"
                />
              </div>
              <div class="space-y-1">
                <label class="text-[10px] font-black text-white/40 uppercase tracking-widest ml-4">Password</label>
                <input 
                  required
                  type="password" 
                  id="adminPassword"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  class="w-full bg-white/5 border border-white/10 rounded-2xl py-3 sm:py-4 px-4 sm:px-6 text-white font-bold placeholder:text-white/20 focus:ring-2 focus:ring-red-600 focus:border-transparent transition-all text-base"
                />
              </div>

              <button 
                type="submit"
                id="submitAdminBtn"
                class="w-full bg-red-600 hover:bg-red-700 text-white font-black py-4 sm:py-5 rounded-2xl mt-4 shadow-xl shadow-red-600/20 transition-all active:scale-95 text-base sm:text-lg"
              >
                ADMIN LOGIN
              </button>
            </form>

            <div class="mt-6 sm:mt-8 text-center">
              <button 
                id="backToLogin"
                class="text-white/60 hover:text-white text-xs sm:text-sm font-bold uppercase tracking-widest transition-colors"
              >
                <i class="fas fa-arrow-left mr-2"></i>
                Back to Runner Login
              </button>
            </div>
            
            <div class="absolute bottom-6 left-0 right-0 text-center">
              <p class="text-white/30 text-[10px] font-black uppercase tracking-[0.2em]">Administrative Access Only</p>
            </div>
          </div>
        </div>
      `;

      // Add event listeners
      document.getElementById('adminAuthForm').addEventListener('submit', handleAdminAuthSubmit);
      document.getElementById('backToLogin').addEventListener('click', () => {
        renderLogin(false);
      });
    }

    // Handle Admin Authentication
    async function handleAdminAuthSubmit(e) {
      e.preventDefault();
      const submitBtn = document.getElementById('submitAdminBtn');
      const adminId = document.getElementById('adminId').value;
      const adminPassword = document.getElementById('adminPassword').value;

      submitBtn.disabled = true;
      submitBtn.textContent = 'VERIFYING...';

      try {
        // Check admin credentials
        if (adminId === 'Admin' && adminPassword === '8555') {
          // Set admin user
          currentUser = {
            isAdmin: true,
            name: 'Administrator',
            nickname: 'Admin',
            role: 'admin',
            loginTime: new Date().toISOString()
          };
          
          isAdmin = true;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          // Show admin dashboard
          renderMainApp();
        } else {
          throw new Error('Invalid admin credentials');
        }
      } catch (error) {
        alert(error.message);
        submitBtn.disabled = false;
        submitBtn.textContent = 'ADMIN LOGIN';
      }
    }

    // Generate unique Bib number
    function generateBibNumber() {
      const bibNum = nextBibNumber++;
      return `BIB-${bibNum}`;
    }

    // Authentication Handler
    async function handleAuthSubmit(e) {
      e.preventDefault();
      const submitBtn = document.getElementById('submitBtn');
      const isRegister = document.getElementById('name') !== null;

      submitBtn.disabled = true;
      submitBtn.textContent = isRegister ? 'GENERATING BIB...' : 'AUTHENTICATING...';

      try {
        if (isRegister) {
          const name = document.getElementById('name').value;
          const nickname = document.getElementById('nickname').value;
          const contact = document.getElementById('contact').value;
          const password = document.getElementById('password').value;
          
          // Validate goal selection
          if (!selectedGoal) {
            throw new Error('Please select a goal (100km or 180km)');
          }
          
          // FEATURE 2: Check if contact number or Bib number already exists
          const runnersSnapshot = await db.ref('runners').once('value');
          let contactExists = false;
          let bibExists = false;
          
          runnersSnapshot.forEach(childSnapshot => {
            const runner = childSnapshot.val();
            if (runner.contact === contact) {
              contactExists = true;
            }
            if (runner.bib_number === `BIB-${nextBibNumber}`) {
              bibExists = true;
            }
          });
          
          if (contactExists) {
            throw new Error('This contact number is already registered. Please use a different number.');
          }
          
          if (bibExists) {
            throw new Error('Bib number already exists. Please try again.');
          }
          
          // Generate unique Bib number
          const bibNumber = generateBibNumber();
          
          // Create user in Firebase Auth
          const userCredential = await auth.createUserWithEmailAndPassword(
            `${bibNumber}@roadharun.run`,
            password
          );
          
          // Save user data to Realtime Database
          const userData = {
            bib_number: bibNumber,
            name: name,
            nickname: nickname,
            contact: contact,
            password: password,
            status: 'active',
            registration_date: new Date().toISOString(),
            total_runs: 0,
            total_distance: 0,
            avg_pace: 0,
            medals: [],
            last_activity_date: null,
            goal: selectedGoal,
            goal_progress: 0
          };
          
          await db.ref(`runners/${bibNumber}`).set(userData);

          // Update total runners count
          totalRegisteredRunners++;

          // Show Bib assignment success
          currentUser = userData;
          showBibAssignment(bibNumber);
          
        } else {
          // Login with Bib number or contact and password only
          const loginId = document.getElementById('loginId').value;
          const password = document.getElementById('password').value;
          
          // Find runner by Bib number or contact
          let bibNumber = '';
          
          // Check if it's a Bib number
          if (loginId.toUpperCase().startsWith('BIB-')) {
            bibNumber = loginId.toUpperCase();
          } else if (loginId.includes('BIB-')) {
            bibNumber = loginId.toUpperCase();
          } else {
            // Try to find by contact number
            const runnersSnapshot = await db.ref('runners').once('value');
            let foundRunner = null;
            runnersSnapshot.forEach(childSnapshot => {
              const runner = childSnapshot.val();
              if (runner.contact === loginId || runner.bib_number === loginId.toUpperCase()) {
                foundRunner = runner;
              }
            });
            
            if (!foundRunner) {
              throw new Error('Invalid credentials');
            }
            
            bibNumber = foundRunner.bib_number;
            currentUser = foundRunner;
          }
          
          // If bibNumber found, check password
          if (bibNumber) {
            const snapshot = await db.ref(`runners/${bibNumber}`).once('value');
            if (!snapshot.exists()) {
              throw new Error('Invalid credentials');
            }
            
            const userData = snapshot.val();
            
            // Check password
            if (userData.password !== password) {
              throw new Error('Invalid password');
            }
            
            currentUser = userData;
          }
          
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          
          // Show login success with Digital Bib
          showLoginSuccess(currentUser);
        }
      } catch (error) {
        alert(error.message);
        submitBtn.disabled = false;
        submitBtn.textContent = isRegister ? 'JOIN RUN & GET BIB' : 'LOGIN';
      }
    }

    // FEATURE 6: Show running shoes animation like Strava
    function showStravaRunningShoesAnimation() {
      const animationContainer = document.createElement('div');
      animationContainer.className = 'running-shoes-fullscreen animate-fadeIn';
      animationContainer.innerHTML = `
        <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 30%; left: 30%;">üëü</div>
        <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 40%; left: 60%; animation-delay: 0.1s;">üëü</div>
        <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 60%; left: 20%; animation-delay: 0.2s;">üëü</div>
        <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 70%; left: 50%; animation-delay: 0.3s;">üëü</div>
        <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 20%; left: 40%; animation-delay: 0.4s;">üëü</div>
        <h1 class="running-shoes-fullscreen-text">ACTIVITY SUBMITTED!</h1>
        <p class="running-shoes-fullscreen-subtext">Proof image uploaded successfully</p>
        <p class="running-shoes-fullscreen-subtext">Waiting for admin approval...</p>
      `;
      
      document.body.appendChild(animationContainer);
      
      // Remove animation after 3 seconds
      setTimeout(() => {
        if (animationContainer.parentNode) {
          document.body.removeChild(animationContainer);
        }
      }, 3000);
    }

    // Show Login Success with Digital Bib
    function showLoginSuccess(user) {
      app.innerHTML = `
        <div class="min-h-screen mobile-full-height flex items-center justify-center p-4 sm:p-6 relative overflow-hidden" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BACKGROUND_IMAGE}') center/cover no-repeat fixed;">
          <!-- Background Overlay -->
          <div class="absolute inset-0 bg-black/50"></div>
          
          <!-- Confetti effect -->
          <div id="confettiContainer"></div>
          
          <!-- Success Message Container -->
          <div class="w-full max-w-4xl bg-white/10 backdrop-blur-xl p-6 sm:p-10 rounded-3xl sm:rounded-[3rem] border border-white/10 shadow-2xl relative z-10 animate-fadeIn mobile-padding">
            <!-- Ribbon -->
            <div class="ribbon">
              <span>Welcome Back</span>
            </div>
            
            <!-- Success Header -->
            <div class="text-center mb-8 sm:mb-10">
              <div class="w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-tr from-orange-600 to-amber-500 rounded-3xl flex items-center justify-center mx-auto mb-4 sm:mb-6 shadow-2xl shadow-orange-600/30 animate-bounce">
                <i class="fas fa-check text-2xl sm:text-3xl text-white"></i>
              </div>
              <h2 class="text-2xl sm:text-4xl font-black text-white uppercase tracking-tighter">Login Successful!</h2>
              <p class="text-white/60 font-medium mt-2 text-sm sm:text-base">Welcome back to Roadha Run Portal</p>
            </div>
            
            <!-- Digital Bib Card -->
            <div class="mb-8 sm:mb-10">
              <div class="rounded-3xl p-6 sm:p-8 relative overflow-hidden border-4 border-orange-600/50" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BIB_BACKGROUND}') center/cover no-repeat;">
                <div class="relative z-10">
                  <div class="text-center">
                    <p class="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-2">Your Official Digital Bib</p>
                    <div class="bib-number bib-number-large font-black text-white mb-4 sm:mb-6 tracking-wider animate-pulse-custom">${user.bib_number}</div>
                    
                    <div class="bg-black/50 backdrop-blur-sm rounded-2xl p-4 sm:p-6 mb-4 sm:mb-6 border border-white/20">
                      <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-4">
                        <div class="w-12 h-12 sm:w-16 sm:h-16 rounded-2xl bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white text-base sm:text-xl font-bold">
                          ${user.nickname ? user.nickname.substring(0, 2).toUpperCase() : 'RU'}
                        </div>
                        <div class="text-center sm:text-left">
                          <p class="text-xl sm:text-2xl font-black text-white">${user.name}</p>
                          <p class="text-lg sm:text-xl text-orange-300">"${user.nickname}"</p>
                          ${user.goal ? `
                            <div class="mt-2">
                              <p class="text-sm text-orange-200">Goal: <span class="font-bold">${user.goal}</span></p>
                              <div class="w-full bg-white/20 rounded-full h-2 mt-1">
                                <div class="bg-orange-500 h-2 rounded-full" style="width: ${(user.total_distance || 0) / parseInt(user.goal) * 100}%"></div>
                              </div>
                            </div>
                          ` : ''}
                        </div>
                      </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-3 mt-4">
                      <div class="flex items-center gap-1.5">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        <p class="text-xs font-bold text-green-400">ACTIVE RUNNER</p>
                      </div>
                      <span class="text-white/40 hidden sm:inline">‚Ä¢</span>
                      <p class="text-xs text-white/60">Joined ${new Date(user.registration_date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Next Medal Progress -->
            <div class="bg-gradient-to-br from-orange-600 to-amber-500 rounded-3xl p-4 sm:p-6 mb-6 sm:mb-8 shadow-xl shadow-orange-600/20">
              <div class="flex items-center justify-between mb-4">
                <div>
                  <h3 class="text-base sm:text-lg font-black text-white">Next Medal Progress</h3>
                  <p class="text-white/80 text-xs sm:text-sm">Keep running to earn your next achievement!</p>
                </div>
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-2xl flex items-center justify-center backdrop-blur-md">
                  <i class="fas fa-medal text-lg sm:text-xl text-white"></i>
                </div>
              </div>
              
              ${getNextMedalGoal(user.total_distance || 0)}
            </div>
            
            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
              <button 
                id="continueToPortal"
                class="flex-1 bg-white hover:bg-gray-100 text-orange-600 font-black py-3 sm:py-4 px-4 sm:px-8 rounded-2xl shadow-xl transition-all active:scale-95 flex items-center justify-center gap-2 sm:gap-3 text-sm sm:text-base"
              >
                <i class="fas fa-arrow-right"></i>
                CONTINUE TO PORTAL
              </button>
              <button 
                id="shareBibBtn"
                class="flex-1 bg-transparent hover:bg-white/10 text-white font-bold py-3 sm:py-4 px-4 sm:px-8 rounded-2xl border-2 border-white/20 transition-all active:scale-95 flex items-center justify-center gap-2 sm:gap-3 text-sm sm:text-base"
              >
                <i class="fab fa-whatsapp"></i>
                SHARE BIB VIA WHATSAPP
              </button>
            </div>
          </div>
        </div>
      `;

      // Add confetti effect
      createConfetti();

      // Add event listeners
      document.getElementById('continueToPortal').addEventListener('click', () => {
        renderMainApp();
      });

      document.getElementById('shareBibBtn').addEventListener('click', () => {
        shareBibViaWhatsApp(user);
      });
    }

    // Create confetti effect
    function createConfetti() {
      const container = document.getElementById('confettiContainer');
      if (!container) return;
      
      const colors = ['#ea580c', '#f59e0b', '#3b82f6', '#10b981', '#8b5cf6'];
      
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = Math.random() * 10 + 5 + 'px';
        confetti.style.animation = `confetti ${Math.random() * 3 + 2}s linear ${Math.random() * 2}s forwards`;
        container.appendChild(confetti);
        
        // Remove confetti after animation
        setTimeout(() => {
          if (confetti.parentNode) {
            confetti.parentNode.removeChild(confetti);
          }
        }, 5000);
      }
    }

    // Share Bib via WhatsApp
    async function shareBibViaWhatsApp(user) {
      try {
        // Create Bib card for sharing
        const bibCard = document.createElement('div');
        bibCard.style.width = '400px';
        bibCard.style.height = '600px';
        bibCard.style.padding = '20px';
        bibCard.style.background = `linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BIB_BACKGROUND}') center/cover no-repeat`;
        bibCard.style.color = 'white';
        bibCard.style.fontFamily = 'Inter, sans-serif';
        bibCard.style.borderRadius = '20px';
        bibCard.style.border = '4px solid #ea580c';
        bibCard.style.position = 'relative';
        bibCard.style.overflow = 'hidden';
        
        bibCard.innerHTML = `
          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 12px; font-weight: 900; color: #f59e0b; letter-spacing: 2px; margin-bottom: 10px; text-transform: uppercase;">
              Roadha Run - Digital Bib
            </div>
            <div style="font-family: 'Courier New', monospace; font-size: 48px; font-weight: 900; margin: 20px 0; letter-spacing: 4px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">
              ${user.bib_number}
            </div>
            <div style="background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); border-radius: 15px; padding: 20px; margin: 20px 0; border: 1px solid rgba(255,255,255,0.2);">
              <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                <div style="width: 60px; height: 60px; border-radius: 15px; background: linear-gradient(135deg, #ea580c, #f59e0b); display: flex; align-items: center; justify-content: center; font-size: 20px; font-weight: bold;">
                  ${user.nickname ? user.nickname.substring(0, 2).toUpperCase() : 'RU'}
                </div>
                <div style="text-align: left;">
                  <div style="font-size: 20px; font-weight: 900;">${user.name}</div>
                  <div style="font-size: 16px; color: #f59e0b;">"${user.nickname}"</div>
                  ${user.goal ? `<div style="font-size: 14px; color: #ccc; margin-top: 5px;">Goal: ${user.goal}</div>` : ''}
                </div>
              </div>
              <div style="text-align: center; margin-top: 15px;">
                <div style="font-size: 12px; color: #ccc;">Total Distance</div>
                <div style="font-size: 14px; font-weight: 600;">${formatNumber(user.total_distance || 0, 1)} km</div>
              </div>
            </div>
            <div style="margin-top: 20px; font-size: 10px; color: #aaa;">
              Official Roadha Run Digital Bib
            </div>
            <div style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 10px; font-size: 11px;">
              Powered by Roadha Run
            </div>
          </div>
        `;
        
        // Add to body temporarily
        document.body.appendChild(bibCard);
        
        // Use html2canvas to create image
        const canvas = await html2canvas(bibCard, {
          scale: 2,
          backgroundColor: null,
          useCORS: true
        });
        
        // Remove temporary element
        document.body.removeChild(bibCard);
        
        // Convert to data URL
        const imageData = canvas.toDataURL('image/png');
        
        // Create WhatsApp share URL with image
        const message = `üèÉ‚Äç‚ôÇÔ∏è *Roadha Run - My Digital Bib* üèÉ‚Äç‚ôÇÔ∏è\n\n` +
                       `*Bib Number:* ${user.bib_number}\n` +
                       `*Name:* ${user.name}\n` +
                       `*Nickname:* ${user.nickname}\n` +
                       `*Goal:* ${user.goal || 'Not set'}\n` +
                       `*Total Distance:* ${formatNumber(user.total_distance || 0, 1)} km\n\n` +
                       `Join me at Roadha Run! üèÖ`;
        
        // For mobile devices
        if (/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)) {
          // Create a temporary link for downloading the image
          const link = document.createElement('a');
          link.href = imageData;
          link.download = 'roadha-run-bib.png';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          // Try to share via WhatsApp
          setTimeout(() => {
            window.open(`whatsapp://send?text=${encodeURIComponent(message)}`, '_blank');
          }, 1000);
        } else {
          // For desktop - create download link
          const link = document.createElement('a');
          link.href = imageData;
          link.download = 'roadha-run-bib.png';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          
          alert('Bib image downloaded! You can now share it on WhatsApp.');
        }
        
      } catch (error) {
        console.error('Error sharing Bib:', error);
        alert('Could not share Bib. Please try again.');
      }
    }

    // Show Bib Assignment
    function showBibAssignment(bibNumber) {
      app.innerHTML = `
        <div class="min-h-screen mobile-full-height flex items-center justify-center p-4 sm:p-6 relative overflow-hidden" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BACKGROUND_IMAGE}') center/cover no-repeat fixed;">
          <!-- Background Overlay -->
          <div class="absolute inset-0 bg-black/50"></div>

          <div class="w-full max-w-2xl bg-white/10 backdrop-blur-xl p-6 sm:p-10 rounded-3xl sm:rounded-[3rem] border border-white/10 shadow-2xl relative z-10 animate-fadeIn mobile-padding">
            <div class="text-center mb-8 sm:mb-10">
              <div class="w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-2xl flex items-center justify-center mx-auto mb-4 sm:mb-6 shadow-xl shadow-orange-600/20">
                <img src="${LOGO_IMAGE}" alt="Roadha Run Logo" class="w-12 h-12 sm:w-16 sm:h-16 rounded-xl object-cover">
              </div>
              <h2 class="text-2xl sm:text-4xl font-black text-white uppercase tracking-tighter">Welcome to Roadha Run!</h2>
              <p class="text-white/60 font-medium mt-2 text-sm sm:text-base">Your Digital Runner Bib has been assigned</p>
            </div>

            <!-- Bib Card -->
            <div class="rounded-3xl p-6 sm:p-8 mb-6 sm:mb-8 relative overflow-hidden border-4 border-orange-600/50" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BIB_BACKGROUND}') center/cover no-repeat;">
              <div class="text-center">
                <p class="text-white/80 text-sm font-bold uppercase tracking-widest mb-2">Your Official Bib Number</p>
                <div class="bib-number mobile-bib font-black text-white mb-4 tracking-wider">${bibNumber}</div>
                <div class="bg-black/50 backdrop-blur-sm rounded-2xl p-4 sm:p-6 mb-4 border border-white/20">
                  <p class="text-white text-base sm:text-lg font-bold">${currentUser.name}</p>
                  <p class="text-white/80 text-sm">"${currentUser.nickname}"</p>
                  ${currentUser.goal ? `
                    <div class="mt-3 p-2 bg-orange-500/20 rounded-lg">
                      <p class="text-sm text-orange-300">Goal: <span class="font-bold">${currentUser.goal}</span></p>
                      <div class="w-full bg-white/20 rounded-full h-1.5 mt-1">
                        <div class="bg-orange-500 h-1.5 rounded-full" style="width: 0%"></div>
                      </div>
                    </div>
                  ` : ''}
                </div>
                <p class="text-white/60 text-xs">Use this Bib number for all race activities</p>
              </div>
            </div>

            <div class="text-center space-y-4">
              <div class="p-3 sm:p-4 bg-white/5 rounded-2xl">
                <p class="text-white/80 text-sm font-medium mb-2">Your Goal: ${currentUser.goal || 'Not set'}</p>
                <p class="text-white/60 text-xs">Keep logging your activities to track your progress towards your goal</p>
              </div>
              
              <p class="text-white/60 text-sm">Save your Bib number for future logins</p>
              <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
                <button 
                  id="continueBtn"
                  class="bg-white hover:bg-gray-100 text-orange-600 font-black py-3 sm:py-4 px-4 sm:px-8 rounded-2xl shadow-xl transition-all active:scale-95 text-sm sm:text-base"
                >
                  CONTINUE TO PORTAL
                </button>
                <button 
                  id="shareBibWhatsApp"
                  class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 sm:py-4 px-4 sm:px-8 rounded-2xl transition-all active:scale-95 text-sm sm:text-base flex items-center justify-center gap-2"
                >
                  <i class="fab fa-whatsapp"></i>
                  SHARE ON WHATSAPP
                </button>
              </div>
              <p class="text-white/40 text-xs mt-4 sm:mt-6">Login using your Bib number and contact number</p>
            </div>
          </div>
        </div>
      `;

      document.getElementById('continueBtn').addEventListener('click', () => {
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        renderMainApp();
      });

      document.getElementById('shareBibWhatsApp').addEventListener('click', () => {
        shareBibViaWhatsApp(currentUser);
      });
    }

    // Get next medal goal
    function getNextMedalGoal(currentDistance) {
      const medalGoals = [
        { distance: 50, name: "Bronze", color: "bronze", icon: "fas fa-medal" },
        { distance: 100, name: "Silver", color: "silver", icon: "fas fa-medal" },
        { distance: 250, name: "Gold", color: "gold", icon: "fas fa-medal" },
        { distance: 500, name: "Platinum", color: "platinum", icon: "fas fa-gem" },
        { distance: 1000, name: "Diamond", color: "diamond", icon: "fas fa-gem" }
      ];
      
      let nextMedal = null;
      for (const medal of medalGoals) {
        if (currentDistance < medal.distance) {
          nextMedal = medal;
          break;
        }
      }
      
      if (!nextMedal) {
        return `
          <div class="text-center py-2">
            <p class="text-lg font-black">üèÜ CHAMPION! üèÜ</p>
            <p class="text-sm mt-1">You've earned all medals! Legend status achieved.</p>
          </div>
        `;
      }
      
      const progress = Math.min(100, Math.round((currentDistance / nextMedal.distance) * 100));
      
      return `
        <div class="space-y-3">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2 sm:gap-3">
              <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-full medal-${nextMedal.color} flex items-center justify-center">
                <i class="${nextMedal.icon} text-sm sm:text-base"></i>
              </div>
              <div>
                <p class="font-bold text-white text-sm sm:text-base">${nextMedal.name} Medal</p>
                <p class="text-xs text-white/80">${nextMedal.distance} km</p>
              </div>
            </div>
            <div class="text-right">
              <p class="text-lg font-black text-white">${progress}%</p>
              <p class="text-xs text-white/80">Progress</p>
            </div>
          </div>
          
          <div class="w-full bg-white/20 rounded-full h-2">
            <div class="bg-white h-2 rounded-full" style="width: ${progress}%"></div>
          </div>
          
          <div class="flex justify-between text-xs text-white/80">
            <span>${currentDistance.toFixed(1)} km</span>
            <span>${nextMedal.distance} km</span>
          </div>
          
          <p class="text-xs text-center mt-2 text-white/90">
            ${nextMedal.distance - currentDistance > 0 ? 
              `Run ${(nextMedal.distance - currentDistance).toFixed(1)} more km to earn this medal!` : 
              'Almost there! Keep going!'}
          </p>
        </div>
      `;
    }

    // Main Application
    function renderMainApp() {
      if (isAdmin) {
        renderAdminDashboard();
      } else {
        renderRunnerDashboard();
      }
    }

    // Render Runner Dashboard
    function renderRunnerDashboard() {
      app.innerHTML = `
        <div class="min-h-screen ${isDarkMode ? 'dark' : ''} mobile-full-height">
          <!-- Header -->
          <header class="fixed top-0 left-0 right-0 h-14 sm:h-16 bg-white dark:bg-zinc-800 border-b-2 border-orange-600 shadow-sm z-50 flex items-center justify-between px-3 sm:px-4 md:px-8">
            <div class="flex items-center gap-2 sm:gap-3">
              <button id="sidebarToggle" class="p-1.5 sm:p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-lg transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 dark:text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
              </button>
              <div class="hidden sm:flex items-center gap-2">
                <img src="${LOGO_IMAGE}" alt="Roadha Run Logo" class="w-8 h-8 rounded-lg">
                <h1 class="text-lg sm:text-xl font-black text-orange-600 uppercase tracking-tighter">Roadha Run</h1>
              </div>
              <div class="flex items-center gap-1 bg-orange-600 text-white text-[9px] sm:text-[10px] font-bold px-1.5 sm:px-2 py-0.5 rounded-full animate-pulse">
                <div class="w-1 h-1 sm:w-1.5 sm:h-1.5 bg-white rounded-full"></div>
                PORTAL
              </div>
            </div>

            <div class="flex items-center gap-1 sm:gap-2 md:gap-4">
              <div class="hidden sm:flex items-center gap-2 bg-orange-50 dark:bg-orange-900/20 p-1 pr-2 sm:p-1.5 sm:pr-3 rounded-full border border-orange-200 dark:border-orange-500/50">
                <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white text-xs font-bold shadow-sm">
                  ${currentUser.bib_number ? currentUser.bib_number.split('-')[1]?.substring(0, 2) || 'BI' : 'BI'}
                </div>
                <div class="hidden md:block">
                  <p class="text-xs font-bold leading-tight dark:text-white">${currentUser.nickname}</p>
                  <p class="text-[10px] text-orange-600 dark:text-orange-400 font-black">${currentUser.bib_number}</p>
                </div>
              </div>

              <button id="logoutBtn" class="p-1.5 sm:p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors" title="Logout">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
              </button>
            </div>
          </header>

          <!-- Sidebar -->
          ${renderSidebar()}

          <!-- Main Content -->
          <main class="flex-1 transition-all duration-300 mt-14 sm:mt-16 p-3 sm:p-4 md:p-8 ${isSidebarOpen ? 'md:ml-64' : ''} pb-20 sm:pb-0">
            <div class="max-w-6xl mx-auto">
              <div id="content"></div>
            </div>
          </main>

          <!-- Mobile Bottom Navigation -->
          <div class="sm:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-zinc-800 border-t border-gray-200 dark:border-zinc-700 flex justify-around py-3 z-30">
            ${[
              { id: 'dashboard', icon: 'fas fa-home', label: 'Home' },
              { id: 'feed', icon: 'fas fa-newspaper', label: 'Feed' },
              { id: 'logActivity', icon: 'fas fa-plus-circle', label: 'Log', isPlus: true },
              { id: 'ranking', icon: 'fas fa-trophy', label: 'Ranking' },
              { id: 'activities', icon: 'fas fa-history', label: 'History' }
            ].map(item => {
              if (item.isPlus) {
                return `
                  <button 
                    id="mobileLogActivityBtn"
                    class="flex flex-col items-center gap-1 text-orange-600"
                  >
                    <div class="w-12 h-12 -mt-6 rounded-full bg-gradient-to-tr from-orange-600 to-amber-500 text-white shadow-xl flex items-center justify-center">
                      <i class="${item.icon} text-xl"></i>
                    </div>
                    <span class="text-[10px] font-medium">${item.label}</span>
                  </button>
                `;
              } else {
                return `
                  <button 
                    data-tab="${item.id}"
                    class="mobile-tab-btn flex flex-col items-center gap-0.5 ${activeTab === item.id ? 'text-orange-600' : 'text-gray-500 dark:text-gray-400'}"
                  >
                    <i class="${item.icon} text-lg"></i>
                    <span class="text-[10px] font-medium">${item.label}</span>
                  </button>
                `;
              }
            }).join('')}
          </div>
        </div>
      `;

      // Add event listeners
      document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);
      document.getElementById('mobileLogActivityBtn').addEventListener('click', () => {
        isLogActivityModalOpen = true;
        renderLogActivityModal();
      });
      
      // Mobile tab buttons
      document.querySelectorAll('.mobile-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          activeTab = btn.dataset.tab;
          renderContent();
        });
      });

      // Initial content render
      renderContent();
    }

    // Render Admin Dashboard
    function renderAdminDashboard() {
      app.innerHTML = `
        <div class="min-h-screen ${isDarkMode ? 'dark' : ''} mobile-full-height">
          <!-- Header -->
          <header class="fixed top-0 left-0 right-0 h-14 sm:h-16 bg-gradient-to-r from-red-700 to-red-800 shadow-lg z-50 flex items-center justify-between px-3 sm:px-4 md:px-8">
            <div class="flex items-center gap-2 sm:gap-3">
              <button id="sidebarToggle" class="p-1.5 sm:p-2 hover:bg-red-600 rounded-lg transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
                </svg>
              </button>
              <div class="hidden sm:flex items-center gap-2">
                <img src="${LOGO_IMAGE}" alt="Roadha Run Logo" class="w-8 h-8 rounded-lg">
                <h1 class="text-lg sm:text-xl font-black text-white uppercase tracking-tighter">Admin Dashboard</h1>
              </div>
              <div class="flex items-center gap-1 bg-yellow-500 text-white text-[9px] sm:text-[10px] font-bold px-1.5 sm:px-2 py-0.5 rounded-full animate-pulse">
                <div class="w-1 h-1 sm:w-1.5 sm:h-1.5 bg-white rounded-full"></div>
                ADMIN
              </div>
            </div>

            <div class="flex items-center gap-1 sm:gap-2 md:gap-4">
              <div class="hidden sm:flex items-center gap-2 bg-red-600/30 p-1 pr-2 sm:p-1.5 sm:pr-3 rounded-full border border-red-400/50">
                <div class="w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gradient-to-tr from-red-600 to-red-500 flex items-center justify-center text-white text-xs font-bold shadow-sm">
                  <i class="fas fa-user-cog text-xs"></i>
                </div>
                <div class="hidden md:block">
                  <p class="text-xs font-bold leading-tight text-white">Administrator</p>
                  <p class="text-[10px] text-red-200 font-black">Super Admin</p>
                </div>
              </div>

              <button id="logoutBtn" class="p-1.5 sm:p-2 text-white hover:bg-red-600 rounded-lg transition-colors" title="Logout">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                </svg>
              </button>
            </div>
          </header>

          <!-- Admin Sidebar -->
          ${renderAdminSidebar()}

          <!-- Main Content -->
          <main class="flex-1 transition-all duration-300 mt-14 sm:mt-16 p-3 sm:p-4 md:p-8 ${isSidebarOpen ? 'md:ml-64' : ''}">
            <div class="max-w-7xl mx-auto">
              <div id="content"></div>
            </div>
          </main>
        </div>
      `;

      // Add event listeners
      document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
      document.getElementById('logoutBtn').addEventListener('click', handleLogout);

      // Initial content render
      renderAdminContent();
    }

    // Admin Sidebar Component
    function renderAdminSidebar() {
      const menuItems = [
        { id: 'adminDashboard', label: 'Dashboard', icon: 'fas fa-tachometer-alt' },
        { id: 'manageRunners', label: 'Manage Runners', icon: 'fas fa-users' },
        { id: 'manageActivities', label: 'Manage Activities', icon: 'fas fa-running' },
        { id: 'pendingApprovals', label: 'Pending Approvals', icon: 'fas fa-clock' },
        { id: 'adminReports', label: 'Reports', icon: 'fas fa-chart-bar' }
      ];

      return `
        ${isSidebarOpen ? `
          <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[55] md:hidden" id="sidebarOverlay"></div>
        ` : ''}
        <aside class="fixed top-14 sm:top-16 left-0 bottom-0 w-64 bg-zinc-900 text-white z-[60] transition-transform duration-300 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 overflow-y-auto border-r border-zinc-800 hide-scrollbar">
          <div class="p-4 sm:p-6">
            <div class="flex items-center gap-3 mb-6 sm:mb-8">
              <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-red-600 flex items-center justify-center text-base sm:text-lg">
                <img src="${LOGO_IMAGE}" alt="Roadha Run Logo" class="w-8 h-8 sm:w-10 sm:h-10 rounded-lg object-cover">
              </div>
              <div>
                <p class="font-bold text-sm truncate w-32">Administrator</p>
                <p class="text-xs text-red-400 font-semibold">Super Admin</p>
                <p class="text-xs text-gray-400 mt-1">Full Access</p>
              </div>
            </div>

            <nav class="space-y-1 mb-6 sm:mb-8">
              ${menuItems.map(item => `
                <button
                  data-tab="${item.id}"
                  class="sidebar-tab-btn w-full flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl transition-all ${activeTab === item.id ? 'bg-red-600 text-white shadow-lg shadow-red-600/20' : 'text-gray-400 hover:bg-zinc-800 hover:text-white'}"
                >
                  <i class="${item.icon} w-5 text-center"></i>
                  <span class="font-medium text-sm">${item.label}</span>
                </button>
              `).join('')}
            </nav>
            
            <!-- Admin Stats -->
            <div class="mb-6 sm:mb-8">
              <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 sm:mb-4">System Overview</p>
              <div class="space-y-2">
                <div class="flex items-center justify-between p-2 bg-zinc-800/50 rounded-lg">
                  <span class="text-xs text-gray-300">Total Runners</span>
                  <span class="text-sm font-bold text-white" id="adminTotalRunners">0</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-zinc-800/50 rounded-lg">
                  <span class="text-xs text-gray-300">Pending Activities</span>
                  <span class="text-sm font-bold text-yellow-400" id="adminPendingActivities">0</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-zinc-800/50 rounded-lg">
                  <span class="text-xs text-gray-300">Total Distance</span>
                  <span class="text-sm font-bold text-green-400" id="adminTotalDistance">0 km</span>
                </div>
              </div>
            </div>
          </div>

          <div class="absolute bottom-6 left-4 right-4 sm:left-6 sm:right-6 p-3 sm:p-4 bg-zinc-800 rounded-2xl border border-zinc-700">
            <div class="flex items-center justify-between mb-3 sm:mb-4">
              <div>
                <p class="text-[10px] text-gray-400 uppercase font-bold tracking-widest">Admin Controls</p>
                <p class="text-base sm:text-lg font-black text-red-500">Full Access</p>
              </div>
              <div class="p-1.5 sm:p-2 bg-zinc-700 rounded-lg">
                <div class="text-red-500 text-lg sm:text-xl">
                  <i class="fas fa-shield-alt"></i>
                </div>
              </div>
            </div>
            <button id="sidebarLogout" class="w-full py-2 bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white text-xs font-bold rounded-lg border border-red-500/20 transition-all">
              Sign Out
            </button>
          </div>
        </aside>
      `;
    }

    // Sidebar Component for Runners
    function renderSidebar() {
      const menuItems = [
        { id: 'dashboard', label: 'Dashboard', icon: 'fas fa-home' },
        { id: 'feed', label: 'Activity Feed', icon: 'fas fa-newspaper' },
        { id: 'ranking', label: 'Runners Ranking', icon: 'fas fa-trophy' },
        { id: 'activities', label: 'My Activities', icon: 'fas fa-history' }
      ];

      return `
        ${isSidebarOpen ? `
          <div class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[55] md:hidden" id="sidebarOverlay"></div>
        ` : ''}
        <aside class="fixed top-14 sm:top-16 left-0 bottom-0 w-64 bg-zinc-900 text-white z-[60] transition-transform duration-300 transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 overflow-y-auto border-r border-zinc-800 hide-scrollbar">
          <div class="p-4 sm:p-6">
            <div class="flex items-center gap-3 mb-6 sm:mb-8">
              <div class="w-10 h-10 sm:w-12 sm:h-12 rounded-xl bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-base sm:text-lg font-bold">
                <img src="${LOGO_IMAGE}" alt="Roadha Run Logo" class="w-8 h-8 sm:w-10 sm:h-10 rounded-lg object-cover">
              </div>
              <div>
                <p class="font-bold text-sm truncate w-32">Roadha Run</p>
                <p class="text-xs text-orange-500 font-semibold">Runner Portal</p>
                <p class="text-xs text-gray-400 mt-1">${currentUser.nickname}</p>
              </div>
            </div>

            <nav class="space-y-1 mb-6 sm:mb-8">
              ${menuItems.map(item => `
                <button
                  data-tab="${item.id}"
                  class="sidebar-tab-btn w-full flex items-center gap-3 px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl transition-all ${activeTab === item.id ? 'bg-orange-600 text-white shadow-lg shadow-orange-600/20' : 'text-gray-400 hover:bg-zinc-800 hover:text-white'}"
                >
                  <i class="${item.icon} w-5 text-center"></i>
                  <span class="font-medium text-sm">${item.label}</span>
                </button>
              `).join('')}
            </nav>
            
            <!-- Digital Bib in Sidebar -->
            <div class="mb-6 sm:mb-8 rounded-2xl p-3 sm:p-4 relative overflow-hidden border-2 border-orange-600/50" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${RUNNER_BACKGROUND}') center/cover no-repeat;">
              <div class="relative z-10">
                <p class="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-2 text-center">Your Digital Bib</p>
                <div class="bib-number text-2xl sm:text-3xl font-black text-center text-white mb-2">${currentUser.bib_number}</div>
                
                <div class="mt-2 sm:mt-3 pt-2 sm:pt-3 border-t border-orange-500/30">
                  <div class="flex items-center justify-between mb-1">
                    <span class="text-xs text-orange-300">Total Distance</span>
                    <span class="text-sm font-bold text-white">${formatNumber(currentUser.total_distance || 0, 1)} km</span>
                  </div>
                  <div class="w-full bg-white/10 rounded-full h-1.5 mb-2">
                    <div class="bg-gradient-to-r from-orange-500 to-amber-400 h-1.5 rounded-full" style="width: ${Math.min(100, ((currentUser.total_distance || 0) / 100) * 100)}%"></div>
                  </div>
                </div>
                
                <p class="text-xs text-gray-300 text-center">${currentUser.name}</p>
                <p class="text-xs text-orange-300 text-center mt-1">"${currentUser.nickname}"</p>
                ${currentUser.goal ? `
                  <div class="mt-2 pt-2 border-t border-orange-500/30">
                    <p class="text-xs text-orange-300">Goal: ${currentUser.goal}</p>
                    <div class="w-full bg-white/10 rounded-full h-1.5 mt-1">
                      <div class="bg-orange-500 h-1.5 rounded-full" style="width: ${Math.min(100, ((currentUser.total_distance || 0) / parseInt(currentUser.goal)) * 100)}%"></div>
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>

            <!-- Ranking Section in Sidebar -->
            <div class="mb-6 sm:mb-8">
              <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 sm:mb-4">Your Ranking</p>
              <div id="sidebarRanking">
                <!-- Will be loaded via JavaScript -->
              </div>
            </div>

            <!-- Medal Progress in Sidebar -->
            <div class="mb-6 sm:mb-8">
              <p class="text-[10px] font-black text-gray-400 uppercase tracking-widest mb-3 sm:mb-4">Medal Progress</p>
              <div id="sidebarMedals">
                <!-- Will be loaded via JavaScript -->
              </div>
            </div>
          </div>

          <div class="absolute bottom-6 left-4 right-4 sm:left-6 sm:right-6 p-3 sm:p-4 bg-zinc-800 rounded-2xl border border-zinc-700">
            <div class="flex items-center justify-between mb-3 sm:mb-4">
              <div>
                <p class="text-[10px] text-gray-400 uppercase font-bold tracking-widest">Total Distance</p>
                <p class="text-base sm:text-lg font-black text-orange-500">${formatNumber(currentUser.total_distance || 0, 1)} km</p>
                ${currentUser.goal ? `
                  <p class="text-xs text-gray-400">Goal: ${currentUser.goal}</p>
                ` : ''}
              </div>
              <div class="p-1.5 sm:p-2 bg-zinc-700 rounded-lg">
                <div class="text-orange-500 text-lg sm:text-xl">üèÉ‚Äç‚ôÇÔ∏è</div>
              </div>
            </div>
            <button id="sidebarLogout" class="w-full py-2 bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white text-xs font-bold rounded-lg border border-red-500/20 transition-all">
              Sign Out
            </button>
          </div>
        </aside>
      `;

      // Load sidebar ranking and medals
      setTimeout(() => {
        loadSidebarRanking();
        loadSidebarMedals();
      }, 100);
    }

    // Fix for number formatting
    function formatNumber(value, decimals = 1) {
      // Convert to number if it's a string
      const num = typeof value === 'string' ? parseFloat(value) : value;
      
      // Check if it's a valid number
      if (isNaN(num)) {
        return '0.0';
      }
      
      return num.toFixed(decimals);
    }

    // Load sidebar ranking
    async function loadSidebarRanking() {
      const sidebarRanking = document.getElementById('sidebarRanking');
      if (!sidebarRanking) return;

      try {
        const snapshot = await db.ref('runners').once('value');
        const runners = [];
        
        snapshot.forEach(childSnapshot => {
          const runner = childSnapshot.val();
          runners.push(runner);
        });

        // Sort by total distance
        runners.sort((a, b) => (parseFloat(b.total_distance) || 0) - (parseFloat(a.total_distance) || 0));
        
        // Find current user's rank
        const userIndex = runners.findIndex(runner => runner.bib_number === currentUser.bib_number);
        const userRank = userIndex + 1;
        const totalRunners = runners.length;
        
        if (userIndex === -1) {
          sidebarRanking.innerHTML = `
            <div class="text-center py-2">
              <p class="text-xs text-gray-400">Rank not available</p>
            </div>
          `;
          return;
        }

        const percentage = Math.round((userRank / totalRunners) * 100);
        const progressWidth = Math.max(5, Math.min(95, percentage));
        
        sidebarRanking.innerHTML = `
          <div class="bg-zinc-800/50 p-3 sm:p-4 rounded-xl">
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-full ${
                  userRank === 1 ? 'crown-gold' : 
                  userRank === 2 ? 'crown-silver' : 
                  userRank === 3 ? 'crown-bronze' : 
                  'bg-orange-600/20'
                } flex items-center justify-center">
                  <i class="fas fa-trophy text-xs ${
                    userRank === 1 ? 'text-yellow-400' : 
                    userRank === 2 ? 'text-gray-300' : 
                    userRank === 3 ? 'text-amber-700' : 
                    'text-orange-400'
                  }"></i>
                </div>
                <div>
                  <p class="text-sm font-bold text-white">Rank #${userRank}</p>
                  <p class="text-xs text-gray-400">out of ${totalRunners} runners</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-lg font-black text-white">${formatNumber(currentUser.total_distance || 0, 1)}</p>
                <p class="text-xs text-gray-400">km</p>
              </div>
            </div>
            
            <!-- Progress bar -->
            <div class="mt-2">
              <div class="flex justify-between text-xs mb-1">
                <span class="text-gray-400">Top ${percentage}%</span>
                <span class="text-orange-400">#${userRank}</span>
              </div>
              <div class="w-full bg-zinc-700 rounded-full h-2">
                <div class="bg-gradient-to-r from-orange-500 to-amber-400 h-2 rounded-full" style="width: ${progressWidth}%"></div>
              </div>
              <div class="flex justify-between text-[10px] text-gray-500 mt-1">
                <span>#1</span>
                <span>#${totalRunners}</span>
              </div>
            </div>
          </div>
        `;
      } catch (error) {
        console.error('Error loading sidebar ranking:', error);
        sidebarRanking.innerHTML = `
          <div class="text-center py-2">
            <p class="text-xs text-gray-400">Error loading ranking</p>
          </div>
        `;
      }
    }

    // Load sidebar medals progress
    function loadSidebarMedals() {
      const sidebarMedals = document.getElementById('sidebarMedals');
      if (!sidebarMedals) return;

      try {
        const totalDistance = parseFloat(currentUser.total_distance) || 0;
        const medalGoals = [
          { distance: 50, name: "Bronze", color: "bronze", icon: "fas fa-medal" },
          { distance: 100, name: "Silver", color: "silver", icon: "fas fa-medal" },
          { distance: 250, name: "Gold", color: "gold", icon: "fas fa-medal" },
          { distance: 500, name: "Platinum", color: "platinum", icon: "fas fa-gem" },
          { distance: 1000, name: "Diamond", color: "diamond", icon: "fas fa-gem" }
        ];

        let medalsHTML = '';
        
        medalGoals.forEach(medal => {
          const progress = Math.min(100, Math.round((totalDistance / medal.distance) * 100));
          const isEarned = totalDistance >= medal.distance;
          const isCurrent = totalDistance < medal.distance && 
                          (medalGoals.indexOf(medal) === 0 || 
                           totalDistance >= medalGoals[medalGoals.indexOf(medal) - 1].distance);
          
          medalsHTML += `
            <div class="medal-progress-item">
              <div class="flex items-center gap-3">
                <div class="medal-icon ${isEarned ? `medal-${medal.color}` : 'bg-zinc-700'}">
                  <i class="${medal.icon} ${isEarned ? 'text-white' : 'text-gray-500'}"></i>
                </div>
                <div class="flex-1">
                  <p class="text-xs font-medium text-white">${medal.name}</p>
                  <p class="text-[10px] text-gray-400">${medal.distance} km</p>
                </div>
              </div>
              <div class="text-right">
                <p class="text-xs font-bold ${isEarned ? 'text-green-400' : isCurrent ? 'text-orange-400' : 'text-gray-400'}">
                  ${isEarned ? 'Earned' : `${progress}%`}
                </p>
                <p class="text-[10px] text-gray-500">${isEarned ? '‚úì' : `${formatNumber(totalDistance, 1)}/${medal.distance}`}</p>
              </div>
            </div>
            
            <div class="progress-bar-container">
              <div class="progress-bar-fill" style="width: ${progress}%"></div>
            </div>
          `;
        });

        sidebarMedals.innerHTML = medalsHTML;
      } catch (error) {
        console.error('Error loading sidebar medals:', error);
        sidebarMedals.innerHTML = `
          <div class="text-center py-2">
            <p class="text-xs text-gray-400">Error loading medals</p>
          </div>
        `;
      }
    }

    // Content Renderer for Runners
    function renderContent() {
      const content = document.getElementById('content');
      if (!content) return;

      switch (activeTab) {
        case 'dashboard':
          renderDashboard(content);
          break;
        case 'feed':
          renderActivityFeed(content);
          break;
        case 'ranking':
          renderRanking(content);
          break;
        case 'activities':
          renderMyActivities(content);
          break;
        default:
          renderDashboard(content);
      }

      // Update sidebar buttons
      updateSidebarButtons();
    }

    // Content Renderer for Admin
    function renderAdminContent() {
      const content = document.getElementById('content');
      if (!content) return;

      switch (activeTab) {
        case 'adminDashboard':
          renderAdminDashboardContent(content);
          break;
        case 'manageRunners':
          renderManageRunners(content);
          break;
        case 'manageActivities':
          renderManageActivities(content);
          break;
        case 'pendingApprovals':
          renderPendingApprovals(content);
          break;
        case 'adminReports':
          renderAdminReports(content);
          break;
        default:
          renderAdminDashboardContent(content);
      }

      // Update sidebar buttons
      updateSidebarButtons();
    }

    // Dashboard Component for Runners
    async function renderDashboard(container) {
      // Fetch user stats from Firebase
      const snapshot = await db.ref(`runners/${currentUser.bib_number}`).once('value');
      const userData = snapshot.val() || currentUser;

      // Get all runners for filter
      let allRunners = [];
      try {
        const runnersSnapshot = await db.ref('runners').once('value');
        runnersSnapshot.forEach(childSnapshot => {
          const runner = childSnapshot.val();
          allRunners.push({
            bib_number: runner.bib_number,
            name: runner.name,
            nickname: runner.nickname,
            total_distance: parseFloat(runner.total_distance) || 0
          });
        });
        
        // Sort runners by name for dropdown
        allRunners.sort((a, b) => a.name.localeCompare(b.name));
      } catch (error) {
        console.log('Error fetching runners:', error);
      }

      container.innerHTML = `
        <div class="space-y-4 sm:space-y-6 animate-fadeIn">
          <!-- Digital Bib Card -->
          <div class="rounded-3xl p-4 sm:p-6 relative overflow-hidden border-4 border-orange-600/50" style="background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('${BIB_BACKGROUND}') center/cover no-repeat;">
            <div class="relative z-10">
              <div class="flex flex-col md:flex-row md:items-center justify-between gap-3 sm:gap-4">
                <div class="flex-1">
                  <p class="text-[10px] font-black text-orange-400 uppercase tracking-widest mb-1">Official Digital Bib</p>
                  <div class="bib-number text-3xl sm:text-4xl md:text-5xl font-black text-white mb-2">${currentUser.bib_number}</div>
                  <div class="flex items-center gap-3">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white text-xs sm:text-sm font-bold">
                      ${currentUser.nickname ? currentUser.nickname.substring(0, 2).toUpperCase() : 'RU'}
                    </div>
                    <div>
                      <p class="text-sm font-bold text-white">${currentUser.name}</p>
                      <p class="text-xs text-orange-300">"${currentUser.nickname}"</p>
                      ${currentUser.goal ? `
                        <div class="mt-1">
                          <p class="text-xs text-orange-200">Goal: <span class="font-bold">${currentUser.goal}</span></p>
                          <div class="w-32 bg-white/20 rounded-full h-1.5 mt-0.5">
                            <div class="bg-orange-500 h-1.5 rounded-full" style="width: ${Math.min(100, ((currentUser.total_distance || 0) / parseInt(currentUser.goal)) * 100)}%"></div>
                          </div>
                        </div>
                      ` : ''}
                    </div>
                  </div>
                </div>
                <div class="flex flex-col items-center mt-3 md:mt-0">
                  <div class="w-12 h-12 sm:w-16 sm:h-16 md:w-20 md:h-20 bg-gradient-to-tr from-orange-600/20 to-amber-500/20 rounded-2xl flex items-center justify-center mb-2 backdrop-blur-sm border border-orange-500/30">
                    <i class="fas fa-running text-xl sm:text-2xl md:text-3xl text-orange-400"></i>
                  </div>
                  <p class="text-[10px] font-black text-orange-300 uppercase tracking-widest">Active Runner</p>
                </div>
              </div>
              
              <!-- Total Distance -->
              <div class="mt-4 sm:mt-6 pt-3 sm:pt-4 border-t border-orange-500/30">
                <div class="text-center mb-3">
                  <p class="text-xs text-orange-300 uppercase tracking-widest font-bold mb-1">Cumulative Distance</p>
                  <div class="text-2xl sm:text-3xl md:text-4xl font-black text-white">${formatNumber(currentUser.total_distance || 0, 1)} <span class="text-base sm:text-lg text-orange-300">km</span></div>
                </div>
                
                <div class="space-y-2">
                  <div class="flex justify-between text-xs">
                    <span class="text-orange-300">Progress to Goal</span>
                    <span class="text-white font-bold">${currentUser.goal ? Math.min(100, Math.round((parseFloat(currentUser.total_distance) || 0) / parseInt(currentUser.goal) * 100)) : 0}%</span>
                  </div>
                  <div class="w-full bg-white/10 rounded-full h-2">
                    <div class="bg-gradient-to-r from-orange-500 to-amber-400 h-2 rounded-full" style="width: ${currentUser.goal ? Math.min(100, ((parseFloat(currentUser.total_distance) || 0) / parseInt(currentUser.goal) * 100)) : 0}%"></div>
                  </div>
                  <div class="flex justify-between text-[10px] text-orange-300">
                    <span>0 km</span>
                    <span>${currentUser.goal || '100'} km</span>
                  </div>
                </div>
              </div>
              
              <div class="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-orange-500/30">
                <div class="flex items-center justify-between">
                  <div class="text-center">
                    <p class="text-[10px] text-orange-300 uppercase tracking-widest">Status</p>
                    <div class="flex items-center gap-1.5 mt-1">
                      <div class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-green-500 rounded-full animate-pulse"></div>
                      <p class="text-xs font-bold text-white">ACTIVE</p>
                    </div>
                  </div>
                  <div class="text-center">
                    <p class="text-[10px] text-orange-300 uppercase tracking-widest">Joined</p>
                    <p class="text-xs font-bold text-white">${new Date(currentUser.registration_date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' })}</p>
                  </div>
                  <div class="text-center">
                    <p class="text-[10px] text-orange-300 uppercase tracking-widest">Contact</p>
                    <p class="text-xs font-bold text-white truncate max-w-[80px] sm:max-w-[100px]">${currentUser.contact}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Welcome Message -->
          <div>
            <h2 class="text-xl sm:text-2xl md:text-3xl font-black tracking-tight dark:text-white">Welcome back, ${currentUser.nickname}! üèÉ‚Äç‚ôÇÔ∏è</h2>
            <p class="text-gray-500 dark:text-gray-400 font-medium text-sm sm:text-base">Keep pushing your limits!</p>
          </div>

          <!-- Filters Section -->
          <div class="bg-white dark:bg-zinc-800 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700">
            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 mb-4">
              <!-- Date Filter with Calendar Background -->
              <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Filter by Date</label>
                <div class="calendar-container">
                  <div class="calendar-input flex items-center justify-between calendar-bg">
                    <span id="selectedDateDisplay" class="text-white">${formatDate(selectedDate)}</span>
                    <i class="fas fa-calendar-alt text-orange-400"></i>
                  </div>
                </div>
              </div>
              
              <!-- Runner Filter -->
              <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Filter by Runner</label>
                <select 
                  id="runnerFilter"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-orange-600 dark:text-white"
                >
                  <option value="all">All Runners</option>
                  ${allRunners.map(runner => `
                    <option value="${runner.bib_number}" ${filterRunner === runner.bib_number ? 'selected' : ''}>
                      ${runner.name} (${runner.bib_number})
                    </option>
                  `).join('')}
                </select>
              </div>
            </div>
            
            <!-- Apply Filter Button -->
            <button 
              id="applyFilter"
              class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2"
            >
              <i class="fas fa-filter"></i>
              APPLY FILTERS
            </button>
          </div>

          <!-- Filtered Results -->
          <div id="filteredResults" class="bg-white dark:bg-zinc-800 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold dark:text-white">Filtered Activities</h3>
              <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                <span class="text-xs text-gray-500 dark:text-gray-400">Live Results</span>
              </div>
            </div>
            <div id="filteredActivitiesList" class="space-y-3">
              <div class="text-center py-6">
                <div class="inline-block animate-spin rounded-full h-6 w-6 border-2 border-orange-600 border-t-transparent"></div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading filtered activities...</p>
              </div>
            </div>
          </div>

          <!-- Stats Grid -->
          <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-4 gap-3 sm:gap-4">
            <div class="bg-white dark:bg-zinc-800 p-3 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700 hover:shadow-md transition-shadow group">
              <div class="bg-orange-600 w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex items-center justify-center text-white mb-2 sm:mb-3 group-hover:scale-110 transition-transform">
                <i class="fas fa-running text-sm sm:text-base"></i>
              </div>
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Runs</p>
              <p class="text-lg sm:text-xl font-black mt-1 dark:text-white">${userData.total_runs || 0}</p>
            </div>
            <div class="bg-white dark:bg-zinc-800 p-3 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700 hover:shadow-md transition-shadow group">
              <div class="bg-blue-600 w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex items-center justify-center text-white mb-2 sm:mb-3 group-hover:scale-110 transition-transform">
                <i class="fas fa-route text-sm sm:text-base"></i>
              </div>
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Distance</p>
              <p class="text-lg sm:text-xl font-black mt-1 dark:text-white">${formatNumber(userData.total_distance || 0, 1)} km</p>
            </div>
            <div class="bg-white dark:bg-zinc-800 p-3 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700 hover:shadow-md transition-shadow group">
              <div class="bg-green-600 w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex items-center justify-center text-white mb-2 sm:mb-3 group-hover:scale-110 transition-transform">
                <i class="fas fa-users text-sm sm:text-base"></i>
              </div>
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Runners</p>
              <p class="text-lg sm:text-xl font-black mt-1 dark:text-white">${allRunners.length}</p>
            </div>
            <div class="bg-white dark:bg-zinc-800 p-3 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700 hover:shadow-md transition-shadow group">
              <div class="bg-purple-600 w-8 h-8 sm:w-10 sm:h-10 rounded-xl sm:rounded-2xl flex items-center justify-center text-white mb-2 sm:mb-3 group-hover:scale-110 transition-transform">
                <i class="fas fa-tachometer-alt text-sm sm:text-base"></i>
              </div>
              <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Avg Pace</p>
              <p class="text-lg sm:text-xl font-black mt-1 dark:text-white">${formatNumber(userData.avg_pace || 0, 1)} min/km</p>
            </div>
          </div>

          <!-- Additional Info Section -->
          <div class="bg-gradient-to-r from-orange-600 to-amber-500 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-lg text-white">
            <div class="flex items-center justify-between">
              <div>
                <h3 class="text-lg font-black mb-1">Ready for Your Next Run?</h3>
                <p class="text-sm text-orange-100">Log your activity and join the leaderboard!</p>
              </div>
              <button 
                id="quickLogActivity"
                class="bg-white text-orange-600 hover:bg-orange-50 font-bold px-4 py-2 rounded-xl transition-all"
              >
                Log Activity
              </button>
            </div>
          </div>
        </div>
      `;

      // Load filtered activities
      loadFilteredActivities();
      
      // Add event listeners
      document.getElementById('applyFilter').addEventListener('click', () => {
        filterRunner = document.getElementById('runnerFilter').value;
        loadFilteredActivities();
      });
      
      document.getElementById('runnerFilter').addEventListener('change', (e) => {
        filterRunner = e.target.value;
      });
      
      document.getElementById('quickLogActivity').addEventListener('click', () => {
        isLogActivityModalOpen = true;
        renderLogActivityModal();
      });
      
      // Calendar click event
      document.querySelector('.calendar-input').addEventListener('click', () => {
        showCalendarModal('filter');
      });
    }

    // Show Calendar Modal
    function showCalendarModal(type) {
      const modal = document.createElement('div');
      modal.className = 'calendar-modal animate-fadeIn';
      modal.innerHTML = `
        <div class="calendar-modal-content">
          <div class="p-4">
            <div class="flex items-center justify-between mb-4 calendar-modal-header">
              <h3 class="text-lg font-bold text-white">Select Date</h3>
              <button id="closeCalendarModal" class="p-2 hover:bg-white/10 rounded-full text-white">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div id="calendarContent"></div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Initialize calendar
      initializeCalendarModal(type, modal);
      
      // Close modal
      modal.querySelector('#closeCalendarModal').addEventListener('click', () => {
        document.body.removeChild(modal);
      });
      
      // Close when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
        }
      });
    }

    // Initialize Calendar Modal
    async function initializeCalendarModal(type, modal) {
      const calendarContent = modal.querySelector('#calendarContent');
      let currentMonthYear = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);
      
      async function updateCalendar() {
        // Update month display
        const monthYear = currentMonthYear.toLocaleDateString('en-GB', { 
          month: 'long', 
          year: 'numeric' 
        });
        
        // Get activities for the month
        const activities = await getActivitiesForMonth(currentMonthYear.getFullYear(), currentMonthYear.getMonth() + 1);
        const activityDays = new Set();
        const finishedDays = new Set();
        
        activities.forEach(activity => {
          const activityDate = new Date(activity.date);
          activityDays.add(activityDate.getDate());
          
          // Check if activity is approved (finished)
          if (activity.status === 'approved') {
            finishedDays.add(activityDate.getDate());
          }
          
          // Check if activity has logo (current user's activities)
          if (activity.bib_number === currentUser.bib_number && activity.status === 'approved') {
            // This will be handled by the CSS class
          }
        });
        
        calendarContent.innerHTML = `
          <div class="calendar-header calendar-modal-header">
            <button id="prevMonth" class="p-2 hover:bg-white/10 rounded text-white">
              <i class="fas fa-chevron-left"></i>
            </button>
            <h3 class="font-bold text-white">${monthYear}</h3>
            <button id="nextMonth" class="p-2 hover:bg-white/10 rounded text-white">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
          <div class="calendar-grid" id="calendarDaysModal"></div>
        `;
        
        const calendarDays = calendarContent.querySelector('#calendarDaysModal');
        
        // Add day headers
        const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        days.forEach(day => {
          const dayElement = document.createElement('div');
          dayElement.className = 'text-center text-xs font-bold text-white/70';
          dayElement.textContent = day;
          calendarDays.appendChild(dayElement);
        });
        
        // Get first day of month
        const firstDay = new Date(currentMonthYear.getFullYear(), currentMonthYear.getMonth(), 1);
        const lastDay = new Date(currentMonthYear.getFullYear(), currentMonthYear.getMonth() + 1, 0);
        
        // Add empty cells for days before first day of month
        for (let i = 0; i < firstDay.getDay(); i++) {
          const emptyElement = document.createElement('div');
          emptyElement.className = 'calendar-modal-day disabled';
          calendarDays.appendChild(emptyElement);
        }
        
        // Add days of month
        for (let i = 1; i <= lastDay.getDate(); i++) {
          const dayDate = new Date(currentMonthYear.getFullYear(), currentMonthYear.getMonth(), i);
          const dayElement = document.createElement('div');
          dayElement.className = 'calendar-modal-day';
          
          // Check if this day has activities
          if (activityDays.has(i)) {
            dayElement.classList.add('has-activity');
          }
          
          // Check if this day has finished activities
          if (finishedDays.has(i)) {
            dayElement.classList.add('finished');
          }
          
          // Check if this day has current user's activities with logo
          const hasUserActivity = activities.some(activity => {
            const activityDate = new Date(activity.date);
            return activityDate.getDate() === i && 
                   activity.bib_number === currentUser.bib_number && 
                   activity.status === 'approved';
          });
          
          if (hasUserActivity) {
            dayElement.classList.add('has-logo');
          }
          
          // Check if this is the selected date
          const isSelected = selectedDate && 
            dayDate.getDate() === selectedDate.getDate() &&
            dayDate.getMonth() === selectedDate.getMonth() &&
            dayDate.getFullYear() === selectedDate.getFullYear();
          
          if (isSelected) {
            dayElement.classList.add('selected');
          }
          
          dayElement.textContent = i;
          dayElement.addEventListener('click', () => {
            selectedDate = dayDate;
            if (type === 'filter') {
              document.getElementById('selectedDateDisplay').textContent = formatDate(selectedDate);
              loadFilteredActivities();
            } else if (type === 'feed') {
              document.getElementById('feedDateDisplay').textContent = formatDate(selectedDate);
              loadActivityFeed();
            }
            document.body.removeChild(modal);
          });
          calendarDays.appendChild(dayElement);
        }
        
        // Add event listeners for prev/next buttons
        calendarContent.querySelector('#prevMonth').addEventListener('click', () => {
          currentMonthYear.setMonth(currentMonthYear.getMonth() - 1);
          updateCalendar();
        });
        
        calendarContent.querySelector('#nextMonth').addEventListener('click', () => {
          currentMonthYear.setMonth(currentMonthYear.getMonth() + 1);
          updateCalendar();
        });
      }
      
      // Get activities for a specific month
      async function getActivitiesForMonth(year, month) {
        try {
          const snapshot = await db.ref('running_logs').once('value');
          const activities = [];
          
          snapshot.forEach(childSnapshot => {
            const activity = childSnapshot.val();
            const activityDate = new Date(activity.date);
            
            if (activityDate.getFullYear() === year && activityDate.getMonth() + 1 === month) {
              activities.push(activity);
            }
          });
          
          return activities;
        } catch (error) {
          console.error('Error getting activities for month:', error);
          return [];
        }
      }
      
      // Initialize calendar
      updateCalendar();
    }

    // Admin Dashboard Content
    async function renderAdminDashboardContent(container) {
      // Load admin stats
      let totalRunners = 0;
      let pendingActivities = 0;
      let totalDistance = 0;
      let recentActivities = [];

      try {
        // Get runners count
        const runnersSnapshot = await db.ref('runners').once('value');
        totalRunners = runnersSnapshot.numChildren();
        
        // Get activities stats
        const activitiesSnapshot = await db.ref('running_logs').once('value');
        activitiesSnapshot.forEach(childSnapshot => {
          const activity = childSnapshot.val();
          
          // Count pending activities
          if (activity.status === 'pending') {
            pendingActivities++;
          }
          
          // Calculate total distance
          if (activity.distance && activity.status === 'approved') {
            totalDistance += parseFloat(activity.distance) || 0;
          }
          
          // Get recent activities
          recentActivities.push({
            id: childSnapshot.key,
            ...activity
          });
        });
        
        // Sort activities by date
        recentActivities.sort((a, b) => new Date(b.date) - new Date(a.date));
        recentActivities = recentActivities.slice(0, 5);
        
      } catch (error) {
        console.error('Error loading admin stats:', error);
      }

      // Update sidebar stats
      setTimeout(() => {
        const adminTotalRunners = document.getElementById('adminTotalRunners');
        const adminPendingActivities = document.getElementById('adminPendingActivities');
        const adminTotalDistance = document.getElementById('adminTotalDistance');
        
        if (adminTotalRunners) adminTotalRunners.textContent = totalRunners;
        if (adminPendingActivities) adminPendingActivities.textContent = pendingActivities;
        if (adminTotalDistance) adminTotalDistance.textContent = `${formatNumber(totalDistance, 1)} km`;
      }, 100);

      container.innerHTML = `
        <div class="space-y-4 sm:space-y-6 animate-fadeIn">
          <!-- Admin Welcome -->
          <div>
            <h2 class="text-xl sm:text-2xl md:text-3xl font-black tracking-tight dark:text-white">Welcome, Administrator! <i class="fas fa-user-shield text-red-600"></i></h2>
            <p class="text-gray-500 dark:text-gray-400 font-medium text-sm sm:text-base">Roadha Run Administration Dashboard</p>
          </div>

          <!-- Admin Stats Grid -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
            <div class="bg-gradient-to-br from-red-600 to-red-700 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-lg text-white">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-red-200">Total Runners</p>
                  <p class="text-2xl sm:text-3xl font-black mt-1">${totalRunners}</p>
                </div>
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                  <i class="fas fa-users text-lg sm:text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-yellow-600 to-yellow-700 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-lg text-white">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-yellow-200">Pending Approvals</p>
                  <p class="text-2xl sm:text-3xl font-black mt-1">${pendingActivities}</p>
                </div>
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                  <i class="fas fa-clock text-lg sm:text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-green-600 to-green-700 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-lg text-white">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-green-200">Total Distance</p>
                  <p class="text-2xl sm:text-3xl font-black mt-1">${formatNumber(totalDistance, 1)} km</p>
                </div>
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                  <i class="fas fa-route text-lg sm:text-xl"></i>
                </div>
              </div>
            </div>
            <div class="bg-gradient-to-br from-blue-600 to-blue-700 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-lg text-white">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-blue-200">Active Today</p>
                  <p class="text-2xl sm:text-3xl font-black mt-1">${recentActivities.length}</p>
                </div>
                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-2xl flex items-center justify-center">
                  <i class="fas fa-running text-lg sm:text-xl"></i>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="bg-white dark:bg-zinc-800 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700">
            <h3 class="font-bold dark:text-white mb-4">Quick Actions</h3>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
              <button 
                data-tab="pendingApprovals"
                class="p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-xl border border-yellow-200 dark:border-yellow-700 hover:bg-yellow-100 dark:hover:bg-yellow-900/30 transition-colors text-left"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-yellow-100 dark:bg-yellow-800 flex items-center justify-center">
                    <i class="fas fa-clock text-yellow-600 dark:text-yellow-400"></i>
                  </div>
                  <div>
                    <p class="font-bold dark:text-white">Review Pending</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">${pendingActivities} activities</p>
                  </div>
                </div>
              </button>
              <button 
                data-tab="manageRunners"
                class="p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-700 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors text-left"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-800 flex items-center justify-center">
                    <i class="fas fa-users text-blue-600 dark:text-blue-400"></i>
                  </div>
                  <div>
                    <p class="font-bold dark:text-white">Manage Runners</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">${totalRunners} runners</p>
                  </div>
                </div>
              </button>
              <button 
                id="adminLogActivity"
                class="p-4 bg-green-50 dark:bg-green-900/20 rounded-xl border border-green-200 dark:border-green-700 hover:bg-green-100 dark:hover:bg-green-900/30 transition-colors text-left"
              >
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-lg bg-green-100 dark:bg-green-800 flex items-center justify-center">
                    <i class="fas fa-plus text-green-600 dark:text-green-400"></i>
                  </div>
                  <div>
                    <p class="font-bold dark:text-white">Log Activity</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">For any runner</p>
                  </div>
                </div>
              </button>
            </div>
          </div>

          <!-- Recent Activities -->
          <div class="bg-white dark:bg-zinc-800 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold dark:text-white">Recent Activities</h3>
              <button 
                data-tab="manageActivities"
                class="text-sm text-red-600 dark:text-red-400 font-bold hover:underline"
              >
                View All
              </button>
            </div>
            <div class="space-y-3">
              ${recentActivities.length > 0 ? recentActivities.map(activity => {
                const activityDate = new Date(activity.date);
                const formattedDate = activityDate.toLocaleDateString('en-GB', { 
                  day: 'numeric', 
                  month: 'short' 
                });
                
                return `
                  <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-zinc-700/50 rounded-xl">
                    <div class="flex items-center gap-3">
                      <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white text-xs font-bold">
                        ${activity.nickname ? activity.nickname.substring(0, 2).toUpperCase() : 'RU'}
                      </div>
                      <div>
                        <p class="text-sm font-bold dark:text-white">${activity.nickname || activity.runner_name}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${activity.bib_number} ‚Ä¢ ${formattedDate}</p>
                      </div>
                    </div>
                    <div class="text-right">
                      <p class="text-sm font-bold dark:text-white">${activity.distance} km</p>
                      <span class="px-2 py-1 rounded-full text-xs font-bold ${
                        activity.status === 'approved' ? 'status-approved' : 
                        activity.status === 'pending' ? 'status-pending' : 
                        'status-rejected'
                      }">
                        ${activity.status || 'pending'}
                      </span>
                    </div>
                  </div>
                `;
              }).join('') : `
                <div class="text-center py-6">
                  <p class="text-gray-500 dark:text-gray-400">No recent activities found</p>
                </div>
              `}
            </div>
          </div>
        </div>
      `;

      // Add event listeners for quick actions
      document.querySelectorAll('[data-tab]').forEach(btn => {
        btn.addEventListener('click', () => {
          activeTab = btn.dataset.tab;
          renderAdminContent();
        });
      });
      
      // Add event listener for admin log activity
      document.getElementById('adminLogActivity').addEventListener('click', () => {
        isLogActivityModalOpen = true;
        renderAdminLogActivityModal();
      });
    }

    // Admin Log Activity Modal
    function renderAdminLogActivityModal() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-[999] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fadeIn';
      modal.innerHTML = `
        <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-zinc-700">
          <div class="p-4 sm:p-6">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
              <h2 class="text-xl font-black dark:text-white">Log Activity (Admin)</h2>
              <button id="closeModal" class="p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full text-gray-400">
                <i class="fas fa-times text-lg"></i>
              </button>
            </div>
            
            <form id="adminLogActivityForm" class="space-y-4 sm:space-y-5">
              <!-- Runner Selection -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Select Runner</label>
                <select 
                  id="runnerSelect"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                >
                  <option value="">Select a runner</option>
                </select>
              </div>
              
              <!-- Activity Type -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Activity Type</label>
                <div class="grid grid-cols-2 gap-2">
                  <button type="button" data-type="run" class="activity-type-btn flex items-center justify-center gap-2 p-3 rounded-xl border-2 border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-400 transition-all">
                    <i class="fas fa-running"></i>
                    <span class="font-bold">Run</span>
                  </button>
                  <button type="button" data-type="walk" class="activity-type-btn flex items-center justify-center gap-2 p-3 rounded-xl border-2 border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-400 transition-all">
                    <i class="fas fa-walking"></i>
                    <span class="font-bold">Walk</span>
                  </button>
                </div>
              </div>
              
              <!-- Date -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Date</label>
                <input 
                  type="date" 
                  id="activityDate"
                  value="${new Date().toISOString().split('T')[0]}"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                  required
                />
              </div>
              
              <!-- Distance -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Distance (km)</label>
                <input 
                  type="number" 
                  step="0.01"
                  min="0.01"
                  id="distance"
                  placeholder="e.g., 5.25"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                  required
                />
              </div>
              
              <!-- Duration -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Duration</label>
                <div class="time-input-group">
                  <div class="time-input">
                    <label class="text-xs text-gray-500 dark:text-gray-400">Hours</label>
                    <input 
                      type="number" 
                      id="hours"
                      min="0"
                      value="0"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                    />
                  </div>
                  <div class="time-input">
                    <label class="text-xs text-gray-500 dark:text-gray-400">Minutes</label>
                    <input 
                      type="number" 
                      id="minutes"
                      min="0"
                      max="59"
                      value="30"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                    />
                  </div>
                  <div class="time-input">
                    <label class="text-xs text-gray-500 dark:text-gray-400">Seconds</label>
                    <input 
                      type="number" 
                      id="seconds"
                      min="0"
                      max="59"
                      value="0"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                    />
                  </div>
                </div>
              </div>
              
              <!-- Pace -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Average Pace (min/km)</label>
                <input 
                  type="number" 
                  step="0.01"
                  id="pace"
                  placeholder="e.g., 6.25"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                  required
                />
              </div>
              
              <!-- Notes -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Notes (Optional)</label>
                <textarea 
                  id="notes"
                  rows="3"
                  placeholder="Activity notes..."
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                ></textarea>
              </div>
              
              <!-- Status -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Status</label>
                <select 
                  id="activityStatus"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                >
                  <option value="approved">Approved</option>
                  <option value="pending">Pending</option>
                  <option value="rejected">Rejected</option>
                </select>
              </div>
              
              <!-- Submit Button -->
              <button 
                type="submit"
                id="submitActivityBtn"
                class="w-full bg-red-600 hover:bg-red-700 text-white font-black py-3 sm:py-4 rounded-xl shadow-xl shadow-red-600/20 transition-all flex items-center justify-center gap-2"
              >
                <i class="fas fa-plus"></i>
                SUBMIT ACTIVITY
              </button>
            </form>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Add event listeners
      const closeBtn = modal.querySelector('#closeModal');
      const activityTypeBtns = modal.querySelectorAll('.activity-type-btn');
      const form = modal.querySelector('#adminLogActivityForm');
      const runnerSelect = modal.querySelector('#runnerSelect');
      
      let selectedActivityType = 'run';
      
      // Set initial activity type
      activityTypeBtns[0].classList.add('active', 'border-red-600', 'text-red-600');
      
      // Load runners
      loadRunnersForAdminLog(runnerSelect);
      
      // Activity type selection
      activityTypeBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          selectedActivityType = btn.dataset.type;
          activityTypeBtns.forEach(b => {
            b.classList.remove('active', 'border-red-600', 'text-red-600');
          });
          btn.classList.add('active', 'border-red-600', 'text-red-600');
        });
      });
      
      // Close modal
      closeBtn.addEventListener('click', () => {
        document.body.removeChild(modal);
        isLogActivityModalOpen = false;
      });
      
      // Form submission
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = modal.querySelector('#submitActivityBtn');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="inline-block animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div> Processing...';
        
        try {
          // Validate inputs
          const runnerBib = runnerSelect.value;
          const distance = parseFloat(modal.querySelector('#distance').value);
          const hours = parseInt(modal.querySelector('#hours').value) || 0;
          const minutes = parseInt(modal.querySelector('#minutes').value) || 0;
          const seconds = parseInt(modal.querySelector('#seconds').value) || 0;
          const pace = parseFloat(modal.querySelector('#pace').value);
          const date = modal.querySelector('#activityDate').value;
          const notes = modal.querySelector('#notes').value;
          const status = modal.querySelector('#activityStatus').value;
          
          if (!runnerBib || !distance || isNaN(distance) || !pace || isNaN(pace) || !date) {
            throw new Error('Please fill all required fields with valid numbers');
          }
          
          // Get runner info
          const runnerSnapshot = await db.ref(`runners/${runnerBib}`).once('value');
          const runner = runnerSnapshot.val();
          
          if (!runner) {
            throw new Error('Runner not found');
          }
          
          // Calculate total minutes
          const totalMinutes = hours * 60 + minutes + seconds / 60;
          
          // Save activity to database
          const activityData = {
            bib_number: runnerBib,
            runner_name: runner.name,
            nickname: runner.nickname,
            date: date,
            distance: distance.toFixed(2),
            duration: totalMinutes.toFixed(2),
            pace: pace.toFixed(2),
            activity_type: selectedActivityType,
            notes: notes || null,
            status: status,
            submission_date: new Date().toISOString(),
            reviewed_date: new Date().toISOString(),
            reviewed_by: 'admin',
            likes: 0,
            liked_by: []
          };
          
          const activityRef = await db.ref('running_logs').push(activityData);
          
          // Update runner stats if approved
          if (status === 'approved') {
            const newTotalRuns = (runner.total_runs || 0) + 1;
            const newTotalDistance = (parseFloat(runner.total_distance) || 0) + distance;
            const newAvgPace = ((parseFloat(runner.avg_pace) || 0) * (newTotalRuns - 1) + pace) / newTotalRuns;
            
            await db.ref(`runners/${runnerBib}`).update({
              total_runs: newTotalRuns,
              total_distance: newTotalDistance,
              avg_pace: newAvgPace.toFixed(2),
              last_activity_date: date
            });
          }
          
          alert('Activity logged successfully!');
          
          // Close modal
          document.body.removeChild(modal);
          isLogActivityModalOpen = false;
          
        } catch (error) {
          alert('Error: ' + error.message);
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;
        }
      });
      
      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
          isLogActivityModalOpen = false;
        }
      });
    }

    // Load runners for admin log activity
    async function loadRunnersForAdminLog(selectElement) {
      try {
        const snapshot = await db.ref('runners').once('value');
        const runners = [];
        
        snapshot.forEach(childSnapshot => {
          const runner = childSnapshot.val();
          runners.push(runner);
        });

        // Sort by name
        runners.sort((a, b) => a.name.localeCompare(b.name));
        
        selectElement.innerHTML = `
          <option value="">Select a runner</option>
          ${runners.map(runner => `
            <option value="${runner.bib_number}">
              ${runner.name} (${runner.bib_number}) - Goal: ${runner.goal || 'Not set'}
            </option>
          `).join('')}
        `;
        
      } catch (error) {
        console.error('Error loading runners:', error);
        selectElement.innerHTML = '<option value="">Error loading runners</option>';
      }
    }

    // Manage Runners Component
    async function renderManageRunners(container) {
      container.innerHTML = `
        <div class="animate-fadeIn">
          <div class="flex justify-between items-center mb-4 sm:mb-6">
            <div>
              <h2 class="text-xl sm:text-2xl font-black tracking-tight dark:text-white">Manage Runners</h2>
              <p class="text-gray-500 dark:text-gray-400 text-sm">View and manage all registered runners</p>
            </div>
            <button 
              id="refreshRunners"
              class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-xl transition-all flex items-center gap-2"
            >
              <i class="fas fa-sync-alt"></i>
              Refresh
            </button>
          </div>
          
          <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-200 dark:border-zinc-700 overflow-hidden">
            <div class="p-3 sm:p-4 border-b border-gray-200 dark:border-zinc-700">
              <div class="grid grid-cols-12 gap-2 sm:gap-4 text-xs font-bold text-gray-500 dark:text-gray-400 uppercase">
                <div class="col-span-2 sm:col-span-1">#</div>
                <div class="col-span-4 sm:col-span-3">Runner</div>
                <div class="col-span-3 sm:col-span-2">Bib Number</div>
                <div class="col-span-3 sm:col-span-2 text-center">Goal</div>
                <div class="col-span-3 sm:col-span-2 text-center">Distance</div>
                <div class="hidden sm:block col-span-2 text-center">Actions</div>
              </div>
            </div>
            <div id="runnersList" class="divide-y divide-gray-100 dark:divide-zinc-700">
              <div class="p-4 text-center">
                <div class="inline-block animate-spin rounded-full h-6 w-6 border-2 border-red-600 border-t-transparent"></div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading runners...</p>
              </div>
            </div>
          </div>
        </div>
      `;

      // Load runners
      loadRunnersList();

      // Refresh button
      document.getElementById('refreshRunners').addEventListener('click', loadRunnersList);
    }

    // Load runners list for admin
    async function loadRunnersList() {
      const runnersList = document.getElementById('runnersList');
      if (!runnersList) return;

      try {
        const snapshot = await db.ref('runners').once('value');
        const runners = [];
        
        snapshot.forEach(childSnapshot => {
          const runner = childSnapshot.val();
          runners.push(runner);
        });

        // Sort by registration date (newest first)
        runners.sort((a, b) => new Date(b.registration_date) - new Date(a.registration_date));
        
        if (runners.length === 0) {
          runnersList.innerHTML = `
            <div class="p-6 sm:p-8 text-center">
              <p class="text-gray-500 dark:text-gray-400">No runners found</p>
            </div>
          `;
          return;
        }

        runnersList.innerHTML = runners.map((runner, index) => {
          const goalProgress = runner.goal ? Math.min(100, Math.round((parseFloat(runner.total_distance || 0) / parseInt(runner.goal)) * 100)) : 0;
          
          return `
            <div class="p-3 sm:p-4 hover:bg-gray-50 dark:hover:bg-zinc-700/50 transition-colors">
              <div class="grid grid-cols-12 gap-2 sm:gap-4 items-center">
                <div class="col-span-2 sm:col-span-1">
                  <div class="text-sm font-bold dark:text-white">${index + 1}</div>
                </div>
                <div class="col-span-4 sm:col-span-3">
                  <div class="flex items-center gap-2 sm:gap-3">
                    <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white text-xs sm:text-sm font-bold">
                      ${runner.nickname ? runner.nickname.substring(0, 2).toUpperCase() : 'RU'}
                    </div>
                    <div class="truncate">
                      <p class="font-bold dark:text-white text-xs sm:text-sm truncate">${runner.name}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400 truncate">"${runner.nickname}"</p>
                    </div>
                  </div>
                </div>
                <div class="col-span-3 sm:col-span-2">
                  <span class="bib-number font-bold text-xs sm:text-sm dark:text-white">${runner.bib_number}</span>
                </div>
                <div class="col-span-3 sm:col-span-2 text-center">
                  <p class="font-bold text-sm dark:text-white">${runner.goal || 'N/A'}</p>
                  <div class="w-full bg-gray-200 dark:bg-zinc-700 rounded-full h-1.5 mt-1">
                    <div class="bg-green-500 h-1.5 rounded-full" style="width: ${goalProgress}%"></div>
                  </div>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">${goalProgress}%</p>
                </div>
                <div class="col-span-3 sm:col-span-2 text-center">
                  <p class="font-bold text-sm sm:text-lg dark:text-white">${formatNumber(runner.total_distance || 0, 1)}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400 hidden sm:block">km</p>
                </div>
                <div class="hidden sm:block col-span-2">
                  <div class="flex items-center justify-center gap-2">
                    <button 
                      data-bib="${runner.bib_number}"
                      class="edit-runner-btn p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"
                      title="Edit Runner"
                    >
                      <i class="fas fa-edit"></i>
                    </button>
                    <button 
                      data-bib="${runner.bib_number}"
                      class="delete-runner-btn p-1.5 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg"
                      title="Delete Runner"
                    >
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
              
              <!-- Mobile Actions -->
              <div class="sm:hidden mt-3 pt-3 border-t border-gray-100 dark:border-zinc-700">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Runs: ${runner.total_runs || 0}</p>
                  </div>
                  <div class="flex items-center gap-2">
                    <button 
                      data-bib="${runner.bib_number}"
                      class="edit-runner-btn px-3 py-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg text-xs font-bold"
                    >
                      <i class="fas fa-edit mr-1"></i> Edit
                    </button>
                    <button 
                      data-bib="${runner.bib_number}"
                      class="delete-runner-btn px-3 py-1.5 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg text-xs font-bold"
                    >
                      <i class="fas fa-trash mr-1"></i> Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join('');

        // Add event listeners for buttons
        document.querySelectorAll('.edit-runner-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const bibNumber = btn.dataset.bib;
            editRunner(bibNumber);
          });
        });

        document.querySelectorAll('.delete-runner-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const bibNumber = btn.dataset.bib;
            deleteRunner(bibNumber);
          });
        });

      } catch (error) {
        console.error('Error loading runners:', error);
        runnersList.innerHTML = `
          <div class="p-4 sm:p-8 text-center">
            <p class="text-red-500">Error loading runners. Please try again.</p>
          </div>
        `;
      }
    }

    // Edit runner
    async function editRunner(bibNumber) {
      try {
        const snapshot = await db.ref(`runners/${bibNumber}`).once('value');
        const runner = snapshot.val();
        
        if (!runner) {
          alert('Runner not found');
          return;
        }

        // Create modal
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 z-[999] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fadeIn';
        modal.innerHTML = `
          <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-zinc-700">
            <div class="p-4 sm:p-6">
              <div class="flex items-center justify-between mb-4 sm:mb-6">
                <h2 class="text-xl font-black dark:text-white">Edit Runner: ${runner.bib_number}</h2>
                <button id="closeModal" class="p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full text-gray-400">
                  <i class="fas fa-times text-lg"></i>
                </button>
              </div>
              
              <form id="editRunnerForm" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Full Name</label>
                    <input 
                      type="text" 
                      id="editName"
                      value="${runner.name}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Nickname</label>
                    <input 
                      type="text" 
                      id="editNickname"
                      value="${runner.nickname}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Contact Number</label>
                    <input 
                      type="tel" 
                      id="editContact"
                      value="${runner.contact}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Password</label>
                    <input 
                      type="password" 
                      id="editPassword"
                      value="${runner.password}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Goal</label>
                    <select 
                      id="editGoal"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                    >
                      <option value="100km" ${runner.goal === '100km' ? 'selected' : ''}>100km</option>
                      <option value="180km" ${runner.goal === '180km' ? 'selected' : ''}>180km</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Total Runs</label>
                    <input 
                      type="number" 
                      id="editTotalRuns"
                      value="${runner.total_runs || 0}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Total Distance (km)</label>
                    <input 
                      type="number" 
                      step="0.1"
                      id="editTotalDistance"
                      value="${runner.total_distance || 0}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Avg Pace (min/km)</label>
                    <input 
                      type="number" 
                      step="0.1"
                      id="editAvgPace"
                      value="${runner.avg_pace || 0}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Status</label>
                    <select 
                      id="editStatus"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                    >
                      <option value="active" ${runner.status === 'active' ? 'selected' : ''}>Active</option>
                      <option value="inactive" ${runner.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                      <option value="suspended" ${runner.status === 'suspended' ? 'selected' : ''}>Suspended</option>
                    </select>
                  </div>
                </div>
                
                <div class="flex gap-3 mt-6">
                  <button 
                    type="submit"
                    class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl transition-all"
                  >
                    Update Runner
                  </button>
                  <button 
                    type="button"
                    id="cancelEdit"
                    class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-xl transition-all"
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        // Close modal
        modal.querySelector('#closeModal').addEventListener('click', () => {
          document.body.removeChild(modal);
        });
        
        modal.querySelector('#cancelEdit').addEventListener('click', () => {
          document.body.removeChild(modal);
        });
        
        // Form submission
        modal.querySelector('#editRunnerForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          
          try {
            const updates = {
              name: document.getElementById('editName').value,
              nickname: document.getElementById('editNickname').value,
              contact: document.getElementById('editContact').value,
              password: document.getElementById('editPassword').value,
              goal: document.getElementById('editGoal').value,
              total_runs: parseInt(document.getElementById('editTotalRuns').value),
              total_distance: parseFloat(document.getElementById('editTotalDistance').value),
              avg_pace: parseFloat(document.getElementById('editAvgPace').value),
              status: document.getElementById('editStatus').value,
              last_updated: new Date().toISOString(),
              updated_by: 'admin'
            };
            
            await db.ref(`runners/${bibNumber}`).update(updates);
            
            alert('Runner updated successfully!');
            document.body.removeChild(modal);
            loadRunnersList();
            
          } catch (error) {
            alert('Error updating runner: ' + error.message);
          }
        });
        
        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            document.body.removeChild(modal);
          }
        });
        
      } catch (error) {
        console.error('Error editing runner:', error);
        alert('Error loading runner details');
      }
    }

    // Delete runner
    async function deleteRunner(bibNumber) {
      if (!confirm(`Are you sure you want to delete runner ${bibNumber}? This action cannot be undone.`)) {
        return;
      }

      try {
        // Delete runner from database
        await db.ref(`runners/${bibNumber}`).remove();
        
        // Delete runner's activities
        const activitiesSnapshot = await db.ref('running_logs').orderByChild('bib_number').equalTo(bibNumber).once('value');
        const updates = {};
        activitiesSnapshot.forEach(childSnapshot => {
          updates[`running_logs/${childSnapshot.key}`] = null;
        });
        
        if (Object.keys(updates).length > 0) {
          await db.ref().update(updates);
        }
        
        alert(`Runner ${bibNumber} deleted successfully`);
        
        // Refresh runners list
        loadRunnersList();
        
      } catch (error) {
        console.error('Error deleting runner:', error);
        alert('Error deleting runner');
      }
    }

    // Manage Activities Component
    async function renderManageActivities(container) {
      container.innerHTML = `
        <div class="animate-fadeIn">
          <div class="flex justify-between items-center mb-4 sm:mb-6">
            <div>
              <h2 class="text-xl sm:text-2xl font-black tracking-tight dark:text-white">Manage Activities</h2>
              <p class="text-gray-500 dark:text-gray-400 text-sm">View and manage all running activities</p>
            </div>
            <div class="flex items-center gap-2">
              <button 
                id="refreshActivities"
                class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-xl transition-all flex items-center gap-2"
              >
                <i class="fas fa-sync-alt"></i>
                Refresh
              </button>
            </div>
          </div>
          
          <!-- Filters -->
          <div class="bg-white dark:bg-zinc-800 p-4 rounded-2xl mb-4 shadow-sm border border-gray-100 dark:border-zinc-700">
            <div class="grid grid-cols-1 sm:grid-cols-4 gap-3">
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2">Status Filter</label>
                <select id="statusFilter" class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white">
                  <option value="all">All Status</option>
                  <option value="pending">Pending</option>
                  <option value="approved">Approved</option>
                  <option value="rejected">Rejected</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2">Date From</label>
                <input type="date" id="dateFrom" class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white">
              </div>
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2">Date To</label>
                <input type="date" id="dateTo" class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white">
              </div>
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2">Bib Number</label>
                <input type="text" id="bibFilter" placeholder="BIB-XXXX" class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white">
              </div>
            </div>
            <button id="applyActivityFilter" class="w-full mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl transition-all">
              Apply Filters
            </button>
          </div>
          
          <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-200 dark:border-zinc-700 overflow-hidden">
            <div id="activitiesList" class="divide-y divide-gray-100 dark:divide-zinc-700">
              <div class="p-4 text-center">
                <div class="inline-block animate-spin rounded-full h-6 w-6 border-2 border-red-600 border-t-transparent"></div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading activities...</p>
              </div>
            </div>
          </div>
        </div>
      `;

      // Load activities
      loadActivitiesList();

      // Add event listeners
      document.getElementById('refreshActivities').addEventListener('click', loadActivitiesList);
      document.getElementById('applyActivityFilter').addEventListener('click', loadActivitiesList);
    }

    // Load activities list for admin
    async function loadActivitiesList() {
      const activitiesList = document.getElementById('activitiesList');
      if (!activitiesList) return;

      try {
        const snapshot = await db.ref('running_logs').once('value');
        let activities = [];
        
        snapshot.forEach(childSnapshot => {
          const activity = childSnapshot.val();
          activity.id = childSnapshot.key;
          activities.push(activity);
        });

        // Apply filters
        const statusFilter = document.getElementById('statusFilter').value;
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;
        const bibFilter = document.getElementById('bibFilter').value;

        if (statusFilter !== 'all') {
          activities = activities.filter(activity => activity.status === statusFilter);
        }

        if (dateFrom) {
          const fromDate = new Date(dateFrom);
          activities = activities.filter(activity => new Date(activity.date) >= fromDate);
        }

        if (dateTo) {
          const toDate = new Date(dateTo);
          toDate.setHours(23, 59, 59, 999);
          activities = activities.filter(activity => new Date(activity.date) <= toDate);
        }

        if (bibFilter) {
          activities = activities.filter(activity => activity.bib_number.includes(bibFilter));
        }

        // Sort by date (newest first)
        activities.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (activities.length === 0) {
          activitiesList.innerHTML = `
            <div class="p-6 sm:p-8 text-center">
              <p class="text-gray-500 dark:text-gray-400">No activities found</p>
            </div>
          `;
          return;
        }

        activitiesList.innerHTML = activities.map(activity => {
          const activityDate = new Date(activity.date);
          const formattedDate = activityDate.toLocaleDateString('en-GB', { 
            day: 'numeric', 
            month: 'short', 
            year: 'numeric' 
          });
          const formattedTime = activityDate.toLocaleTimeString('en-GB', { 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          
          return `
            <div class="p-4 sm:p-6 hover:bg-gray-50 dark:hover:bg-zinc-700/50 transition-colors">
              <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white">
                      <i class="fas fa-running"></i>
                    </div>
                    <div>
                      <h3 class="font-bold dark:text-white">${activity.nickname || activity.runner_name} ‚Ä¢ ${activity.distance} km</h3>
                      <p class="text-sm text-gray-500 dark:text-gray-400">${activity.bib_number} ‚Ä¢ ${formattedDate} at ${formattedTime}</p>
                    </div>
                  </div>
                  <div class="grid grid-cols-3 gap-2 mt-3">
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.duration}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Minutes</p>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.pace}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Pace</p>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.likes || 0}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Likes</p>
                    </div>
                  </div>
                  ${activity.notes ? `
                    <div class="mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                      <p class="text-sm dark:text-white italic">"${activity.notes}"</p>
                    </div>
                  ` : ''}
                  ${activity.proof_image ? `
                    <!-- FEATURE 5: Proof image only shown in admin panel -->
                    <div class="mt-3">
                      <p class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">Proof Image:</p>
                      <img 
                        src="${activity.proof_image}" 
                        alt="Proof image" 
                        class="activity-image max-w-xs cursor-pointer"
                        onclick="showAdminImage('${activity.proof_image}')"
                      >
                      <button 
                        data-id="${activity.id}"
                        data-image-url="${activity.proof_image}"
                        class="delete-image-btn mt-2 px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-lg transition-all"
                      >
                        <i class="fas fa-trash mr-1"></i> Delete Image
                      </button>
                    </div>
                  ` : ''}
                </div>
                <div class="flex flex-col items-end gap-2">
                  <span class="px-3 py-1 rounded-full text-xs font-bold ${
                    activity.status === 'approved' ? 'status-approved' : 
                    activity.status === 'pending' ? 'status-pending' : 
                    'status-rejected'
                  }">
                    ${activity.status || 'pending'}
                  </span>
                  <div class="flex items-center gap-2">
                    ${activity.status === 'pending' ? `
                      <button 
                        data-id="${activity.id}"
                        data-action="approve"
                        class="approve-activity-btn px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-bold rounded-lg transition-all"
                      >
                        Approve
                      </button>
                      <button 
                        data-id="${activity.id}"
                        data-action="reject"
                        class="reject-activity-btn px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-lg transition-all"
                      >
                        Reject
                      </button>
                    ` : ''}
                    <button 
                      data-id="${activity.id}"
                      class="edit-activity-btn px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold rounded-lg transition-all"
                    >
                      Edit
                    </button>
                    <button 
                      data-id="${activity.id}"
                      class="delete-activity-btn px-3 py-1.5 bg-gray-600 hover:bg-gray-700 text-white text-xs font-bold rounded-lg transition-all"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join('');

        // Add event listeners for buttons
        document.querySelectorAll('.approve-activity-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            await updateActivityStatus(activityId, 'approved');
            loadActivitiesList();
          });
        });

        document.querySelectorAll('.reject-activity-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            await updateActivityStatus(activityId, 'rejected');
            loadActivitiesList();
          });
        });

        document.querySelectorAll('.edit-activity-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            await editActivity(activityId);
          });
        });

        document.querySelectorAll('.delete-activity-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            if (confirm('Are you sure you want to delete this activity?')) {
              await deleteActivity(activityId);
              loadActivitiesList();
            }
          });
        });

        document.querySelectorAll('.delete-image-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            const imageUrl = btn.dataset.imageUrl;
            if (confirm('Are you sure you want to delete this proof image?')) {
              await deleteProofImage(activityId, imageUrl);
              loadActivitiesList();
            }
          });
        });

      } catch (error) {
        console.error('Error loading activities:', error);
        activitiesList.innerHTML = `
          <div class="p-4 sm:p-8 text-center">
            <p class="text-red-500">Error loading activities. Please try again.</p>
          </div>
        `;
      }
    }

    // Show admin image in modal
    function showAdminImage(imageUrl) {
      const modal = document.createElement('div');
      modal.className = 'admin-image-viewer animate-fadeIn';
      modal.innerHTML = `
        <div class="admin-image-container">
          <img src="${imageUrl}" alt="Proof image" class="admin-image">
          <button onclick="this.closest('.admin-image-viewer').remove()" class="absolute top-4 right-4 bg-white/20 hover:bg-white/30 text-white p-2 rounded-full">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      document.body.appendChild(modal);
      
      // Close when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
        }
      });
    }

    // Delete proof image
    async function deleteProofImage(activityId, imageUrl) {
      try {
        // Remove image from Firebase Storage if it exists
        if (imageUrl && imageUrl.includes('firebasestorage.googleapis.com')) {
          try {
            const imageRef = storage.refFromURL(imageUrl);
            await imageRef.delete();
          } catch (error) {
            console.log('Error deleting from storage, might be a URL:', error);
          }
        }
        
        // Remove image URL from activity
        await db.ref(`running_logs/${activityId}/proof_image`).remove();
        
        alert('Proof image deleted successfully!');
      } catch (error) {
        console.error('Error deleting proof image:', error);
        alert('Error deleting proof image');
      }
    }

    // Edit activity
    async function editActivity(activityId) {
      try {
        const snapshot = await db.ref(`running_logs/${activityId}`).once('value');
        const activity = snapshot.val();
        
        if (!activity) {
          alert('Activity not found');
          return;
        }

        // Parse duration into hours, minutes, seconds
        const totalSeconds = activity.duration * 60; // Convert minutes to seconds
        const hours = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = Math.floor(totalSeconds % 60);

        // Create modal
        const modal = document.createElement('div');
        modal.className = 'fixed inset-0 z-[999] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fadeIn';
        modal.innerHTML = `
          <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-zinc-700">
            <div class="p-4 sm:p-6">
              <div class="flex items-center justify-between mb-4 sm:mb-6">
                <h2 class="text-xl font-black dark:text-white">Edit Activity</h2>
                <button id="closeModal" class="p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full text-gray-400">
                  <i class="fas fa-times text-lg"></i>
                </button>
              </div>
              
              <form id="editActivityForm" class="space-y-4">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Date</label>
                    <input 
                      type="date" 
                      id="editActivityDate"
                      value="${activity.date.split('T')[0]}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Activity Type</label>
                    <select 
                      id="editActivityType"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                    >
                      <option value="run" ${activity.activity_type === 'run' ? 'selected' : ''}>Run</option>
                      <option value="walk" ${activity.activity_type === 'walk' ? 'selected' : ''}>Walk</option>
                      <option value="jog" ${activity.activity_type === 'jog' ? 'selected' : ''}>Jog</option>
                    </select>
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Distance (km)</label>
                    <input 
                      type="number" 
                      step="0.01"
                      id="editDistance"
                      value="${activity.distance}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Pace (min/km)</label>
                    <input 
                      type="number" 
                      step="0.01"
                      id="editPace"
                      value="${activity.pace}"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                      required
                    />
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Duration</label>
                    <div class="time-input-group">
                      <div class="time-input">
                        <label class="text-xs text-gray-500">Hours</label>
                        <input 
                          type="number" 
                          id="editHours"
                          value="${hours}"
                          min="0"
                          class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                        />
                      </div>
                      <div class="time-input">
                        <label class="text-xs text-gray-500">Minutes</label>
                        <input 
                          type="number" 
                          id="editMinutes"
                          value="${minutes}"
                          min="0"
                          max="59"
                          class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                        />
                      </div>
                      <div class="time-input">
                        <label class="text-xs text-gray-500">Seconds</label>
                        <input 
                          type="number" 
                          id="editSeconds"
                          value="${seconds}"
                          min="0"
                          max="59"
                          class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                        />
                      </div>
                    </div>
                  </div>
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Status</label>
                    <select 
                      id="editActivityStatus"
                      class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                    >
                      <option value="pending" ${activity.status === 'pending' ? 'selected' : ''}>Pending</option>
                      <option value="approved" ${activity.status === 'approved' ? 'selected' : ''}>Approved</option>
                      <option value="rejected" ${activity.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                    </select>
                  </div>
                </div>
                
                <div>
                  <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Notes</label>
                  <textarea 
                    id="editNotes"
                    rows="3"
                    class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-red-600 dark:text-white"
                  >${activity.notes || ''}</textarea>
                </div>
                
                ${activity.proof_image ? `
                  <!-- FEATURE 5: Proof image only shown in admin panel -->
                  <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Current Proof Image</label>
                    <img 
                      src="${activity.proof_image}" 
                      alt="Proof image" 
                      class="activity-image max-w-xs cursor-pointer"
                      onclick="showAdminImage('${activity.proof_image}')"
                    >
                    <button 
                      data-id="${activity.id}"
                      data-image-url="${activity.proof_image}"
                      class="delete-image-btn-edit mt-2 px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-lg transition-all"
                    >
                      <i class="fas fa-trash mr-1"></i> Delete Image
                    </button>
                  </div>
                ` : ''}
                
                <div class="flex gap-3 mt-6">
                  <button 
                    type="submit"
                    class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl transition-all"
                  >
                    Update Activity
                  </button>
                  <button 
                    type="button"
                    id="cancelEditActivity"
                    class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 rounded-xl transition-all"
                  >
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        // Close modal
        modal.querySelector('#closeModal').addEventListener('click', () => {
          document.body.removeChild(modal);
        });
        
        modal.querySelector('#cancelEditActivity').addEventListener('click', () => {
          document.body.removeChild(modal);
        });
        
        // Delete image button in edit modal
        const deleteImageBtn = modal.querySelector('.delete-image-btn-edit');
        if (deleteImageBtn) {
          deleteImageBtn.addEventListener('click', async () => {
            const activityId = deleteImageBtn.dataset.id;
            const imageUrl = deleteImageBtn.dataset.imageUrl;
            if (confirm('Are you sure you want to delete this proof image?')) {
              await deleteProofImage(activityId, imageUrl);
              alert('Image deleted! Please refresh the page to see changes.');
            }
          });
        }
        
        // Form submission
        modal.querySelector('#editActivityForm').addEventListener('submit', async (e) => {
          e.preventDefault();
          
          try {
            // Calculate total minutes from hours, minutes, seconds
            const hours = parseInt(document.getElementById('editHours').value) || 0;
            const minutes = parseInt(document.getElementById('editMinutes').value) || 0;
            const seconds = parseInt(document.getElementById('editSeconds').value) || 0;
            const totalMinutes = hours * 60 + minutes + seconds / 60;
            
            const updates = {
              date: document.getElementById('editActivityDate').value,
              activity_type: document.getElementById('editActivityType').value,
              distance: parseFloat(document.getElementById('editDistance').value),
              pace: parseFloat(document.getElementById('editPace').value),
              duration: totalMinutes.toFixed(2),
              notes: document.getElementById('editNotes').value,
              status: document.getElementById('editActivityStatus').value,
              last_updated: new Date().toISOString(),
              updated_by: 'admin'
            };
            
            await db.ref(`running_logs/${activityId}`).update(updates);
            
            // If status changed to approved, update runner stats
            if (updates.status === 'approved' && activity.status !== 'approved') {
              const runnerRef = db.ref(`runners/${activity.bib_number}`);
              const runnerSnapshot = await runnerRef.once('value');
              const runner = runnerSnapshot.val();
              
              if (runner) {
                const newTotalRuns = (runner.total_runs || 0) + 1;
                const newTotalDistance = (parseFloat(runner.total_distance) || 0) + parseFloat(updates.distance);
                const newAvgPace = ((parseFloat(runner.avg_pace) || 0) * (newTotalRuns - 1) + parseFloat(updates.pace)) / newTotalRuns;
                
                await runnerRef.update({
                  total_runs: newTotalRuns,
                  total_distance: newTotalDistance,
                  avg_pace: newAvgPace.toFixed(2),
                  last_activity_date: updates.date
                });
              }
            }
            
            alert('Activity updated successfully!');
            document.body.removeChild(modal);
            loadActivitiesList();
            
          } catch (error) {
            alert('Error updating activity: ' + error.message);
          }
        });
        
        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            document.body.removeChild(modal);
          }
        });
        
      } catch (error) {
        console.error('Error editing activity:', error);
        alert('Error loading activity details');
      }
    }

    // Update activity status
    async function updateActivityStatus(activityId, status) {
      try {
        await db.ref(`running_logs/${activityId}`).update({
          status: status,
          reviewed_date: new Date().toISOString(),
          reviewed_by: 'admin'
        });
        
        // If approved, update runner's stats
        if (status === 'approved') {
          const snapshot = await db.ref(`running_logs/${activityId}`).once('value');
          const activity = snapshot.val();
          
          if (activity && activity.bib_number) {
            const runnerRef = db.ref(`runners/${activity.bib_number}`);
            const runnerSnapshot = await runnerRef.once('value');
            const runner = runnerSnapshot.val();
            
            if (runner) {
              const distance = parseFloat(activity.distance) || 0;
              const pace = parseFloat(activity.pace) || 0;
              const newTotalRuns = (runner.total_runs || 0) + 1;
              const newTotalDistance = (parseFloat(runner.total_distance) || 0) + distance;
              const newAvgPace = ((parseFloat(runner.avg_pace) || 0) * (newTotalRuns - 1) + pace) / newTotalRuns;
              
              await runnerRef.update({
                total_runs: newTotalRuns,
                total_distance: newTotalDistance,
                avg_pace: newAvgPace.toFixed(2),
                last_activity_date: activity.date
              });
            }
          }
        }
        
        alert(`Activity ${status} successfully`);
        
      } catch (error) {
        console.error('Error updating activity status:', error);
        alert('Error updating activity status');
      }
    }

    // Delete activity
    async function deleteActivity(activityId) {
      try {
        await db.ref(`running_logs/${activityId}`).remove();
        alert('Activity deleted successfully');
      } catch (error) {
        console.error('Error deleting activity:', error);
        alert('Error deleting activity');
      }
    }

    // Pending Approvals Component
    async function renderPendingApprovals(container) {
      container.innerHTML = `
        <div class="animate-fadeIn">
          <div class="flex justify-between items-center mb-4 sm:mb-6">
            <div>
              <h2 class="text-xl sm:text-2xl font-black tracking-tight dark:text-white">Pending Approvals</h2>
              <p class="text-gray-500 dark:text-gray-400 text-sm">Review and approve pending running activities</p>
            </div>
            <button 
              id="refreshPending"
              class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-xl transition-all flex items-center gap-2"
            >
              <i class="fas fa-sync-alt"></i>
              Refresh
            </button>
          </div>
          
          <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-200 dark:border-zinc-700 overflow-hidden">
            <div id="pendingList" class="divide-y divide-gray-100 dark:divide-zinc-700">
              <div class="p-4 text-center">
                <div class="inline-block animate-spin rounded-full h-6 w-6 border-2 border-red-600 border-t-transparent"></div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading pending activities...</p>
              </div>
            </div>
          </div>
        </div>
      `;

      // Load pending activities
      loadPendingActivities();

      // Refresh button
      document.getElementById('refreshPending').addEventListener('click', loadPendingActivities);
    }

    // Load pending activities
    async function loadPendingActivities() {
      const pendingList = document.getElementById('pendingList');
      if (!pendingList) return;

      try {
        const snapshot = await db.ref('running_logs').orderByChild('status').equalTo('pending').once('value');
        const activities = [];
        
        snapshot.forEach(childSnapshot => {
          const activity = childSnapshot.val();
          activity.id = childSnapshot.key;
          activities.push(activity);
        });

        // Sort by date (newest first)
        activities.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (activities.length === 0) {
          pendingList.innerHTML = `
            <div class="p-6 sm:p-8 text-center">
              <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                <i class="fas fa-check text-2xl sm:text-3xl text-green-600 dark:text-green-400"></i>
              </div>
              <h4 class="font-bold text-lg mb-2 dark:text-white">All Caught Up!</h4>
              <p class="text-gray-500 dark:text-gray-400 mb-6 text-sm sm:text-base">No pending activities to review.</p>
            </div>
          `;
          return;
        }

        pendingList.innerHTML = activities.map(activity => {
          const activityDate = new Date(activity.date);
          const formattedDate = activityDate.toLocaleDateString('en-GB', { 
            day: 'numeric', 
            month: 'short', 
            year: 'numeric' 
          });
          const formattedTime = activityDate.toLocaleTimeString('en-GB', { 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          const submissionDate = new Date(activity.submission_date);
          const timeAgo = getTimeAgo(submissionDate);
          
          return `
            <div class="p-4 sm:p-6 hover:bg-gray-50 dark:hover:bg-zinc-700/50 transition-colors">
              <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white">
                      ${activity.nickname ? activity.nickname.substring(0, 2).toUpperCase() : 'RU'}
                    </div>
                    <div>
                      <h3 class="font-bold dark:text-white">${activity.nickname || activity.runner_name}</h3>
                      <p class="text-sm text-gray-500 dark:text-gray-400">${activity.bib_number} ‚Ä¢ Submitted ${timeAgo}</p>
                    </div>
                  </div>
                  
                  <div class="grid grid-cols-3 gap-2 mt-3">
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.distance} km</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Distance</p>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.duration} min</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Duration</p>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.pace}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Pace</p>
                    </div>
                  </div>
                  
                  <div class="mt-3 grid grid-cols-2 gap-2">
                    <div class="p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="text-xs text-gray-500 dark:text-gray-400">Activity Date</p>
                      <p class="font-bold dark:text-white">${formattedDate} at ${formattedTime}</p>
                    </div>
                    <div class="p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="text-xs text-gray-500 dark:text-gray-400">Activity Type</p>
                      <p class="font-bold dark:text-white">${activity.activity_type || 'Run'}</p>
                    </div>
                  </div>
                  
                  ${activity.notes ? `
                    <div class="mt-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                      <p class="text-sm font-bold dark:text-white mb-1">Runner's Notes:</p>
                      <p class="text-sm dark:text-white italic">"${activity.notes}"</p>
                    </div>
                  ` : ''}
                  
                  ${activity.proof_image ? `
                    <!-- FEATURE 5: Proof image only shown in admin panel -->
                    <div class="mt-3">
                      <p class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">Proof Image:</p>
                      <img 
                        src="${activity.proof_image}" 
                        alt="Proof image" 
                        class="activity-image max-w-xs cursor-pointer"
                        onclick="showAdminImage('${activity.proof_image}')"
                      >
                      <button 
                        data-id="${activity.id}"
                        data-image-url="${activity.proof_image}"
                        class="delete-image-btn mt-2 px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-bold rounded-lg transition-all"
                      >
                        <i class="fas fa-trash mr-1"></i> Delete Image
                      </button>
                    </div>
                  ` : ''}
                </div>
                
                <div class="flex flex-col items-end gap-3">
                  <span class="px-3 py-1 rounded-full text-xs font-bold status-pending">
                    Pending Review
                  </span>
                  <div class="flex flex-col sm:flex-row gap-2">
                    <button 
                      data-id="${activity.id}"
                      data-action="approve"
                      class="approve-pending-btn px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-bold rounded-lg transition-all flex items-center justify-center gap-2"
                    >
                      <i class="fas fa-check"></i>
                      Approve
                    </button>
                    <button 
                      data-id="${activity.id}"
                      data-action="reject"
                      class="reject-pending-btn px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-lg transition-all flex items-center justify-center gap-2"
                    >
                      <i class="fas fa-times"></i>
                      Reject
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
        }).join('');

        // Add event listeners for buttons
        document.querySelectorAll('.approve-pending-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            await updateActivityStatus(activityId, 'approved');
            loadPendingActivities();
          });
        });

        document.querySelectorAll('.reject-pending-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            await updateActivityStatus(activityId, 'rejected');
            loadPendingActivities();
          });
        });

        document.querySelectorAll('.delete-image-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.id;
            const imageUrl = btn.dataset.imageUrl;
            if (confirm('Are you sure you want to delete this proof image?')) {
              await deleteProofImage(activityId, imageUrl);
              loadPendingActivities();
            }
          });
        });

      } catch (error) {
        console.error('Error loading pending activities:', error);
        pendingList.innerHTML = `
          <div class="p-4 sm:p-8 text-center">
            <p class="text-red-500">Error loading pending activities. Please try again.</p>
          </div>
        `;
      }
    }

    // Get time ago string
    function getTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.round(diffMs / 60000);
      const diffHours = Math.round(diffMs / 3600000);
      const diffDays = Math.round(diffMs / 86400000);
      
      if (diffMins < 1) return 'just now';
      if (diffMins < 60) return `${diffMins} minute${diffMins === 1 ? '' : 's'} ago`;
      if (diffHours < 24) return `${diffHours} hour${diffHours === 1 ? '' : 's'} ago`;
      return `${diffDays} day${diffDays === 1 ? '' : 's'} ago`;
    }

    // Admin Reports Component
    async function renderAdminReports(container) {
      // Load report data
      let totalRunners = 0;
      let totalActivities = 0;
      let totalDistance = 0;
      let pendingCount = 0;
      let approvedCount = 0;
      let runnersData = [];
      let activitiesByDay = {};

      try {
        // Get runners data
        const runnersSnapshot = await db.ref('runners').once('value');
        totalRunners = runnersSnapshot.numChildren();
        runnersSnapshot.forEach(childSnapshot => {
          const runner = childSnapshot.val();
          runnersData.push(runner);
        });

        // Get activities data
        const activitiesSnapshot = await db.ref('running_logs').once('value');
        activitiesSnapshot.forEach(childSnapshot => {
          const activity = childSnapshot.val();
          totalActivities++;
          
          if (activity.status === 'pending') pendingCount++;
          if (activity.status === 'approved') approvedCount++;
          
          if (activity.distance && activity.status === 'approved') {
            totalDistance += parseFloat(activity.distance) || 0;
          }
          
          // Group by date
          if (activity.date) {
            const date = activity.date.split('T')[0];
            if (!activitiesByDay[date]) {
              activitiesByDay[date] = 0;
            }
            activitiesByDay[date]++;
          }
        });
        
      } catch (error) {
        console.error('Error loading report data:', error);
      }

      // Sort runners by distance
      runnersData.sort((a, b) => (parseFloat(b.total_distance) || 0) - (parseFloat(a.total_distance) || 0));
      const topRunners = runnersData.slice(0, 5);

      container.innerHTML = `
        <div class="animate-fadeIn">
          <div class="flex justify-between items-center mb-4 sm:mb-6">
            <div>
              <h2 class="text-xl sm:text-2xl font-black tracking-tight dark:text-white">Reports & Analytics</h2>
              <p class="text-gray-500 dark:text-gray-400 text-sm">Roadha Run Performance Insights</p>
            </div>
            <button 
              id="exportReports"
              class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-xl transition-all flex items-center gap-2"
            >
              <i class="fas fa-download"></i>
              Export Report
            </button>
          </div>
          
          <!-- Summary Stats -->
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6">
            <div class="bg-white dark:bg-zinc-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-zinc-700">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Runners</p>
                  <p class="text-2xl font-black mt-1 dark:text-white">${totalRunners}</p>
                </div>
                <div class="w-10 h-10 rounded-xl bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center">
                  <i class="fas fa-users text-blue-600 dark:text-blue-400"></i>
                </div>
              </div>
            </div>
            <div class="bg-white dark:bg-zinc-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-zinc-700">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Activities</p>
                  <p class="text-2xl font-black mt-1 dark:text-white">${totalActivities}</p>
                </div>
                <div class="w-10 h-10 rounded-xl bg-green-100 dark:bg-green-900/30 flex items-center justify-center">
                  <i class="fas fa-running text-green-600 dark:text-green-400"></i>
                </div>
              </div>
            </div>
            <div class="bg-white dark:bg-zinc-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-zinc-700">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Total Distance</p>
                  <p class="text-2xl font-black mt-1 dark:text-white">${formatNumber(totalDistance, 1)} km</p>
                </div>
                <div class="w-10 h-10 rounded-xl bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
                  <i class="fas fa-route text-orange-600 dark:text-orange-400"></i>
                </div>
              </div>
            </div>
            <div class="bg-white dark:bg-zinc-800 p-4 rounded-2xl shadow-sm border border-gray-100 dark:border-zinc-700">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs font-semibold text-gray-500 dark:text-gray-400">Pending Reviews</p>
                  <p class="text-2xl font-black mt-1 dark:text-white">${pendingCount}</p>
                </div>
                <div class="w-10 h-10 rounded-xl bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center">
                  <i class="fas fa-clock text-yellow-600 dark:text-yellow-400"></i>
                </div>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Top Performers -->
            <div class="bg-white dark:bg-zinc-800 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700">
              <h3 class="font-bold dark:text-white mb-4">Top 5 Performers</h3>
              <div class="space-y-3">
                ${topRunners.length > 0 ? topRunners.map((runner, index) => {
                  return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 dark:bg-zinc-700/50 rounded-xl">
                      <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full ${
                          index === 0 ? 'crown-gold' : 
                          index === 1 ? 'crown-silver' : 
                          index === 2 ? 'crown-bronze' : 
                          'bg-orange-600/20'
                        } flex items-center justify-center text-xs font-bold">
                          ${index + 1}
                        </div>
                        <div>
                          <p class="text-sm font-bold dark:text-white">${runner.nickname}</p>
                          <p class="text-xs text-gray-500 dark:text-gray-400">${runner.bib_number} ‚Ä¢ Goal: ${runner.goal || 'N/A'}</p>
                        </div>
                      </div>
                      <div class="text-right">
                        <p class="text-sm font-bold dark:text-white">${formatNumber(runner.total_distance || 0, 1)} km</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${runner.total_runs || 0} runs</p>
                      </div>
                    </div>
                  `;
                }).join('') : `
                  <p class="text-gray-500 dark:text-gray-400 text-center py-4">No runner data available</p>
                `}
              </div>
            </div>
            
            <!-- Activity Status -->
            <div class="bg-white dark:bg-zinc-800 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700">
              <h3 class="font-bold dark:text-white mb-4">Activity Status</h3>
              <div class="space-y-4">
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600 dark:text-gray-300">Approved</span>
                    <span class="font-bold dark:text-white">${approvedCount}</span>
                  </div>
                  <div class="w-full bg-gray-200 dark:bg-zinc-700 rounded-full h-2">
                    <div class="bg-green-600 h-2 rounded-full" style="width: ${totalActivities > 0 ? (approvedCount / totalActivities * 100) : 0}%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600 dark:text-gray-300">Pending</span>
                    <span class="font-bold dark:text-white">${pendingCount}</span>
                  </div>
                  <div class="w-full bg-gray-200 dark:bg-zinc-700 rounded-full h-2">
                    <div class="bg-yellow-600 h-2 rounded-full" style="width: ${totalActivities > 0 ? (pendingCount / totalActivities * 100) : 0}%"></div>
                  </div>
                </div>
                <div>
                  <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-600 dark:text-gray-300">Rejected</span>
                    <span class="font-bold dark:text-white">${totalActivities - approvedCount - pendingCount}</span>
                  </div>
                  <div class="w-full bg-gray-200 dark:bg-zinc-700 rounded-full h-2">
                    <div class="bg-red-600 h-2 rounded-full" style="width: ${totalActivities > 0 ? ((totalActivities - approvedCount - pendingCount) / totalActivities * 100) : 0}%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Recent Activity Chart -->
          <div class="bg-white dark:bg-zinc-800 p-4 sm:p-5 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-100 dark:border-zinc-700 mt-6">
            <h3 class="font-bold dark:text-white mb-4">Recent Activity (Last 7 Days)</h3>
            <div class="h-64 flex items-end justify-between gap-1 sm:gap-2">
              ${(() => {
                // Get last 7 days
                const dates = [];
                const today = new Date();
                for (let i = 6; i >= 0; i--) {
                  const date = new Date(today);
                  date.setDate(date.getDate() - i);
                  dates.push(date.toISOString().split('T')[0]);
                }
                
                // Get counts for each date
                const counts = dates.map(date => activitiesByDay[date] || 0);
                const maxCount = Math.max(...counts, 1);
                
                return dates.map((date, index) => {
                  const count = counts[index];
                  const height = (count / maxCount) * 100;
                  const day = new Date(date).toLocaleDateString('en-GB', { weekday: 'short' });
                  
                  return `
                    <div class="flex-1 flex flex-col items-center">
                      <div class="w-full bg-gray-200 dark:bg-zinc-700 rounded-t-lg overflow-hidden" style="height: ${height}%">
                        <div class="w-full bg-gradient-to-t from-red-600 to-red-500 h-full"></div>
                      </div>
                      <div class="text-center mt-2">
                        <p class="text-xs font-bold dark:text-white">${count}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">${day}</p>
                      </div>
                    </div>
                  `;
                }).join('');
              })()}
            </div>
          </div>
        </div>
      `;

      // Export reports button
      document.getElementById('exportReports').addEventListener('click', () => {
        exportReports();
      });
    }

    // Export reports
    function exportReports() {
      // Create CSV content
      let csvContent = "Roadha Run - Admin Report\n\n";
      csvContent += "Generated: " + new Date().toLocaleString() + "\n\n";
      csvContent += "Metric,Value\n";
      csvContent += "Total Runners," + totalRegisteredRunners + "\n";
      csvContent += "Total Activities," + "N/A" + "\n";
      csvContent += "Total Distance (km)," + "N/A" + "\n";
      csvContent += "Pending Reviews," + "N/A" + "\n\n";
      csvContent += "Report exported from Roadha Run Admin Dashboard";
      
      // Create blob and download
      const blob = new Blob([csvContent], { type: 'text/csv' });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `roadha-run-report-${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      window.URL.revokeObjectURL(url);
      
      alert('Report exported successfully!');
    }

    // Activity Feed Component (for runners)
    async function renderActivityFeed(container) {
      container.innerHTML = `
        <div class="animate-fadeIn">
          <div class="flex justify-between items-center mb-4 sm:mb-6">
            <h2 class="text-xl sm:text-2xl font-black tracking-tight dark:text-white">Activity Feed</h2>
            <div class="flex items-center gap-2">
              <!-- Date Filter for Feed -->
              <div class="calendar-container">
                <div class="calendar-input flex items-center justify-between calendar-bg">
                  <span id="feedDateDisplay" class="text-white">${formatDate(selectedDate)}</span>
                  <i class="fas fa-calendar-alt text-orange-400"></i>
                </div>
              </div>
            </div>
          </div>
          
          <div id="activityFeedList" class="space-y-4">
            <div class="text-center py-8">
              <div class="inline-block animate-spin rounded-full h-8 w-8 border-2 border-orange-600 border-t-transparent"></div>
              <p class="mt-3 text-gray-500 dark:text-gray-400">Loading activities...</p>
            </div>
          </div>
        </div>
      `;
      
      // Load activity feed
      loadActivityFeed();
      
      // Calendar click event for feed
      document.querySelector('.calendar-input').addEventListener('click', () => {
        showCalendarModal('feed');
      });
    }

    // Load activity feed for runners
    async function loadActivityFeed() {
      const activityFeedList = document.getElementById('activityFeedList');
      if (!activityFeedList) return;

      try {
        const snapshot = await db.ref('running_logs').once('value');
        let activities = [];
        
        snapshot.forEach(childSnapshot => {
          const activity = childSnapshot.val();
          activity.id = childSnapshot.key;
          activities.push(activity);
        });

        // Filter by selected date
        activities = activities.filter(activity => {
          const activityDate = new Date(activity.date);
          return activityDate.toDateString() === selectedDate.toDateString();
        });

        // Sort by date (newest first)
        activities.sort((a, b) => new Date(b.date) - new Date(a.date));

        if (activities.length === 0) {
          activityFeedList.innerHTML = `
            <div class="text-center py-10">
              <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
                <i class="fas fa-newspaper text-2xl text-orange-600 dark:text-orange-400"></i>
              </div>
              <h4 class="font-bold text-lg mb-2 dark:text-white">No activities for ${formatDate(selectedDate)}</h4>
              <p class="text-gray-500 dark:text-gray-400 mb-6">Select another date or log an activity!</p>
            </div>
          `;
          return;
        }

        activityFeedList.innerHTML = activities.map(activity => {
          const activityDate = new Date(activity.date);
          const formattedDate = activityDate.toLocaleDateString('en-GB', { 
            day: 'numeric', 
            month: 'short', 
            year: 'numeric' 
          });
          const formattedTime = activityDate.toLocaleTimeString('en-GB', { 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          const isCurrentUser = activity.bib_number === currentUser.bib_number;
          
          // FEATURE 5: Don't show proof image to runners (changed from true to false)
          const showProofImage = false;
          
          return `
            <div class="bg-white dark:bg-zinc-800 rounded-xl sm:rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-zinc-700">
              <div class="flex items-start justify-between mb-3">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-xl bg-gradient-to-tr ${isCurrentUser ? 'from-orange-600 to-amber-500' : 'from-blue-600 to-cyan-500'} flex items-center justify-center text-white font-bold">
                    ${activity.nickname ? activity.nickname.substring(0, 2).toUpperCase() : 'RU'}
                  </div>
                  <div>
                    <div class="flex items-center gap-2">
                      <h3 class="font-bold dark:text-white">${activity.nickname || activity.runner_name}</h3>
                      ${isCurrentUser ? `
                        <span class="px-1.5 py-0.5 bg-orange-600 text-white text-[8px] rounded-full uppercase">You</span>
                      ` : ''}
                    </div>
                    <p class="text-xs text-gray-500 dark:text-gray-400">${activity.bib_number}</p>
                  </div>
                </div>
                <div class="text-right">
                  <p class="text-xs font-bold text-gray-500 dark:text-gray-400">${formattedDate}</p>
                  <p class="text-xs text-gray-400">${formattedTime}</p>
                </div>
              </div>
              
              <div class="mb-4">
                <div class="flex items-center gap-2 mb-2">
                  <span class="px-2 py-1 bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded text-xs font-bold uppercase">
                    ${activity.activity_type || 'Run'}
                  </span>
                  <span class="text-xs text-gray-500 dark:text-gray-400">‚Ä¢ ${activity.distance} km ‚Ä¢ ${activity.duration} min</span>
                </div>
                
                <div class="grid grid-cols-3 gap-2">
                  <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                    <p class="text-lg font-black dark:text-white">${activity.distance}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Distance</p>
                  </div>
                  <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                    <p class="text-lg font-black dark:text-white">${activity.duration}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Duration</p>
                  </div>
                  <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                    <p class="text-lg font-black dark:text-white">${activity.pace}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">Pace</p>
                  </div>
                </div>
              </div>
              
              ${activity.notes ? `
                <div class="mb-4 p-3 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                  <p class="text-sm dark:text-white italic">"${activity.notes}"</p>
                </div>
              ` : ''}
              
              ${activity.proof_image && showProofImage && activity.status === 'approved' ? `
                <div class="mb-4">
                  <p class="text-xs font-bold text-gray-500 dark:text-gray-400 mb-1">Proof Image:</p>
                  <img 
                    src="${activity.proof_image}" 
                    alt="Proof image" 
                    class="activity-image max-w-xs cursor-pointer"
                    onclick="showAdminImage('${activity.proof_image}')"
                  >
                </div>
              ` : ''}
              
              <div class="flex items-center justify-between pt-3 border-t border-gray-100 dark:border-zinc-700">
                <div class="flex items-center gap-4">
                  <button 
                    data-activity-id="${activity.id}"
                    data-liked="${(activity.liked_by || []).includes(currentUser.bib_number)}"
                    class="like-btn flex items-center gap-1 text-xs font-bold ${(activity.liked_by || []).includes(currentUser.bib_number) ? 'text-red-500' : 'text-gray-500 hover:text-red-500'}"
                  >
                    <i class="fas fa-heart ${(activity.liked_by || []).includes(currentUser.bib_number) ? 'text-red-500' : 'text-gray-400'}"></i>
                    ${activity.likes || 0}
                  </button>
                </div>
                <div class="flex items-center gap-1">
                  <div class="w-2 h-2 rounded-full ${activity.status === 'approved' ? 'bg-green-500' : activity.status === 'pending' ? 'bg-yellow-500' : 'bg-red-500'}"></div>
                  <span class="text-xs text-gray-500 dark:text-gray-400">${activity.status || 'pending'}</span>
                </div>
              </div>
            </div>
          `;
        }).join('');

        // Add like button listeners
        document.querySelectorAll('.like-btn').forEach(btn => {
          btn.addEventListener('click', async () => {
            const activityId = btn.dataset.activityId;
            const isLiked = btn.dataset.liked === 'true';
            
            try {
              const activityRef = db.ref(`running_logs/${activityId}`);
              const snapshot = await activityRef.once('value');
              const activity = snapshot.val();
              
              let likedBy = activity.liked_by || [];
              let likes = activity.likes || 0;
              
              if (isLiked) {
                // Unlike
                likedBy = likedBy.filter(id => id !== currentUser.bib_number);
                likes = Math.max(0, likes - 1);
                btn.dataset.liked = 'false';
                btn.classList.remove('text-red-500');
                btn.classList.add('text-gray-500', 'hover:text-red-500');
                btn.querySelector('i').classList.remove('text-red-500');
                btn.querySelector('i').classList.add('text-gray-400');
              } else {
                // Like
                likedBy.push(currentUser.bib_number);
                likes += 1;
                btn.dataset.liked = 'true';
                btn.classList.add('text-red-500');
                btn.classList.remove('text-gray-500', 'hover:text-red-500');
                btn.querySelector('i').classList.add('text-red-500');
                btn.querySelector('i').classList.remove('text-gray-400');
              }
              
              await activityRef.update({
                liked_by: likedBy,
                likes: likes
              });
              
              btn.innerHTML = `
                <i class="fas fa-heart ${isLiked ? 'text-gray-400' : 'text-red-500'}"></i>
                ${likes}
              `;
            } catch (error) {
              console.error('Error updating like:', error);
            }
          });
        });
      } catch (error) {
        console.error('Error loading activity feed:', error);
        activityFeedList.innerHTML = `
          <div class="text-center py-10">
            <p class="text-red-500">Error loading activity feed. Please try again.</p>
          </div>
        `;
      }
    }

    // Ranking Component for runners
    async function renderRanking(container) {
      container.innerHTML = `
        <div class="animate-fadeIn">
          <div class="flex justify-between items-center mb-4 sm:mb-6">
            <h2 class="text-xl sm:text-2xl font-black tracking-tight dark:text-white">Runners Ranking</h2>
            <div class="flex items-center gap-2">
              <button class="px-3 py-1.5 text-sm bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-full font-bold">
                All Runners
              </button>
            </div>
          </div>
          
          <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-200 dark:border-zinc-700 overflow-hidden">
            <div class="p-3 sm:p-4 border-b border-gray-200 dark:border-zinc-700">
              <div class="grid grid-cols-12 gap-2 sm:gap-4 text-xs font-bold text-gray-500 dark:text-gray-400 uppercase">
                <div class="col-span-2 sm:col-span-1 text-center">Rank</div>
                <div class="col-span-4 sm:col-span-3">Runner</div>
                <div class="col-span-3 sm:col-span-2">Bib Number</div>
                <div class="col-span-3 sm:col-span-3 text-center">Distance</div>
                <div class="hidden sm:block col-span-3 text-center">Goal Progress</div>
              </div>
            </div>
            <div id="rankingList" class="divide-y divide-gray-100 dark:divide-zinc-700">
              <div class="p-4 text-center">
                <div class="inline-block animate-spin rounded-full h-6 w-6 border-2 border-orange-600 border-t-transparent"></div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading rankings...</p>
              </div>
            </div>
          </div>
        </div>
      `;

      // Load rankings
      try {
        const snapshot = await db.ref('runners').once('value');
        const runners = [];
        
        snapshot.forEach(childSnapshot => {
          const runner = childSnapshot.val();
          runners.push(runner);
        });

        // Sort by total distance
        runners.sort((a, b) => (parseFloat(b.total_distance) || 0) - (parseFloat(a.total_distance) || 0));
        
        const rankingList = document.getElementById('rankingList');
        rankingList.innerHTML = '';
        
        runners.forEach((runner, index) => {
          const isCurrentUser = runner.bib_number === currentUser.bib_number;
          const rank = index + 1;
          const totalDistance = parseFloat(runner.total_distance) || 0;
          const goal = runner.goal ? parseInt(runner.goal) : 100;
          const goalProgress = Math.min(100, Math.round((totalDistance / goal) * 100));
          
          let rankClass = 'text-gray-700 dark:text-gray-300';
          let rankIcon = '';
          
          if (rank === 1) {
            rankClass = 'crown-gold font-bold';
            rankIcon = 'üëë';
          } else if (rank === 2) {
            rankClass = 'crown-silver font-bold';
            rankIcon = 'ü•à';
          } else if (rank === 3) {
            rankClass = 'crown-bronze font-bold';
            rankIcon = 'ü•â';
          }
          
          const row = document.createElement('div');
          row.className = `p-3 sm:p-4 ${isCurrentUser ? 'bg-orange-50 dark:bg-orange-900/20' : ''} hover:bg-gray-50 dark:hover:bg-zinc-700/50 transition-colors`;
          row.innerHTML = `
            <div class="grid grid-cols-12 gap-2 sm:gap-4 items-center">
              <div class="col-span-2 sm:col-span-1 text-center">
                <div class="inline-flex items-center justify-center w-6 h-6 sm:w-8 sm:h-8 rounded-full ${rankClass} text-xs sm:text-sm">
                  ${rank} ${rankIcon}
                </div>
              </div>
              <div class="col-span-4 sm:col-span-3">
                <div class="flex items-center gap-2 sm:gap-3">
                  <div class="w-8 h-8 sm:w-10 sm:h-10 rounded-xl bg-gradient-to-tr ${isCurrentUser ? 'from-orange-600 to-amber-500' : 'from-blue-600 to-cyan-500'} flex items-center justify-center text-white text-xs sm:text-sm font-bold" style="background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('${RUNNER_BACKGROUND}') center/cover no-repeat;">
                    ${runner.nickname ? runner.nickname.substring(0, 2).toUpperCase() : 'RU'}
                  </div>
                  <div class="truncate">
                    <p class="font-bold dark:text-white text-xs sm:text-sm truncate">${runner.name}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400 truncate">"${runner.nickname}"</p>
                    <p class="text-xs text-orange-500 dark:text-orange-400">Goal: ${runner.goal || 'N/A'}</p>
                  </div>
                </div>
              </div>
              <div class="col-span-3 sm:col-span-2">
                <span class="bib-number font-bold text-xs sm:text-sm dark:text-white">${runner.bib_number}</span>
              </div>
              <div class="col-span-3 sm:col-span-3 text-center">
                <p class="font-bold text-sm sm:text-lg dark:text-white">${formatNumber(runner.total_distance || 0, 1)} km</p>
                <p class="text-xs text-gray-500 dark:text-gray-400">${runner.total_runs || 0} runs</p>
              </div>
              <div class="hidden sm:block col-span-3">
                <div class="flex items-center gap-2">
                  <div class="flex-1">
                    <div class="flex justify-between text-xs mb-1">
                      <span class="text-gray-600 dark:text-gray-400">${goalProgress}%</span>
                      <span class="font-bold text-orange-600 dark:text-orange-400">${runner.goal || 'N/A'}</span>
                    </div>
                    <div class="ranking-progress-bar">
                      <div class="ranking-progress-fill" style="width: ${goalProgress}%"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Mobile Goal Progress -->
            <div class="sm:hidden mt-3 pt-3 border-t border-gray-100 dark:border-zinc-700">
              <div class="flex items-center gap-2">
                <div class="flex-1">
                  <div class="flex justify-between text-xs mb-1">
                    <span class="text-gray-600 dark:text-gray-400">Goal: ${runner.goal || 'N/A'}</span>
                    <span class="font-bold text-orange-600 dark:text-orange-400">${goalProgress}%</span>
                  </div>
                  <div class="ranking-progress-bar">
                    <div class="ranking-progress-fill" style="width: ${goalProgress}%"></div>
                  </div>
                </div>
              </div>
            </div>
          `;
          rankingList.appendChild(row);
        });
      } catch (error) {
        console.error('Error loading rankings:', error);
        document.getElementById('rankingList').innerHTML = `
          <div class="p-4 sm:p-8 text-center">
            <p class="text-red-500">Error loading rankings. Please try again.</p>
          </div>
        `;
      }
    }

    // My Activities Component for runners
    async function renderMyActivities(container) {
      container.innerHTML = `
        <div class="animate-fadeIn">
          <div class="flex justify-between items-center mb-4 sm:mb-6">
            <h2 class="text-xl sm:text-2xl font-black tracking-tight dark:text-white">My Activities</h2>
          </div>
          
          <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-sm border border-gray-200 dark:border-zinc-700 overflow-hidden">
            <div id="myActivitiesList" class="divide-y divide-gray-100 dark:divide-zinc-700">
              <div class="p-4 text-center">
                <div class="inline-block animate-spin rounded-full h-6 w-6 border-2 border-orange-600 border-t-transparent"></div>
                <p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Loading your activities...</p>
              </div>
            </div>
          </div>
        </div>
      `;

      // Load user activities
      try {
        const snapshot = await db.ref('running_logs').orderByChild('bib_number').equalTo(currentUser.bib_number).once('value');
        const activities = [];
        
        snapshot.forEach(childSnapshot => {
          const activity = childSnapshot.val();
          activity.id = childSnapshot.key;
          activities.push(activity);
        });

        // Sort by date
        activities.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        const activitiesList = document.getElementById('myActivitiesList');
        
        if (activities.length === 0) {
          activitiesList.innerHTML = `
            <div class="p-6 sm:p-8 text-center">
              <div class="w-16 h-16 sm:w-20 sm:h-20 mx-auto mb-4 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
                <i class="fas fa-running text-2xl sm:text-3xl text-orange-600 dark:text-orange-400"></i>
              </div>
              <h4 class="font-bold text-lg mb-2 dark:text-white">No activities logged yet</h4>
              <p class="text-gray-500 dark:text-gray-400 mb-6 text-sm sm:text-base">Start your running journey by logging your first activity!</p>
              <button id="logFirstActivity" class="px-6 py-3 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded-xl transition-all">
                Log Your First Activity
              </button>
            </div>
          `;
          
          document.getElementById('logFirstActivity')?.addEventListener('click', () => {
            isLogActivityModalOpen = true;
            renderLogActivityModal();
          });
        } else {
          activitiesList.innerHTML = '';
          
          activities.forEach(activity => {
            const activityDate = new Date(activity.date);
            const formattedDate = activityDate.toLocaleDateString('en-GB', { 
              day: 'numeric', 
              month: 'short', 
              year: 'numeric' 
            });
            const formattedTime = activityDate.toLocaleTimeString('en-GB', { 
              hour: '2-digit', 
              minute: '2-digit' 
            });
            
            const activityCard = document.createElement('div');
            activityCard.className = 'p-4 sm:p-6 hover:bg-gray-50 dark:hover:bg-zinc-700/50 transition-colors';
            activityCard.innerHTML = `
              <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div class="flex-1">
                  <div class="flex items-center gap-3 mb-2">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white">
                      <i class="fas fa-running"></i>
                    </div>
                    <div>
                      <h3 class="font-bold dark:text-white">${activity.activity_type || 'Run'} - ${activity.distance} km</h3>
                      <p class="text-sm text-gray-500 dark:text-gray-400">${formattedDate} at ${formattedTime}</p>
                    </div>
                  </div>
                  <div class="grid grid-cols-3 gap-2 mt-3">
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.distance}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Distance</p>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.duration}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Duration</p>
                    </div>
                    <div class="text-center p-2 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
                      <p class="font-bold dark:text-white">${activity.pace}</p>
                      <p class="text-xs text-gray-500 dark:text-gray-400">Pace</p>
                    </div>
                  </div>
                  ${activity.notes ? `
                    <div class="mt-3 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                      <p class="text-sm dark:text-white italic">"${activity.notes}"</p>
                    </div>
                  ` : ''}
                  ${activity.proof_image && activity.status === 'approved' ? `
                    <!-- FEATURE 5: Proof image only shown in admin panel - removed from runner portal -->
                  ` : ''}
                </div>
                <div class="flex flex-col items-end gap-2">
                  <span class="px-3 py-1 rounded-full text-xs font-bold ${
                    activity.status === 'approved' ? 'status-approved' : 
                    activity.status === 'pending' ? 'status-pending' : 
                    'status-rejected'
                  }">
                    ${activity.status || 'pending'}
                  </span>
                  <p class="text-xs text-gray-500 dark:text-gray-400">${activity.likes || 0} likes</p>
                </div>
              </div>
            `;
            activitiesList.appendChild(activityCard);
          });
        }
      } catch (error) {
        console.error('Error loading activities:', error);
        document.getElementById('myActivitiesList').innerHTML = `
          <div class="p-4 sm:p-8 text-center">
            <p class="text-red-500">Error loading activities. Please try again.</p>
          </div>
        `;
      }
    }

    // Log Activity Modal (for runners) - Simplified Version (FEATURE 4)
    function renderLogActivityModal() {
      const modal = document.createElement('div');
      modal.className = 'fixed inset-0 z-[999] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fadeIn';
      modal.innerHTML = `
        <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-zinc-700">
          <div class="p-4 sm:p-6">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
              <h2 class="text-xl font-black dark:text-white">Log New Activity</h2>
              <button id="closeModal" class="p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full text-gray-400">
                <i class="fas fa-times text-lg"></i>
              </button>
            </div>
            
            <form id="logActivityForm" class="space-y-4 sm:space-y-5 simple-log-form">
              <!-- Activity Type -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Activity Type</label>
                <div class="grid grid-cols-2 gap-2">
                  <button type="button" data-type="run" class="activity-type-btn flex items-center justify-center gap-2 p-3 rounded-xl border-2 border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-400 transition-all">
                    <i class="fas fa-running"></i>
                    <span class="font-bold">Run</span>
                  </button>
                  <button type="button" data-type="walk" class="activity-type-btn flex items-center justify-center gap-2 p-3 rounded-xl border-2 border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-400 transition-all">
                    <i class="fas fa-walking"></i>
                    <span class="font-bold">Walk</span>
                  </button>
                </div>
              </div>
              
              <!-- Date -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Date</label>
                <input 
                  type="date" 
                  id="activityDate"
                  value="${new Date().toISOString().split('T')[0]}"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-orange-600 dark:text-white"
                  required
                />
              </div>
              
              <!-- Proof Image Upload -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Proof Image *</label>
                <div class="image-preview-container" id="imagePreviewContainer">
                  <div class="image-preview-placeholder" id="imagePlaceholder">
                    <i class="fas fa-cloud-upload-alt text-3xl mb-2 text-gray-400"></i>
                    <p class="text-sm">Click to upload proof image</p>
                    <p class="text-xs text-gray-500">PNG, JPG, JPEG up to 5MB</p>
                  </div>
                  <img id="imagePreview" class="image-preview hidden" alt="Proof image preview">
                </div>
                <input type="file" id="proofImage" accept="image/*" class="hidden" required>
              </div>
              
              <!-- FEATURE 4: Removed Distance, Duration, Pace fields for runners -->
              
              <!-- Notes -->
              <div>
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Notes (Optional)</label>
                <textarea 
                  id="notes"
                  rows="3"
                  placeholder="How was your run? Any milestones achieved?"
                  class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-orange-600 dark:text-white"
                ></textarea>
              </div>
              
              <!-- Submit Button -->
              <button 
                type="submit"
                id="submitActivityBtn"
                class="w-full bg-orange-600 hover:bg-orange-700 text-white font-black py-3 sm:py-4 rounded-xl shadow-xl shadow-orange-600/20 transition-all flex items-center justify-center gap-2"
              >
                <i class="fas fa-plus"></i>
                SUBMIT ACTIVITY
              </button>
            </form>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Add event listeners
      const closeBtn = modal.querySelector('#closeModal');
      const activityTypeBtns = modal.querySelectorAll('.activity-type-btn');
      const form = modal.querySelector('#logActivityForm');
      const imagePreviewContainer = modal.querySelector('#imagePreviewContainer');
      const imagePreview = modal.querySelector('#imagePreview');
      const imagePlaceholder = modal.querySelector('#imagePlaceholder');
      const proofImageInput = modal.querySelector('#proofImage');
      
      let selectedActivityType = 'run';
      let selectedImageFile = null;
      
      // Set initial activity type
      activityTypeBtns[0].classList.add('active', 'border-orange-600', 'text-orange-600');
      
      // Activity type selection
      activityTypeBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          selectedActivityType = btn.dataset.type;
          activityTypeBtns.forEach(b => {
            b.classList.remove('active', 'border-orange-600', 'text-orange-600');
          });
          btn.classList.add('active', 'border-orange-600', 'text-orange-600');
        });
      });
      
      // Image upload handling
      imagePreviewContainer.addEventListener('click', () => {
        proofImageInput.click();
      });
      
      proofImageInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          if (file.size > 5 * 1024 * 1024) {
            alert('File size must be less than 5MB');
            return;
          }
          
          selectedImageFile = file;
          const reader = new FileReader();
          reader.onload = (e) => {
            imagePreview.src = e.target.result;
            imagePreview.classList.remove('hidden');
            imagePlaceholder.classList.add('hidden');
          };
          reader.readAsDataURL(file);
        }
      });
      
      // Close modal
      closeBtn.addEventListener('click', () => {
        document.body.removeChild(modal);
        isLogActivityModalOpen = false;
      });
      
      // Form submission
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const submitBtn = modal.querySelector('#submitActivityBtn');
        const originalText = submitBtn.innerHTML;
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<div class="inline-block animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div> Processing...';
        
        try {
          // Validate inputs
          const date = modal.querySelector('#activityDate').value;
          const notes = modal.querySelector('#notes').value;
          
          if (!selectedImageFile) {
            throw new Error('Please upload a proof image');
          }
          
          if (!date) {
            throw new Error('Please select a date');
          }
          
          // Upload image
          let imageUrl = null;
          if (selectedImageFile) {
            const storageRef = storage.ref();
            const imageRef = storageRef.child(`activity_proofs/${Date.now()}_${selectedImageFile.name}`);
            await imageRef.put(selectedImageFile);
            imageUrl = await imageRef.getDownloadURL();
          }
          
          // Save activity to database with pending status
          // FEATURE 4: Distance, Duration, Pace will be added by admin
          const activityData = {
            bib_number: currentUser.bib_number,
            runner_name: currentUser.name,
            nickname: currentUser.nickname,
            date: date,
            distance: 0, // Will be updated by admin
            duration: 0, // Will be updated by admin
            pace: 0, // Will be updated by admin
            activity_type: selectedActivityType,
            notes: notes || null,
            proof_image: imageUrl,
            status: 'pending',
            submission_date: new Date().toISOString(),
            likes: 0,
            liked_by: []
          };
          
          await db.ref('running_logs').push(activityData);
          
          // FEATURE 6: Show running shoes animation like Strava
          showStravaRunningShoesAnimation();
          
          alert('Activity submitted for approval! Admin will review your proof image and add the distance, duration, and pace.');
          
          // Close modal
          setTimeout(() => {
            document.body.removeChild(modal);
            isLogActivityModalOpen = false;
            
            // Refresh activities tab
            activeTab = 'activities';
            renderContent();
          }, 3000);
          
        } catch (error) {
          alert('Error: ' + error.message);
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;
        }
      });
      
      // Close modal when clicking outside
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          document.body.removeChild(modal);
          isLogActivityModalOpen = false;
        }
      });
    }

    // Format date for display
    function formatDate(date) {
      return date.toLocaleDateString('en-GB', { 
        day: 'numeric', 
        month: 'short', 
        year: 'numeric' 
      });
    }

    // Load filtered activities for runners
    async function loadFilteredActivities() {
      const filteredActivitiesList = document.getElementById('filteredActivitiesList');
      if (!filteredActivitiesList) return;

      try {
        const snapshot = await db.ref('running_logs').once('value');
        let activities = [];
        let runnerActivitiesData = {};
        
        snapshot.forEach(childSnapshot => {
          const activity = childSnapshot.val();
          activity.id = childSnapshot.key;
          activities.push(activity);
          
          // Track runner activities for distance calculation
          if (!runnerActivitiesData[activity.bib_number]) {
            runnerActivitiesData[activity.bib_number] = {
              count: 0,
              totalDistance: 0
            };
          }
          runnerActivitiesData[activity.bib_number].count++;
          runnerActivitiesData[activity.bib_number].totalDistance += parseFloat(activity.distance) || 0;
        });

        // Filter by date
        activities = activities.filter(activity => {
          const activityDate = new Date(activity.date);
          return activityDate.toDateString() === selectedDate.toDateString();
        });

        // Filter by runner
        if (filterRunner !== 'all') {
          activities = activities.filter(activity => activity.bib_number === filterRunner);
        }

        // Sort by date (newest first)
        activities.sort((a, b) => new Date(b.date) - new Date(a.date));

        if (activities.length === 0) {
          filteredActivitiesList.innerHTML = `
            <div class="text-center py-6">
              <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-gray-100 dark:bg-zinc-700 flex items-center justify-center">
                <i class="fas fa-search text-gray-400 text-xl"></i>
              </div>
              <p class="text-gray-500 dark:text-gray-400 font-medium">No activities found for ${formatDate(selectedDate)}</p>
              <p class="text-sm text-gray-400 mt-1">Try changing your filters or select another date</p>
            </div>
          `;
          return;
        }

        // Show runner distance info if filtered by specific runner
        let runnerInfoHTML = '';
        if (filterRunner !== 'all' && runnerActivitiesData[filterRunner]) {
          const runnerData = runnerActivitiesData[filterRunner];
          runnerInfoHTML = `
            <div class="mb-4 p-3 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-lg border border-orange-200 dark:border-orange-700">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm font-bold text-orange-700 dark:text-orange-300">Runner Summary</p>
                  <p class="text-xs text-orange-600 dark:text-orange-400">Activities on ${formatDate(selectedDate)}</p>
                </div>
                <div class="text-right">
                  <p class="text-lg font-black text-orange-700 dark:text-orange-300">${runnerData.count}</p>
                  <p class="text-xs text-orange-600 dark:text-orange-400">activities</p>
                </div>
              </div>
              <div class="mt-2 text-center">
                <p class="text-sm font-bold text-gray-700 dark:text-gray-300">Total Distance: <span class="text-orange-600 dark:text-orange-400">${formatNumber(runnerData.totalDistance, 2)} km</span></p>
              </div>
            </div>
          `;
        }

        filteredActivitiesList.innerHTML = runnerInfoHTML + activities.map(activity => {
          const activityDate = new Date(activity.date);
          const formattedTime = activityDate.toLocaleTimeString('en-GB', { 
            hour: '2-digit', 
            minute: '2-digit' 
          });
          
          return `
            <div class="p-3 bg-gray-50 dark:bg-zinc-700/50 rounded-xl">
              <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                  <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white text-xs font-bold">
                    ${activity.nickname ? activity.nickname.substring(0, 2).toUpperCase() : 'RU'}
                  </div>
                  <div>
                    <p class="text-sm font-bold dark:text-white">${activity.nickname || activity.runner_name}</p>
                    <p class="text-xs text-gray-500 dark:text-gray-400">${activity.bib_number}</p>
                  </div>
                </div>
                <span class="text-xs text-gray-500 dark:text-gray-400">${formattedTime}</span>
              </div>
              
              <div class="grid grid-cols-3 gap-2 mt-3">
                <div class="text-center p-2 bg-white dark:bg-zinc-800 rounded-lg">
                  <p class="font-bold text-lg dark:text-white">${activity.distance} km</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">Distance (km)</p>
                </div>
                <div class="text-center p-2 bg-white dark:bg-zinc-800 rounded-lg">
                  <p class="font-bold text-lg dark:text-white">${activity.duration} min</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">Duration (min)</p>
                </div>
                <div class="text-center p-2 bg-white dark:bg-zinc-800 rounded-lg">
                  <p class="font-bold text-lg dark:text-white">${activity.pace}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">Pace (min/km)</p>
                </div>
              </div>
              
              ${activity.notes ? `
                <div class="mt-3 p-2 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
                  <p class="text-xs dark:text-white italic">"${activity.notes}"</p>
                </div>
              ` : ''}
              
              ${activity.proof_image && activity.status === 'approved' ? `
                <!-- FEATURE 5: Proof image not shown in runner portal -->
              ` : ''}
            </div>
          `;
        }).join('');
      } catch (error) {
        console.error('Error loading filtered activities:', error);
        filteredActivitiesList.innerHTML = `
          <div class="text-center py-6">
            <p class="text-red-500">Error loading activities. Please try again.</p>
          </div>
        `;
      }
    }

    // Utility Functions
    function toggleSidebar() {
      isSidebarOpen = !isSidebarOpen;
      renderMainApp();
    }

    function handleLogout() {
      auth.signOut();
      localStorage.removeItem('currentUser');
      currentUser = null;
      isAdmin = false;
      renderLogin();
    }

    function updateSidebarButtons() {
      // Update sidebar tab buttons
      document.querySelectorAll('.sidebar-tab-btn').forEach(btn => {
        const tabId = btn.dataset.tab;
        if (tabId === activeTab) {
          if (isAdmin) {
            btn.classList.add('bg-red-600', 'text-white', 'shadow-lg', 'shadow-red-600/20');
            btn.classList.remove('text-gray-400', 'hover:bg-zinc-800', 'hover:text-white');
          } else {
            btn.classList.add('bg-orange-600', 'text-white', 'shadow-lg', 'shadow-orange-600/20');
            btn.classList.remove('text-gray-400', 'hover:bg-zinc-800', 'hover:text-white');
          }
        } else {
          btn.classList.remove('bg-orange-600', 'text-white', 'shadow-lg', 'shadow-orange-600/20', 'bg-red-600', 'shadow-red-600/20');
          btn.classList.add('text-gray-400', 'hover:bg-zinc-800', 'hover:text-white');
        }
      });

      // Update mobile tab buttons (only for runners)
      if (!isAdmin) {
        document.querySelectorAll('.mobile-tab-btn').forEach(btn => {
          const tabId = btn.dataset.tab;
          if (tabId === activeTab) {
            btn.classList.add('text-orange-600');
            btn.classList.remove('text-gray-500', 'dark:text-gray-400');
          } else {
            btn.classList.remove('text-orange-600');
            btn.classList.add('text-gray-500', 'dark:text-gray-400');
          }
        });
      }

      // Add sidebar logout listener
      const sidebarLogout = document.getElementById('sidebarLogout');
      if (sidebarLogout) {
        sidebarLogout.addEventListener('click', handleLogout);
      }

      // Add sidebar tab listeners
      document.querySelectorAll('.sidebar-tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          activeTab = btn.dataset.tab;
          isSidebarOpen = false;
          renderMainApp();
        });
      });

      // Add sidebar overlay listener
      const overlay = document.getElementById('sidebarOverlay');
      if (overlay) {
        overlay.addEventListener('click', () => {
          isSidebarOpen = false;
          renderMainApp();
        });
      }
    }

    // Initialize the application
    initApp();
  </script>
  <script>
    // Load filtered activities for runners - MODIFIED VERSION with total distance and activities
async function loadFilteredActivities() {
  const filteredActivitiesList = document.getElementById('filteredActivitiesList');
  if (!filteredActivitiesList) return;

  try {
    const snapshot = await db.ref('running_logs').once('value');
    let activities = [];
    
    snapshot.forEach(childSnapshot => {
      const activity = childSnapshot.val();
      activity.id = childSnapshot.key;
      activities.push(activity);
    });

    // Filter by date
    activities = activities.filter(activity => {
      const activityDate = new Date(activity.date);
      return activityDate.toDateString() === selectedDate.toDateString();
    });

    // MODIFIED: If no runner selected, show message
    if (filterRunner === 'all' || !filterRunner || filterRunner === '') {
      filteredActivitiesList.innerHTML = `
        <div class="text-center py-10">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
            <i class="fas fa-user-friends text-2xl text-orange-600 dark:text-orange-400"></i>
          </div>
          <h4 class="font-bold text-lg mb-2 dark:text-white">Select a Runner</h4>
          <p class="text-gray-500 dark:text-gray-400 mb-6">Please select a runner from the dropdown to view their activities</p>
          <div class="flex items-center justify-center gap-2">
            <div class="w-2 h-2 bg-orange-500 rounded-full animate-pulse"></div>
            <p class="text-sm text-orange-600 font-bold">Choose a runner to see their activities</p>
          </div>
        </div>
      `;
      return;
    }

    // Filter by runner
    activities = activities.filter(activity => activity.bib_number === filterRunner);

    // Sort by date (newest first)
    activities.sort((a, b) => new Date(b.date) - new Date(a.date));

    // Get ALL activities for this runner (not just filtered by date) for total stats
    const allActivitiesSnapshot = await db.ref('running_logs').once('value');
    let allRunnerActivities = [];
    let totalDistanceAllTime = 0;
    let totalActivitiesAllTime = 0;
    
    allActivitiesSnapshot.forEach(childSnapshot => {
      const activity = childSnapshot.val();
      if (activity.bib_number === filterRunner) {
        allRunnerActivities.push(activity);
        totalActivitiesAllTime++;
        totalDistanceAllTime += parseFloat(activity.distance) || 0;
      }
    });

    // Calculate statistics for today's activities
    let totalDistanceToday = 0;
    let totalDurationToday = 0;
    let avgPaceToday = 0;
    
    activities.forEach(activity => {
      totalDistanceToday += parseFloat(activity.distance) || 0;
      totalDurationToday += parseFloat(activity.duration) || 0;
    });
    
    if (activities.length > 0 && totalDistanceToday > 0) {
      avgPaceToday = totalDurationToday / totalDistanceToday;
    }

    if (activities.length === 0) {
      // Show runner stats even if no activities today
      let runnerName = '';
      let runnerNickname = '';
      
      // Try to get runner info from database
      const runnerSnapshot = await db.ref(`runners/${filterRunner}`).once('value');
      if (runnerSnapshot.exists()) {
        const runner = runnerSnapshot.val();
        runnerName = runner.name;
        runnerNickname = runner.nickname;
      }
      
      filteredActivitiesList.innerHTML = `
        <div class="mb-6 p-4 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-xl text-white shadow-lg">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-white">
                <i class="fas fa-user text-xl"></i>
              </div>
              <div>
                <h3 class="text-lg font-black">${runnerName || filterRunner}</h3>
                <p class="text-blue-100">"${runnerNickname || 'Runner'}" ‚Ä¢ ${filterRunner}</p>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 gap-3 mt-4">
            <div class="text-center p-3 bg-white/20 backdrop-blur-sm rounded-lg">
              <p class="text-xl font-black">${formatNumber(totalDistanceAllTime, 1)}</p>
              <p class="text-xs">Total km (All Time)</p>
            </div>
            <div class="text-center p-3 bg-white/20 backdrop-blur-sm rounded-lg">
              <p class="text-xl font-black">${totalActivitiesAllTime}</p>
              <p class="text-xs">Total Activities</p>
            </div>
          </div>
        </div>
        
        <div class="text-center py-10">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center">
            <i class="fas fa-running text-2xl text-orange-600 dark:text-orange-400"></i>
          </div>
          <h4 class="font-bold text-lg mb-2 dark:text-white">No Activities Today</h4>
          <p class="text-gray-500 dark:text-gray-400 mb-4">${runnerName || filterRunner} has no activities for ${formatDate(selectedDate)}</p>
          <div class="p-3 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-lg border border-orange-200 dark:border-orange-700">
            <p class="text-sm font-bold text-orange-700 dark:text-orange-300">Total all-time: ${formatNumber(totalDistanceAllTime, 1)} km in ${totalActivitiesAllTime} activities</p>
          </div>
        </div>
      `;
      return;
    }

    // Get runner info for the header
    let runnerInfoHTML = '';
    let runnerName = activities[0].runner_name;
    let runnerNickname = activities[0].nickname;
    
    runnerInfoHTML = `
      <div class="mb-6 p-4 bg-gradient-to-r from-orange-600 to-amber-500 rounded-xl text-white shadow-lg">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center text-white">
              <i class="fas fa-user text-xl"></i>
            </div>
            <div>
              <h3 class="text-lg font-black">${runnerName}</h3>
              <p class="text-orange-100">"${runnerNickname}" ‚Ä¢ ${filterRunner}</p>
            </div>
          </div>
          <div class="text-right">
            <div class="bg-white/20 backdrop-blur-sm px-3 py-1 rounded-lg">
              <p class="text-lg font-black">${activities.length}</p>
              <p class="text-xs">Today's Activities</p>
            </div>
          </div>
        </div>
        
        <!-- Today's Stats -->
        <div class="mb-4 p-3 bg-white/20 backdrop-blur-sm rounded-lg">
          <p class="text-xs font-bold mb-2 text-orange-200">TODAY'S SUMMARY - ${formatDate(selectedDate)}</p>
          <div class="grid grid-cols-3 gap-3">
            <div class="text-center p-2">
              <p class="text-xl font-black">${formatNumber(totalDistanceToday, 1)}</p>
              <p class="text-xs">Total km</p>
            </div>
            <div class="text-center p-2">
              <p class="text-xl font-black">${formatNumber(totalDurationToday, 0)}</p>
              <p class="text-xs">Total min</p>
            </div>
            <div class="text-center p-2">
              <p class="text-xl font-black">${formatNumber(avgPaceToday, 2)}</p>
              <p class="text-xs">Avg Pace</p>
            </div>
          </div>
        </div>
        
        <!-- All-Time Stats -->
        <div class="p-3 bg-white/20 backdrop-blur-sm rounded-lg">
          <p class="text-xs font-bold mb-2 text-orange-200">ALL-TIME STATS</p>
          <div class="grid grid-cols-2 gap-3">
            <div class="text-center p-2">
              <p class="text-xl font-black">${formatNumber(totalDistanceAllTime, 1)}</p>
              <p class="text-xs">Total km</p>
            </div>
            <div class="text-center p-2">
              <p class="text-xl font-black">${totalActivitiesAllTime}</p>
              <p class="text-xs">Total Activities</p>
            </div>
          </div>
        </div>
      </div>
    `;

    filteredActivitiesList.innerHTML = runnerInfoHTML + activities.map(activity => {
      const activityDate = new Date(activity.date);
      const formattedTime = activityDate.toLocaleTimeString('en-GB', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
      
      return `
        <div class="mb-4 p-4 bg-white dark:bg-zinc-800 rounded-xl shadow-sm border border-gray-100 dark:border-zinc-700 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center text-white">
                <i class="fas fa-running"></i>
              </div>
              <div>
                <h4 class="font-bold dark:text-white">${activity.activity_type || 'Run'}</h4>
                <div class="flex items-center gap-2">
                  <span class="text-xs px-2 py-1 rounded-full ${
                    activity.status === 'approved' ? 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400' : 
                    activity.status === 'pending' ? 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400' : 
                    'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400'
                  }">
                    ${activity.status || 'pending'}
                  </span>
                  <span class="text-xs text-gray-500 dark:text-gray-400">${formattedTime}</span>
                </div>
              </div>
            </div>
            <div class="text-right">
              <p class="text-2xl font-black text-orange-600 dark:text-orange-400">${activity.distance}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">kilometers</p>
            </div>
          </div>
          
          <div class="grid grid-cols-3 gap-3 mt-4">
            <div class="text-center p-3 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
              <p class="text-lg font-black dark:text-white">${activity.distance}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Distance (km)</p>
            </div>
            <div class="text-center p-3 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
              <p class="text-lg font-black dark:text-white">${activity.duration}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Duration (min)</p>
            </div>
            <div class="text-center p-3 bg-gray-50 dark:bg-zinc-700/50 rounded-lg">
              <p class="text-lg font-black dark:text-white">${activity.pace}</p>
              <p class="text-xs text-gray-500 dark:text-gray-400">Pace (min/km)</p>
            </div>
          </div>
          
          ${activity.notes ? `
            <div class="mt-4 p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg">
              <p class="text-sm font-bold text-orange-700 dark:text-orange-300 mb-1">Notes:</p>
              <p class="text-sm dark:text-white italic">"${activity.notes}"</p>
            </div>
          ` : ''}
          
          <div class="mt-4 pt-3 border-t border-gray-100 dark:border-zinc-700 flex items-center justify-between">
            <div class="flex items-center gap-1">
              <i class="fas fa-heart text-red-500"></i>
              <span class="text-sm text-gray-600 dark:text-gray-400">${activity.likes || 0} likes</span>
            </div>
            <div class="text-xs text-gray-500 dark:text-gray-400">
              ${new Date(activity.submission_date).toLocaleDateString('en-GB', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
              })}
            </div>
          </div>
        </div>
      `;
    }).join('');
  } catch (error) {
    console.error('Error loading filtered activities:', error);
    filteredActivitiesList.innerHTML = `
      <div class="text-center py-6">
        <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center">
          <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400 text-xl"></i>
        </div>
        <p class="text-red-500 font-medium">Error loading activities</p>
        <p class="text-sm text-gray-400 mt-1">Please try again or check your connection</p>
      </div>
    `;
  }
}
  </script>
  
  <script>
    // Log Activity Modal (for runners) - Simplified Version (FEATURE 4)
function renderLogActivityModal() {
  const modal = document.createElement('div');
  modal.className = 'fixed inset-0 z-[999] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-fadeIn';
  modal.innerHTML = `
    <div class="bg-white dark:bg-zinc-800 rounded-2xl sm:rounded-3xl shadow-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto border border-gray-200 dark:border-zinc-700">
      <div class="p-4 sm:p-6">
        <div class="flex items-center justify-between mb-4 sm:mb-6">
          <h2 class="text-xl font-black dark:text-white">Log New Activity</h2>
          <button id="closeModal" class="p-2 hover:bg-gray-100 dark:hover:bg-zinc-700 rounded-full text-gray-400">
            <i class="fas fa-times text-lg"></i>
          </button>
        </div>
        
        <form id="logActivityForm" class="space-y-4 sm:space-y-5 simple-log-form">
          <!-- Activity Type -->
          <div>
            <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Activity Type</label>
            <div class="grid grid-cols-2 gap-2">
              <button type="button" data-type="run" class="activity-type-btn flex items-center justify-center gap-2 p-3 rounded-xl border-2 border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-400 transition-all">
                <i class="fas fa-running"></i>
                <span class="font-bold">Run</span>
              </button>
              <button type="button" data-type="walk" class="activity-type-btn flex items-center justify-center gap-2 p-3 rounded-xl border-2 border-gray-200 dark:border-zinc-700 text-gray-600 dark:text-gray-400 transition-all">
                <i class="fas fa-walking"></i>
                <span class="font-bold">Walk</span>
              </button>
            </div>
          </div>
          
          <!-- Date -->
          <div>
            <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Date</label>
            <input 
              type="date" 
              id="activityDate"
              value="${new Date().toISOString().split('T')[0]}"
              class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-orange-600 dark:text-white"
              required
            />
          </div>
          
          <!-- Proof Image Upload -->
          <div>
            <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Proof Image *</label>
            <div class="image-preview-container" id="imagePreviewContainer">
              <div class="image-preview-placeholder" id="imagePlaceholder">
                <i class="fas fa-cloud-upload-alt text-3xl mb-2 text-gray-400"></i>
                <p class="text-sm">Click to upload proof image</p>
                <p class="text-xs text-gray-500">PNG, JPG, JPEG up to 5MB</p>
              </div>
              <img id="imagePreview" class="image-preview hidden" alt="Proof image preview">
            </div>
            <input type="file" id="proofImage" accept="image/*" class="hidden" required>
          </div>
          
          <!-- FEATURE 4: Removed Distance, Duration, Pace fields for runners -->
          
          <!-- Notes -->
          <div>
            <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-widest mb-2">Notes (Optional)</label>
            <textarea 
              id="notes"
              rows="3"
              placeholder="How was your run? Any milestones achieved?"
              class="w-full bg-gray-50 dark:bg-zinc-700 border-none rounded-xl p-3 text-sm font-bold focus:ring-2 focus:ring-orange-600 dark:text-white"
            ></textarea>
          </div>
          
          <!-- Submit Button -->
          <button 
            type="submit"
            id="submitActivityBtn"
            class="w-full bg-orange-600 hover:bg-orange-700 text-white font-black py-3 sm:py-4 rounded-xl shadow-xl shadow-orange-600/20 transition-all flex items-center justify-center gap-2"
          >
            <i class="fas fa-plus"></i>
            SUBMIT ACTIVITY
          </button>
        </form>
      </div>
    </div>
  `;
  
  document.body.appendChild(modal);
  
  // Add event listeners
  const closeBtn = modal.querySelector('#closeModal');
  const activityTypeBtns = modal.querySelectorAll('.activity-type-btn');
  const form = modal.querySelector('#logActivityForm');
  const imagePreviewContainer = modal.querySelector('#imagePreviewContainer');
  const imagePreview = modal.querySelector('#imagePreview');
  const imagePlaceholder = modal.querySelector('#imagePlaceholder');
  const proofImageInput = modal.querySelector('#proofImage');
  
  let selectedActivityType = 'run';
  let selectedImageFile = null;
  
  // Set initial activity type
  activityTypeBtns[0].classList.add('active', 'border-orange-600', 'text-orange-600');
  
  // Activity type selection
  activityTypeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      selectedActivityType = btn.dataset.type;
      activityTypeBtns.forEach(b => {
        b.classList.remove('active', 'border-orange-600', 'text-orange-600');
      });
      btn.classList.add('active', 'border-orange-600', 'text-orange-600');
    });
  });
  
  // Image upload handling
  imagePreviewContainer.addEventListener('click', () => {
    proofImageInput.click();
  });
  
  proofImageInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB');
        return;
      }
      
      selectedImageFile = file;
      const reader = new FileReader();
      reader.onload = (e) => {
        imagePreview.src = e.target.result;
        imagePreview.classList.remove('hidden');
        imagePlaceholder.classList.add('hidden');
      };
      reader.readAsDataURL(file);
    }
  });
  
  // Close modal
  closeBtn.addEventListener('click', () => {
    document.body.removeChild(modal);
    isLogActivityModalOpen = false;
  });
  
  // Form submission
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitBtn = modal.querySelector('#submitActivityBtn');
    const originalText = submitBtn.innerHTML;
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<div class="inline-block animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"></div> Processing...';
    
    try {
      // Validate inputs
      const date = modal.querySelector('#activityDate').value;
      const notes = modal.querySelector('#notes').value;
      
      if (!selectedImageFile) {
        throw new Error('Please upload a proof image');
      }
      
      if (!date) {
        throw new Error('Please select a date');
      }
      
      // Upload image
      let imageUrl = null;
      if (selectedImageFile) {
        const storageRef = storage.ref();
        const imageRef = storageRef.child(`activity_proofs/${Date.now()}_${selectedImageFile.name}`);
        await imageRef.put(selectedImageFile);
        imageUrl = await imageRef.getDownloadURL();
      }
      
      // Save activity to database with pending status
      // FEATURE 4: Distance, Duration, Pace will be added by admin
      const activityData = {
        bib_number: currentUser.bib_number,
        runner_name: currentUser.name,
        nickname: currentUser.nickname,
        date: date,
        distance: 0, // Will be updated by admin
        duration: 0, // Will be updated by admin
        pace: 0, // Will be updated by admin
        activity_type: selectedActivityType,
        notes: notes || null,
        proof_image: imageUrl,
        status: 'pending',
        submission_date: new Date().toISOString(),
        likes: 0,
        liked_by: []
      };
      
      await db.ref('running_logs').push(activityData);
      
      // REMOVED: alert('Activity submitted for approval! Admin will review your proof image and add the distance, duration, and pace.');
      
      // Close modal first
      document.body.removeChild(modal);
      isLogActivityModalOpen = false;
      
      // Show enhanced running shoes animation immediately
      showEnhancedRunningShoesAnimation();
      
      // Refresh activities tab after animation
      setTimeout(() => {
        activeTab = 'activities';
        renderContent();
      }, 4000);
      
    } catch (error) {
      alert('Error: ' + error.message);
      submitBtn.disabled = false;
      submitBtn.innerHTML = originalText;
    }
  });
  
  // Close modal when clicking outside
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      document.body.removeChild(modal);
      isLogActivityModalOpen = false;
    }
  });
}

// Enhanced Running Shoes Animation with Black Screen
function showEnhancedRunningShoesAnimation() {
  const animationContainer = document.createElement('div');
  animationContainer.className = 'fixed inset-0 z-[1000000] animate-fadeIn';
  animationContainer.style.cssText = `
    background: linear-gradient(135deg, #000000 0%, #1a1a2e 50%, #16213e 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    overflow: hidden;
  `;
  
  animationContainer.innerHTML = `
    <!-- Animated Background Elements -->
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute -top-1/2 -left-1/2 w-full h-full bg-gradient-to-br from-orange-600/10 to-transparent rounded-full blur-3xl animate-pulse"></div>
      <div class="absolute -bottom-1/2 -right-1/2 w-full h-full bg-gradient-to-tl from-amber-600/10 to-transparent rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    </div>
    
    <!-- Floating Shoes -->
    <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 20%; left: 15%; transform: rotate(-15deg);">üëü</div>
    <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 30%; left: 70%; transform: rotate(10deg); animation-delay: 0.2s;">üëü</div>
    <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 60%; left: 20%; transform: rotate(5deg); animation-delay: 0.4s;">üëü</div>
    <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 70%; left: 65%; transform: rotate(-10deg); animation-delay: 0.6s;">üëü</div>
    <div class="running-shoe-fullscreen animate-running-shoes-fullscreen" style="top: 40%; left: 40%; transform: rotate(15deg); animation-delay: 0.8s;">üëü</div>
    
    <!-- Central Content -->
    <div class="relative z-10 text-center px-6">
      <div class="mb-8">
        <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-gradient-to-tr from-orange-600 to-amber-500 flex items-center justify-center shadow-2xl shadow-orange-600/50 animate-bounce">
          <i class="fas fa-check text-4xl text-white"></i>
        </div>
        
        <h1 class="running-shoes-fullscreen-text mb-4">
          ACTIVITY SUBMITTED!
        </h1>
        
        <div class="space-y-4">
          <p class="text-xl font-bold text-white/90 tracking-wider">
            Proof image uploaded successfully
          </p>
          <div class="flex items-center justify-center gap-3">
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <p class="text-lg text-green-400 font-semibold">Waiting for admin approval</p>
            <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          </div>
        </div>
      </div>
      
      <!-- Progress Bar -->
      <div class="w-64 mx-auto mt-8">
        <div class="flex justify-between text-sm text-white/70 mb-2">
          <span>Submitted</span>
          <span>Under Review</span>
        </div>
        <div class="w-full h-2 bg-white/20 rounded-full overflow-hidden">
          <div class="h-full bg-gradient-to-r from-orange-600 via-amber-500 to-orange-600 rounded-full animate-loading"></div>
        </div>
        <p class="text-xs text-white/50 mt-2">Admin will add distance, duration & pace</p>
      </div>
      
      <!-- Stats Preview -->
      <div class="mt-10 grid grid-cols-3 gap-4 max-w-md mx-auto">
        <div class="p-4 bg-white/5 backdrop-blur-sm rounded-xl border border-white/10">
          <div class="text-2xl font-black text-orange-400">0.0</div>
          <div class="text-xs text-white/70 mt-1">Distance (km)</div>
        </div>
        <div class="p-4 bg-white/5 backdrop-blur-sm rounded-xl border border-white/10">
          <div class="text-2xl font-black text-amber-400">0.0</div>
          <div class="text-xs text-white/70 mt-1">Duration (min)</div>
        </div>
        <div class="p-4 bg-white/5 backdrop-blur-sm rounded-xl border border-white/10">
          <div class="text-2xl font-black text-yellow-400">0.0</div>
          <div class="text-xs text-white/70 mt-1">Pace (min/km)</div>
        </div>
      </div>
      
      <!-- Countdown Timer -->
      <div class="mt-8 text-white/60 text-sm">
        Returning to dashboard in <span id="countdownTimer" class="font-bold text-white">3</span> seconds...
      </div>
    </div>
    
    <!-- Bottom Note -->
    <div class="absolute bottom-8 left-0 right-0 text-center">
      <p class="text-white/40 text-sm font-medium tracking-wider">Powered by Roadha Run ‚Ä¢ Developed by Ahmed Vaseem</p>
    </div>
  `;
  
  document.body.appendChild(animationContainer);
  
  // Add CSS for the loading animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes loading {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    .animate-loading {
      animation: loading 2s ease-in-out infinite;
      width: 30%;
    }
  `;
  document.head.appendChild(style);
  
  // Countdown timer
  let countdown = 3;
  const countdownElement = document.getElementById('countdownTimer');
  const timer = setInterval(() => {
    countdown--;
    if (countdownElement) {
      countdownElement.textContent = countdown;
    }
    if (countdown <= 0) {
      clearInterval(timer);
    }
  }, 2000);
  
  // Remove animation after 3 seconds
  setTimeout(() => {
    if (animationContainer.parentNode) {
      document.body.removeChild(animationContainer);
      if (style.parentNode) {
        document.head.removeChild(style);
      }
    }
  }, 3000);
}
  </script>
  <style>
    /* Enhanced Running Shoes Animation Styles */
@keyframes runningShoesFullScreen {
  0% { 
    transform: scale(0.5) rotate(0deg);
    opacity: 0;
    filter: brightness(1);
  }
  10% { 
    transform: scale(1.2) rotate(5deg);
    opacity: 0.8;
    filter: brightness(1.2);
  }
  20% { 
    transform: scale(1.8) rotate(-5deg);
    opacity: 1;
    filter: brightness(1.5);
  }
  30% { 
    transform: scale(2.5) rotate(8deg);
    opacity: 1;
    filter: brightness(1.8);
  }
  40% { 
    transform: scale(3.2) rotate(-8deg);
    opacity: 1;
    filter: brightness(2);
  }
  50% { 
    transform: scale(4) rotate(10deg);
    opacity: 1;
    filter: brightness(2.3);
  }
  60% { 
    transform: scale(5) rotate(-10deg);
    opacity: 1;
    filter: brightness(2.5);
  }
  70% { 
    transform: scale(6) rotate(12deg);
    opacity: 0.9;
    filter: brightness(2.8);
  }
  80% { 
    transform: scale(7) rotate(-12deg);
    opacity: 0.7;
    filter: brightness(3);
  }
  90% { 
    transform: scale(8) rotate(15deg);
    opacity: 0.5;
    filter: brightness(3.2);
  }
  100% { 
    transform: scale(10) rotate(0deg);
    opacity: 0;
    filter: brightness(3.5);
  }
}

.animate-running-shoes-fullscreen {
  animation: runningShoesFullScreen 2.5s ease-out forwards;
}

.running-shoe-fullscreen {
  position: absolute;
  font-size: 60px;
  filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.7));
  z-index: 1000001;
}

.running-shoes-fullscreen-text {
  position: relative;
  z-index: 1000002;
  font-size: 3rem;
  font-weight: 900;
  text-align: center;
  background: linear-gradient(45deg, #FF6B6B, #FFD166, #06D6A0, #118AB2, #EF476F);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: pulse-custom 1s infinite;
}

@media (max-width: 640px) {
  .running-shoes-fullscreen-text {
    font-size: 2rem;
  }
  
  .running-shoe-fullscreen {
    font-size: 40px;
  }
}
  </style>
</body>
</html>
